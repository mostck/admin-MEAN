<form name="userForm">
    <div layout-gt-sm="row">
        <md-input-container class="md-block angular-animate" flex-gt-xs>
            <label>{{ 'user.username' | translate }}</label>
            <input name="email" type="email" ng-model="vm.user.username" ng-pattern="/^.+@.+\..+$/" maxlength="300" required autofocus>
            <div ng-messages="userForm.email.$error">
                <div ng-message="unique">
                    {{ 'validation.name' | translate }}
                </div>
            </div>
        </md-input-container>
        <md-input-container class="md-block" flex-gt-xs>
            <label>{{ 'user.realName' | translate }}</label>
            <input ng-model="vm.user.realName" maxlength="100" required>
        </md-input-container>
    </div>

    <div layout-gt-sm="row">
        <md-input-container ng-if="vm.state=='create'" class="md-block angular-animate" flex-gt-xs>
            <label>{{ 'user.password' | translate }}</label>
            <input name="password" type="password" ng-model="vm.user.password" pattern=".{6,}" required autocomplete="new-password">
            <div ng-messages="userForm.password.$error">
                <div ng-message="pattern">{{ 'user.validation.password' | translate }}</div>
            </div>
        </md-input-container>
    </div>
    <div layout-gt-sm="row">
        <md-input-container class="md-block" flex-gt-sm ng-if="vm.state=='create' || vm.user._id != vm.currentUser._id">
            <md-select-label>{{ 'user.role' | translate }}</md-select-label>
            <md-select ng-model="vm.user.roleId" required>
                <md-option ng-repeat="role in vm.userRoles" value="{{role.id}}">
                    {{role.name}}
                </md-option>
            </md-select>
        </md-input-container>
        <md-input-container class="md-block" flex-gt-sm>
            <md-select-label>{{ 'user.preferredLanguage' | translate }}</md-select-label>
            <md-select ng-model="vm.user.preferredLanguage">
                <md-option value="en">EN</md-option>
                <md-option value="de">DE</md-option>
            </md-select>
        </md-input-container>
    </div>
    <div layout-gt-sm="row">
        <md-input-container class="md-block" flex-gt-sm ng-if="vm.user.roleId != 1 && (vm.routerState =='superAdmin.adminUsers.create' || vm.routerState =='superAdmin.adminUsers.update')">
            <md-select-label>{{ 'user.company' | translate }}</md-select-label>
            <md-select ng-model="vm.user.companyId" required>
                <md-option ng-repeat="company in vm.getAllCompanies" value="{{company._id}}">
                    {{company.name}}
                </md-option>
            </md-select>
        </md-input-container>
    </div>

    <div layout-gt-sm="row">
        <md-input-container class="md-block" flex-gt-xs ng-if="vm.user.roleId == 4">
            <label>{{ 'user.company' | translate }}</label>
            <input ng-model="vm.user.companyName" maxlength="60" required>
        </md-input-container>
        <md-input-container class="md-block" flex-gt-xs>
            <label>{{ 'user.phone' | translate }}</label>
            <input ng-model="vm.user.phone" maxlength="30">
        </md-input-container>
    </div>

    <div layout-gt-sm="row">
        <md-input-container class="md-block" flex-gt-xs>
            <label>{{ 'address.country' | translate }}</label>
            <input ng-model="vm.user.address.country" maxlength="60">
        </md-input-container>
        <md-input-container class="md-block" flex-gt-xs>
            <label>{{ 'address.town' | translate }}</label>
            <input ng-model="vm.user.address.town" maxlength="60">
        </md-input-container>
        <md-input-container class="md-block" flex-gt-xs>
            <label>{{ 'address.streetNr' | translate }}</label>
            <input ng-model="vm.user.address.streetNr" maxlength="60">
        </md-input-container>
        <md-input-container class="md-block" flex-gt-xs>
            <label>{{ 'address.additionalLine' | translate }}</label>
            <input ng-model="vm.user.address.additionalLine" maxlength="30">
        </md-input-container>
        <md-input-container class="md-block" flex-gt-xs>
            <label>{{ 'address.zip' | translate }}</label>
            <input ng-model="vm.user.address.zip" pattern="\d*" maxlength="15">
        </md-input-container>
    </div>
    <md-table-container ng-if="vm.user.roleId == 3">
        <table md-table>
            <thead md-head>
            <tr md-row>
                <th md-column>{{ 'permission.name' | translate }}</th>
                <th md-column>{{ 'permission.read' | translate }}</th>
                <th md-column>{{ 'permission.write' | translate }}</th>
            </tr>
            </thead>
            <tbody md-body>
            <tr>
                <td md-cell>{{'permission.projectsAll' | translate}}</td>
                <td md-cell>
                    <md-input-container>
                        <md-checkbox ng-model="vm.user.permissions.projectsAll.read" ng-disabled="vm.user.permissions.projectsAll.write && vm.user.permissions.projectsAll.read"></md-checkbox>
                    </md-input-container>
                </td>
                <td md-cell>
                    <md-input-container>
                        <md-checkbox ng-model="vm.user.permissions.projectsAll.write" ng-disabled="!vm.user.permissions.projectsAll.write && !vm.user.permissions.projectsAll.read"></md-checkbox>
                    </md-input-container>
                </td>
            </tr>
            <tr>
                <td md-cell>{{'permission.projectsOwner' | translate}}</td>
                <td md-cell>
                    <md-input-container>
                        <md-checkbox ng-model="vm.user.permissions.projectsOwner.read" ng-disabled="vm.user.permissions.projectsOwner.write && vm.user.permissions.projectsOwner.read"></md-checkbox>
                    </md-input-container>
                </td>
                <td md-cell>
                    <md-input-container>
                        <md-checkbox ng-model="vm.user.permissions.projectsOwner.write" ng-disabled="!vm.user.permissions.projectsOwner.write && !vm.user.permissions.projectsOwner.read"></md-checkbox>
                    </md-input-container>
                </td>
            </tr>
            <tr>
                <td md-cell>{{'permission.devices' | translate}}</td>
                <td md-cell>
                    <md-input-container>
                        <md-checkbox ng-model="vm.user.permissions.devices.read" ng-disabled="vm.user.permissions.devices.write && vm.user.permissions.devices.read"></md-checkbox>
                    </md-input-container>
                </td>
                <td md-cell>
                    <md-input-container>
                        <md-checkbox ng-model="vm.user.permissions.devices.write" ng-disabled="!vm.user.permissions.devices.write && !vm.user.permissions.devices.read"></md-checkbox>
                    </md-input-container>
                </td>
            </tr>
            </tbody>
        </table>
    </md-table-container>
    <div layout-gt-sm="row" ng-if="vm.user.roleId == 5 || vm.user.roleId == 6">
        <md-input-container class="md-block" flex-gt-sm>
            <label>{{ 'user.customer' | translate }}</label>
            <md-select name="customer" ng-model="vm.user.customer" required validation-customer pms-admin="vm.pmsAdmin" pms-role="vm.user.roleId">
                <md-option ng-repeat="customer in vm.customers" value="{{customer._id}}">
                    {{customer.name}}
                </md-option>
            </md-select>
            <div ng-messages="userForm.customer.$error">
                <div ng-message="customer">{{ 'user.validation.customer' | translate }}</div>
            </div>
        </md-input-container>
    </div>
    <br>
    <md-button ng-disabled="userForm.$invalid"
               ng-click="vm.save(vm.user)"
               class="md-raised"
               md-colors="{backgroundColor: 'siloblue-700', color: 'siloblue-50'}">
        <span ng-show="vm.state=='create'">{{ 'button.create' | translate }}</span>
        <span ng-show="vm.state=='update'">{{ 'button.update' | translate }}</span>
    </md-button>
</form>