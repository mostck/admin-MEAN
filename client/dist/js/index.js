"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var reduce=Function.bind.call(Function.call,Array.prototype.reduce),isEnumerable=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),concat=Function.bind.call(Function.call,Array.prototype.concat),keys=Reflect.ownKeys;Object.values||(Object.values=function(e){return reduce(keys(e),function(t,n){return concat(t,"string"==typeof n&&isEnumerable(e,n)?[e[n]]:[])},[])}),Object.entries||(Object.entries=function(e){return reduce(keys(e),function(t,n){return concat(t,"string"==typeof n&&isEnumerable(e,n)?[[n,e[n]]]:[])},[])}),function(){angular.module("heaterSiloM2M",["ui.bootstrap","ngMaterial","md.data.table","pascalprecht.translate","ngCookies","ngFileUpload","ngSanitize","ngCsv","googlechart","LocalStorageModule","ngMessages","ngDrag","gantt","gantt.table","gantt.movable","gantt.sortable","gantt.tooltips","gantt.groups","gantt.tree","gantt.bounds","gantt.drawtask","uuid","heaterSiloM2M.routing"])}(),function(){function e(e,t,n,a,r,o,i,l,s){n.interceptors.push("TokenInterceptor"),t.useLoader("translateLoader",{prefix:r.getApiUri+"/lang?lang=",suffix:".json"}),t.useSanitizeValueStrategy(null),t.preferredLanguage("en"),a.setPrefix("heaterSiloM2M").setStorageType("localStorage").setNotify(!1,!1),o.definePalette("siloorange",{50:"#ffffff",100:"#ffd2bd",200:"#ffac85",300:"#ff7c3d",400:"#ff671f",500:"#ff5200",600:"#e04800",700:"#c23e00",800:"#a33400",900:"#852b00",A100:"#ffffff",A200:"#ffd2bd",A400:"#ff671f",A700:"#c23e00",contrastDefaultColor:"light",contrastDarkColors:"50 100 200 300 400 A100 A200 A400"}),o.definePalette("siloblue",{50:"#ffffff",100:"#e4edf1",200:"#bfd5de",300:"#90b7c5",400:"#7caabb",500:"#689db0",600:"#568fa4",700:"#397690",800:"#416c7c",900:"#365a67",A100:"#ffffff",A200:"#e4edf1",A400:"#7caabb",A700:"#4b7e90",contrastDefaultColor:"light",contrastDarkColors:"50 100 200 300 400 500 600 A100 A200 A400"}),angular.extend(o.theme("default").foregroundPalette,{1:"#397690",2:"#397690",3:"#397690",4:"#397690"}),o.theme("default").primaryPalette("siloorange").accentPalette("siloblue"),i.firstDayOfWeek=1,i.formatDate=function(e){var t=moment(e);return t.isValid()?t.format("DD/MM/YYYY"):""},i.parseDate=function(e){var t=moment(e,"DD/MM/YYYY",!0);return t.isValid()?t.toDate():new Date(NaN)},l.disableWarnings(),s.classNameFilter(/angular-animate/)}e.$inject=["$locationProvider","$translateProvider","$httpProvider","localStorageServiceProvider","configService","$mdThemingProvider","$mdDateLocaleProvider","$mdAriaProvider","$animateProvider"],angular.module("heaterSiloM2M").config(e)}(),function(){function e(e,t,n,a,r,o,i,l,s,d){function m(a,l,s,d){if(i.reset(),"login"===l.name&&n.isLoggedIn()){a.preventDefault();var m=n.getUserRole(),c=1===m?"superAdmin":~[5,6].indexOf(m)?"pm.projects":4===m?"supplier.silos":"myAccount";e.go(c)}l.defaultSubstate&&(a.preventDefault(),e.go(l.defaultSubstate)),r.notNeedAuthentication.some(function(e){return e==l.name})||(n.isLoggedIn()?o.getPermission(l.name.split(".")[0])||(a&&a.preventDefault(),e.go("permissionDenied")):(a&&a.preventDefault(),t.$broadcast("user.authenticate",!1),e.go("login",{redirectTo:l,redirectToParams:s},{inherit:!1})))}function c(e){var t=moment.localeData(e);d.shortMonths=t.monthsShort(),d.shortDays=t.weekdaysMin()}t.loading=!0,a.init(),c(a.get());var u=n.currentUser();u&&u.companyId&&l.getCompany(u.companyId).then(s.setCompany),t.$on("$stateChangeStart",m),t.$on("changeLanguage",function(e,t){return c(t)})}e.$inject=["$state","$rootScope","userService","localeService","configService","menuService","$deepStateRedirect","adminCompanyService","companyService","$mdDateLocale"],angular.module("heaterSiloM2M").run(e)}(),function(){function e(e,t,n){e.state("permissionDenied",{url:"/permission-denied",template:'<div class="container"><div layout="row" layout-align="center"><h1>644 {{\'http_error.644\' | translate}}</h1></div></div>'}).state("404",{url:"/404",template:'<div class="container"><div layout="row" layout-align="center"><h1>404 {{\'http_error.404\' | translate}}</h1></div></div>'}).state("myAccount",{url:"/my-account",template:'<div class="_layout"><div class="container"><div layout="column"><main-nav-bar ng-if="vm.navBar" items="vm.navBar"></main-nav-bar><div ui-view></div></div></div></div>',deepStateRedirect:{default:{state:"myAccount.settings"}}}).state("myAccount.settings",{url:"/settings",template:'<div class="row"><ng-form name="accountForm"><div layout-gt-sm="row"><div flex="100" flex-gt-sm="50"><md-input-container class="md-block"><label>{{ \'user.username\' | translate }}</label> <input type="email" ng-model="vm.user.username" ng-pattern="/^.+@.+\\..+$/" maxlength="300" required autofocus></md-input-container><md-input-container class="md-block"><label>{{ \'user.password\' | translate }}</label> <input name="password" type="password" ng-model="vm.user.password" minlength="6"><div ng-messages="accountForm.password.$error" role="alert"><div ng-message="minlength">{{ \'user.validation.password\' | translate }}</div></div></md-input-container></div><div flex="100" flex-gt-sm="50"><md-input-container class="md-block"><label>{{ \'user.realName\' | translate }}</label> <input type="text" ng-model="vm.user.realName" maxlength="100" required></md-input-container><md-input-container class="md-block"><label>{{ \'user.phone\' | translate }}</label> <input type="text" ng-model="vm.user.phone" maxlength="30"></md-input-container><md-input-container class="md-block"><label>{{ \'user.preferredLanguage\' | translate }}</label><md-select class="selectpicker" ng-model="vm.user.preferredLanguage"><md-option value="en">EN</md-option><md-option value="de">DE</md-option></md-select></md-input-container></div></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.user.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.user.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.user.address.streetNr" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.user.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.user.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><div><md-button ng-disabled="accountForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.updateUser(vm.user)">{{ \'button.update\' | translate }}</md-button></div></ng-form></div>',controller:"SettingsCtrl",controllerAs:"vm"}).state("myAccount.logout",{onEnter:["$state","userService",function(e,t){t.logout(),e.go("login")}]}).state("project",{url:"/project/:id",template:'<div class="container"><section layout="row" layout-align="space-between" class="control-bar"><div layout="row" layout-align="left center"><md-input-container><label>{{\'schedule.from\'| translate}}</label><md-datepicker ng-model="vm.options.fromDate" md-max-date="vm.options.toDate" md-open-on-focus md-hide-icons="triangle" aria-label="Start date range"></md-datepicker></md-input-container><md-input-container><label>{{\'schedule.to\'| translate}}</label><md-datepicker ng-model="vm.options.toDate" md-min-date="vm.options.fromDate" md-open-on-focus md-hide-icons="triangle" aria-label="End date range"></md-datepicker></md-input-container><md-input-container class="scale-select"><label>{{\'schedule.scale\'| translate}}</label><md-select ng-model="vm.options.scale" aria-label="Scale"><md-option ng-repeat="scale in [\'month\', \'week\', \'day\']" ng-value="scale">{{scale | translate}}</md-option></md-select><div class="errors"></div></md-input-container><md-button ng-if="vm.project.reminderDate" ng-click="vm.resetChart()">Reset</md-button></div></section><section layout-margin="3px" layout="row" class="schedule-container"><main-schedule flex allow-resizing="vm.allowResizing" ng-if="vm.project" data="vm.project" options="vm.options"></main-schedule></section><md-button ng-if="vm.project.reminderDate" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.confirm()">{{ \'button.confirm\' | translate }}</md-button><md-button ng-if="vm.project.reminderDate" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.prolong()">{{ \'button.prolong\' | translate }}</md-button></div>',params:{id:null},controller:"ProjectCtrl",controllerAs:"vm",onEnter:["$stateParams","$state",function(e,t){e.id||t.go("admin.projects.all")}],resolve:{project:["adminProjectService","$stateParams","$state",function(e,t,n){return e.get(t.id).catch(function(){n.go("404",{},{location:"replace"})})}]}}).state("silo",{url:"/silo/:id",template:'<div class="container"><div layout="row" layout-margin="5px"><div flex="20"><img src="/assets/images/silo_image.jpg" alt="silo" style="width: 100%;"></div><div flex><md-table-container><h1>Silo</h1><table md-table><tbody md-body><tr md-row><td md-cell>{{ \'device.serial\' | translate }}</td><td md-cell>{{ vm.silo.serial }}</td></tr><tr md-row><td md-cell>{{ \'device.serialNr\' | translate }}</td><td md-cell>{{ vm.silo.serialNr }}</td></tr><tr md-row><td md-cell>{{ \'device.maxLoad\' | translate }}:</td><td md-cell><span>{{ vm.silo.maxLoad }}</span></td></tr><tr md-row><td md-cell>{{ \'device.fillingLevel\' | translate }}:</td><td md-cell ng-form name="fillingLevelForm"><input type="number" min="0" max="{{ vm.silo.maxLoad }}" pattern="[0-9.]+" value="{{ vm.silo.fillingLevel }}" ng-model="vm.silo.fillingLevel"><md-button ng-disabled="fillingLevelForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.changeFillingLevel()">{{ \'button.send\' | translate }}</md-button></td></tr><tr md-row><td md-cell>{{ \'device.fillingLevelPer\' | translate }}:</td><td md-cell><span>{{ vm.percent | number:0 }}</span></td></tr><tr md-row><td md-cell colspan="2"><div class="meter"><span style="width: {{vm.percent}}%" ng-class="{ full: vm.percent == 100, orange: vm.percent <= 50 && vm.percent > 30, red: vm.percent <= 30 }"></span></div></td></tr><tr md-row><td md-cell>{{ \'device.timeSiloEmpty\' | translate }}</td><td md-cell><span ng-if="vm.estimateDate.months && vm.estimateDate.months > 0">{{ \'date.months\' | translate }}: {{ vm.estimateDate.months }}</span> <span ng-if="vm.estimateDate.days && vm.estimateDate.days > 0">{{ \'date.days\' | translate }}: {{ vm.estimateDate.days }}</span> <span ng-if="vm.estimateDate.hours && vm.estimateDate.hours > 0">{{ \'date.hours\' | translate }}: {{ vm.estimateDate.hours }}</span> <span ng-if="vm.estimateDate.minutes && vm.estimateDate.minutes > 0">{{ \'date.minutes\' | translate }}: {{ vm.estimateDate.minutes }}</span> <span ng-if="vm.estimateDate.seconds && vm.estimateDate.seconds > 0">{{ \'date.seconds\' | translate }}: {{ vm.estimateDate.seconds }}</span></td></tr></tbody></table></md-table-container></div></div><div layout="row" layout-margin="5px"><div flex><h3>Schedule</h3><device-schedule ng-if="vm.scheduleData && vm.scheduleData.length" schedule-data="vm.scheduleData"></device-schedule><p ng-if="!(vm.scheduleData && vm.scheduleData.length)">{{\'schedule.notUsed\' | translate}}</p></div></div><md-table-container layout="row" layout-margin="5px"><div flex="33" ng-if="vm.silo.employee"><h3>Employee</h3><table md-table><tbody md-body><tr md-row><td md-cell>{{ \'user.realName\' | translate }}</td><td md-cell><span>{{vm.silo.employee.realName}}</span></td></tr><tr md-row><td md-cell>{{ \'user.phone\' | translate }}</td><td md-cell><span>{{vm.silo.employee.phone}}</span></td></tr><tr md-row><td md-cell>{{ \'user.email\' | translate }}</td><td md-cell><span>{{vm.silo.employee.username}}</span></td></tr></tbody></table></div><div flex="33" ng-if="vm.silo.supplier"><h3>Supplier</h3><table md-table><tbody md-body><tr md-row><td md-cell>{{ \'user.company\' | translate }}</td><td md-cell><span>{{vm.silo.supplier.companyName}}</span></td></tr><tr md-row><td md-cell>{{ \'user.phone\' | translate }}</td><td md-cell><span>{{vm.silo.supplier.phone}}</span></td></tr><tr md-row><td md-cell>{{ \'user.email\' | translate }}</td><td md-cell><span>{{vm.silo.supplier.username}}</span></td></tr></tbody></table></div><div flex="33" ng-if="vm.silo.object"><h3>Object</h3><table md-table><tbody md-body><tr md-row><td md-cell>{{ \'object.name\' | translate }}</td><td md-cell><span>{{vm.silo.object.name}}</span></td></tr><tr md-row><td md-cell>{{ \'object.gps\' | translate }}</td><td md-cell><span>{{vm.silo.object.location.gps}}</span></td></tr><tr md-row><td md-cell>{{ \'object.address\' | translate }}</td><td md-cell><span>{{vm.silo.object.location.address.country}}</span> <span>{{vm.silo.object.location.address.town}}</span> <span>{{vm.silo.object.location.address.streetNr}}</span> <span>{{vm.silo.object.location.address.additionalLine}}</span> <span>{{vm.silo.object.location.address.zip}}</span></td></tr></tbody></table></div></md-table-container><md-table-container layout="row" layout-margin="5px"><div flex ng-if="vm.silo.orders && vm.silo.orders.length > 0"><h3>Orders</h3><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="createdAt">{{ \'order.createdAt\' | translate }}</th><th md-column md-order-by="plannedDeliveryAt">{{ \'order.plannedDeliveryAt\' | translate }}</th><th md-column md-order-by="deliveredAt">{{ \'order.deliveredAt\' | translate }}</th><th md-column md-order-by="amountOfTons">{{ \'order.amountOfTons\' | translate }}</th><th md-column md-order-by="amountCHF">{{ \'order.amountCHF\' | translate }}</th><th md-column>{{ \'order.amountCHFPerTon\' | translate }}</th><th md-column md-order-by="status">{{ \'order.status\' | translate }}</th></tr></thead><tbody md-body><tr md-row ng-repeat="order in vm.silo.orders"><td md-cell>{{ order.createdAt | date: vm.dateFormat }}</td><td md-cell>{{ order.plannedDeliveryAt | date: vm.dateFormat }}</td><td md-cell>{{ order.deliveredAt | date: vm.dateFormat }}</td><td md-cell>{{ order.amountOfTons }}</td><td md-cell>{{ order.amountCHF | currency: "&#8355; " }}</td><td md-cell>{{ order.amountCHF / order.amountOfTons || null | currency: "&#8355; " }}</td><td md-cell>{{ order.status }}</td></tr></tbody></table></div></md-table-container><logbook records="vm.silo.logbook" device="vm.silo"></logbook></div>',params:{id:null},controller:"SiloCtrl",controllerAs:"vm",onEnter:["$stateParams","$state",function(e,t){e.id||t.go("admin.devices.all")}],resolve:{silo:["adminDeviceService","$stateParams","$state",function(e,t,n){return e.getSilo(t.id).catch(function(){n.go("404",{},{location:"replace"})})}]}}).state("heater",{url:"/heater/:id",template:'<div class="container"><div layout="row" layout-margin="5px"><div flex="20"><img src="/assets/images/heater.gif" alt="heater"></div><div flex><md-table-container><h1>Heater</h1><table md-table><tbody md-body><tr md-row><td md-cell>{{ \'device.serial\' | translate }}</td><td md-cell colspan="2"><span>{{vm.heater.serial}}</span></td></tr><tr md-row><td md-cell>{{ \'device.serialNr\' | translate }}</td><td md-cell colspan="2"><span>{{vm.heater.serialNr}}</span></td></tr><tr md-row ng-if="!vm.permissions || vm.permissions.status.read"><td md-cell>{{ \'device.status\' | translate }}:</td><td md-cell><span ng-if="vm.heater.status" class="round-box statusOn">{{ \'device.on\' | translate }}</span> <span ng-if="!vm.heater.status" class="round-box">{{ \'device.off\' | translate }}</span></td><td md-cell><md-button class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.changeStatus()">{{\'device.changeStatus\' | translate}}</md-button></td></tr><tr md-row ng-if="!vm.permissions || vm.permissions.alarm.read"><td md-cell>{{ \'device.alert\' | translate }}:</td><td md-cell><span ng-if="vm.heater.alert" class="round-box alertYes">{{ \'device.yes\' | translate }}</span> <span ng-if="!vm.heater.alert" class="round-box">{{ \'device.no\' | translate }}</span></td><td md-cell><md-button ng-if="!vm.heater.alert" class="md-raised" md-colors="{backgroundColor: \'siloorange-500\', color: \'siloorange-50\'}" ng-click="vm.sendAlert()">{{ \'device.sendAlert\' | translate }}</md-button><md-button ng-if="vm.heater.alert" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.confirmAlert()">{{ \'device.confirmAlert\' | translate }}</md-button></td></tr><tr md-row ng-if="!vm.permissions || vm.permissions.operatingHours.read"><td md-cell>{{ \'device.operationHours\' | translate }}:</td><td md-cell><input type="number" pattern="[0-9.]+" value="{{ vm.heater.operationHours }}" ng-model="vm.heater.operationHours"></td><td md-cell><md-button class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.changeOperationHours()">{{ \'device.changeOperationHours\' | translate }}</md-button></td></tr><tr md-row ng-if="!vm.permissions || vm.permissions.ashLevel.read"><td md-cell>{{ \'device.ashLevel\' | translate }}:</td><td md-cell colspan="2"><span ng-if="vm.heater.ashLevel">{{ vm.heater.ashLevel | number:0 }}</span></td></tr><tr md-row ng-if="!vm.permissions || vm.permissions.ashLevel.read"><td md-cell colspan="3"><div class="meter"><span style="width: {{vm.heater.ashLevel}}%" ng-class="{ orange: vm.heater.ashLevel < 70 && vm.heater.ashLevel >= 50, red: vm.heater.ashLevel >= 70 }"></span></div></td></tr><tr md-row><td md-cell>{{ \'device.serviceOperations\' | translate }}:</td><td md-cell><span ng-if="vm.heater.operationsServiceStatus" class="round-box alertYes">{{ \'device.yes\' | translate }}</span> <span ng-if="!vm.heater.operationsServiceStatus" class="round-box">{{ \'device.no\' | translate }}</span></td><td md-cell><md-button ng-if="vm.heater.operationsServiceStatus" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.confirmServiceOperations()">confirm Service Operations</md-button></td></tr><tr md-row><td md-cell>{{ \'device.servicePeriodic\' | translate }}:</td><td md-cell><span ng-if="vm.heater.periodicServiceStatus" class="round-box alertYes">{{ \'device.yes\' | translate }}</span> <span ng-if="!vm.heater.periodicServiceStatus" class="round-box">{{ \'device.no\' | translate }}</span></td><td md-cell><md-button ng-if="vm.heater.periodicServiceStatus" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.confirmServicePeriodic()">{{ \'device.confirmServicePeriodic\' | translate }}</md-button></td></tr></tbody></table></md-table-container></div></div><div layout="row" layout-margin="5px"><div flex><h3>Schedule</h3><device-schedule ng-if="vm.scheduleData && vm.scheduleData.length" schedule-data="vm.scheduleData"></device-schedule><p ng-if="!(vm.scheduleData && vm.scheduleData.length)">{{\'schedule.notUsed\' | translate}}</p></div></div><md-table-container layout="row" layout-margin="5px"><div flex="50" ng-if="vm.heater.employee"><h3>Employee:</h3><table md-table><tbody md-body><tr md-row><td md-cell>{{ \'user.realName\' | translate }}</td><td md-cell><span>{{vm.heater.employee.realName}}</span></td></tr><tr md-row><td md-cell>{{ \'user.phone\' | translate }}</td><td md-cell><span>{{vm.heater.employee.phone}}</span></td></tr><tr md-row><td md-cell>{{ \'user.email\' | translate }}</td><td md-cell><span>{{vm.heater.employee.username}}</span></td></tr></tbody></table></div><div flex="50" ng-if="vm.heater.object"><h3>Object</h3><table md-table><tbody md-body><tr md-row><td md-cell>{{ \'object.name\' | translate }}</td><td md-cell><span>{{vm.heater.object.name}}</span></td></tr><tr md-row><td md-cell>{{ \'object.gps\' | translate }}</td><td md-cell><span>{{vm.heater.object.location.gps}}</span></td></tr><tr md-row><td md-cell>{{ \'object.address\' | translate }}</td><td md-cell><span>{{vm.heater.object.location.address.country}}</span> <span>{{vm.heater.object.location.address.town}}</span> <span>{{vm.heater.object.location.address.streetNr}}</span> <span>{{vm.heater.object.location.address.additionalLine}}</span> <span>{{vm.heater.object.location.address.zip}}</span></td></tr></tbody></table></div></md-table-container><md-table-container layout="row" layout-margin="5px"><div flex="50" ng-if="vm.heater.customer"><h3>Customer</h3><table md-table><tbody md-body><tr md-row><td md-cell>{{ \'customer.name\' | translate }}</td><td md-cell><span ng-if="vm.heater.customer">{{ vm.heater.customer.name }}</span></td></tr><tr md-row><td md-cell>{{ \'customer.address\' | translate }}</td><td md-cell><span>{{ vm.heater.customer.address.country }}</span> <span>{{ vm.heater.customer.address.town }}</span> <span>{{ vm.heater.customer.address.streetNr }}</span> <span>{{ vm.heater.customer.address.additionalLine }}</span> <span>{{ vm.heater.customer.address.zip }}</span></td></tr></tbody></table></div><div flex="50" ng-if="vm.heater.pm"><h3>Pm</h3><table md-table><tbody md-body><tr md-row><td md-cell>{{ \'user.realName\' | translate }}</td><td md-cell>{{vm.heater.pm.realName}}</td></tr><tr md-row><td md-cell>{{ \'user.phone\' | translate }}</td><td md-cell>{{vm.heater.pm.phone}}</td></tr><tr md-row><td md-cell>{{ \'user.email\' | translate }}</td><td md-cell>{{vm.heater.pm.username}}</td></tr></tbody></table></div></md-table-container><logbook records="vm.heater.logbook" device="vm.heater"></logbook></div>',params:{id:null},controller:"HeaterCtrl",controllerAs:"vm",onEnter:["$stateParams","$state",function(e,t){e.id||t.go("admin.devices.all")}],resolve:{heater:["adminDeviceService","$stateParams","$state",function(e,t,n){return e.getHeater(t.id).catch(function(){n.go("404",{},{location:"replace"})})}]}}).state("login",{url:"/login",params:{redirectTo:null,redirectToParams:null},template:'<div class="_user"><div class="container"><div layout="row" layout-align="center"><img class="main-logo" src="assets/images/logo.png" alt="logo"></div><div layout="row" layout-align="center"><form name="loginForm" layout="column" flex="100" flex-gt-sm="33" ng-submit="vm.loginUser(vm.login, vm.password)"><md-input-container><label>{{ \'user.username\' | translate }}</label> <input type="email" name="login-username" ng-model="vm.login" required md-autofocus></md-input-container><md-input-container><input type="password" name="login-password" ng-model="vm.password" required> <label>{{ \'user.password\' | translate }}</label></md-input-container><md-button ng-disabled="loginForm.$invalid" class="md-primary" type="submit">{{ \'button.login\' | translate }}</md-button><a ui-sref="forgot"><small>{{ \'user.forgot_password\' | translate }}</small></a></form></div><div layout="row" layout-align="center"><div layout="column" flex="100" flex-gt-sm="33" ng-if="vm.warning" class="alert alert-warning"><strong>{{ \'user.alert.warning\' | translate }}</strong></div></div></div></div>',controller:"UserLoginCtrl",controllerAs:"vm"}).state("registration",{url:"/registration",template:'<div class="_user"><div class="container"><div class="row"><form ng-submit="vm.registerUser(vm.username, vm.email, vm.password, vm.companyId)"><div class="form-group"><label>{{ \'user.username\' | translate }}</label> <input class="form-control" type="text" ng-model="vm.username" required autofocus></div><div class="form-group"><label>{{ \'user.email\' | translate }}</label> <input class="form-control" type="email" ng-model="vm.email" ng-pattern="/^.+@.+\\..+$/" required></div><div class="form-group"><label>{{ \'user.company\' | translate }}</label><select ng-model="vm.companyId" ng-options="company._id as company.name for company in vm.getAllCompanies"></select></div><div class="form-group"><label>{{ \'user.password\' | translate }}</label> <input class="form-control" type="password" ng-model="vm.password" required></div><input class="button" type="submit" value="{{ \'button.send\' | translate }}"></form><div ng-if="vm.done" class="alert alert-success"><strong>"{{ \'alert.success\' | translate }}"</strong></div></div></div></div>',controller:"UserRegistrationCtrl",controllerAs:"vm"}).state("forgot",{url:"/forgot",template:'<div class="_user"><div class="container"><div layout="row" layout-align="center"><img class="main-logo" src="assets/images/logo.png" alt="logo"></div><div layout="row" layout-align="center"><form name="forgotForm" layout="column" flex="100" flex-gt-sm="33"><h3>{{ \'user.forgot_title\' | translate }}</h3><md-input-container><label>{{ \'user.username\' | translate }}</label> <input type="email" ng-model="vm.username" ng-pattern="/^.+@.+\\..+$/" required autofocus></md-input-container><md-button ng-disabled="forgotForm.$invalid" class="md-primary" ng-click="vm.forgotUser(vm.username)">{{ \'button.send\' | translate }}</md-button><a ui-sref="login"><small>{{ \'user.back_to_login\' | translate }}</small></a></form></div><div layout="row" layout-align="center"><div layout="column" flex="100" flex-gt-sm="33" ng-if="vm.warning" class="alert alert-warning"><strong>{{ \'user.alert.warning_forgot\' | translate }}</strong></div><div layout="column" flex="100" flex-gt-sm="33" ng-if="vm.success" class="alert alert-success"><strong>{{ \'user.alert.success_forgot\' | translate }}</strong></div></div></div></div>',controller:"UserForgotCtrl",controllerAs:"vm"}).state("reset",{url:"/reset/:id",template:'<div class="_user"><div class="container"><div layout="row" layout-align="center"><ng-form name="resetForm" layout="column" flex="100" flex-gt-sm="33"><h3>{{ \'user.reset_title\' | translate }}</h3><md-input-container><label>{{ \'user.password\' | translate }}</label> <input name="password" type="password" ng-model="vm.password" required pattern=".{6,}"><div ng-messages="resetForm.password.$error"><div ng-message="pattern">{{ \'user.validation.password\' | translate }}</div></div></md-input-container><md-input-container><label>{{ \'user.confirmPassword\' | translate }}</label> <input name="confirmPassword" type="password" ng-model="vm.confirmPassword" required ng-pattern="vm.getPattern()"><div ng-messages="resetForm.confirmPassword.$error"><div ng-message="pattern">{{ \'user.validation.confirm\' | translate }}</div></div></md-input-container><md-button ng-disabled="resetForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.resetUser(vm.password)">{{ \'button.confirm\' | translate }}</md-button></ng-form></div></div></div>',controller:"UserResetCtrl",controllerAs:"vm"}).state("dataCollection",{url:"/dataCollection",template:'<div class="_home"><div class="container"><div class="row"><table class="table" ng-if="vm.data"><thead><tr><th ng-repeat="(key, val) in vm.data[0]">{{ key }}</th></tr></thead><tbody><tr ng-repeat="item in vm.data"><td ng-repeat="(key, val) in item">{{ val }}</td></tr></tbody></table></div><button style="float: right;" class="button" ng-click="vm.deleteAllDataCollection()">Clear</button></div></div>',controller:"DataCollectionCtrl",controllerAs:"vm"}),n.html5Mode(!0),t.otherwise("/login")}e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider"],angular.module("heaterSiloM2M.routing",["ui.router","ct.ui.router.extras.dsr"]).config(e)}(),function(){function e(e){e.state("admin",{url:"/admin",template:'<div class="_layout"><div class="container"><div layout="column"><main-nav-bar ng-if="vm.navBar" items="vm.navBar"></main-nav-bar><div ui-view></div></div></div></div>',controller:["menuService","userService","$state",function(e,t,n){if(this.navBar=Object.values(e.getMain().admin.menu),3==t.getUserRole()){var a=t.getUserPermisions();!a||a.projectsAll.read||a.projectsOwner.read||(a&&!a.devices.read?n.go("admin.orders.all"):n.go("admin.devices.all"))}}],controllerAs:"vm",sticky:!0,deepStateRedirect:{default:{state:"admin.projects.all"},fn:["userService",function(e){var t;if(3==e.getUserRole()){var n=e.getUserPermisions();!n||n.projectsAll.read||n.projectsOwner.read||(t=n&&!n.devices.read?"admin.orders.all":"admin.devices.all")}return{state:t?t:"admin.projects.all"}}]}}).state("admin.projects",{
url:"/projects",template:'<div class="container"><div layout="row" layout-xs="column"><div layout="column" flex="10" flex-xs="100"><side-nav-bar items="vm.navBar"></side-nav-bar></div><div layout="column" flex="90" flex-xs="100"><div ui-view></div></div></div></div>',controller:["menuService","$state",function(e,t){this.navBar=Object.values(e.getMain().admin.menu.projects.menu)}],controllerAs:"vm",defaultSubstate:"admin.projects.all"}).state("admin.projects.all",{url:"/all",template:'<md-table-container><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="name">{{ \'project.name\' | translate }}</th><th md-column md-order-by="startDate">{{ \'project.startDate\' | translate }}</th><th md-column md-order-by="endDate">{{ \'project.endDate\' | translate }}</th><th md-column md-order-by="archive">{{ \'project.archive\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr ng-if="!vm.permissionRead || project.permissionRead" md-row ng-repeat="project in vm.projects | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{project.name}}</td><td md-cell>{{project.startDate | date: \'dd/MM/yyyy\'}}</td><td md-cell>{{project.endDate | date: \'dd/MM/yyyy\'}}</td><td md-cell><span ng-if="project.archive" class="round-box">{{ \'project.yes\' | translate }}</span> <span ng-if="!project.archive" class="round-box statusOn">{{ \'project.no\' | translate }}</span></td><td md-cell><div class="actions"><md-button ng-if="!vm.permissionWrite || project.permissionWrite" class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ng-click="vm.copy(project._id)" title="{{ \'button.copy\' | translate }}"><i class="fa fa-copy fa-2"></i></md-button><md-button ng-if="!vm.permissionWrite || project.permissionWrite" class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.update(project._id)" title="{{ \'button.update\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button><md-button ng-if="!vm.permissionWrite || project.permissionWrite" class="md-fab md-mini md-warn" ng-click="vm.remove(project)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.projects.length }}" md-page-select></md-table-pagination>',controller:"AdminProjectsAllCtrl",controllerAs:"vm"}).state("admin.projects.update",{url:"/update/:id",template:'<ng-form name="projectForm"><md-input-container class="md-block angular-animate"><label>{{ \'project.name\' | translate }}</label> <input type="text" ng-model="vm.project.name" name="projectName" ng-model-options="{debounce: 500}" maxlength="100" required autofocus><div ng-messages="projectForm.projectName.$error"><div ng-message="unique">{{ \'validation.name\' | translate }}</div></div></md-input-container><md-input-container class="md-block"><label>{{ \'project.description\' | translate }}</label> <input type="text" ng-model="vm.project.description"></md-input-container><div layout="row"><div flex="50"><label>{{ \'project.startDate\' | translate }} *</label><md-datepicker ng-required ng-model="vm.project.startDate" md-open-on-focus md-hide-icons="triangle"></md-datepicker></div><div flex="50"><label>{{ \'project.endDate\' | translate }} *</label><md-datepicker ng-required ng-model="vm.project.endDate" md-min-date="vm.project.startDate" md-open-on-focus md-hide-icons="triangle"></md-datepicker></div></div><hr><div layout="row"><div layout-gt-sm="column" flex><div layout-gt-sm="row" layout-align="start center"><label>{{ \'project.employee\' | translate }}</label><md-input-container flex="50"><md-select ng-model="vm.project.employee" placeholder="{{\'input.pleaseSelect\' | translate}}"><md-option ng-value="employee._id" ng-repeat="employee in vm.employees">{{employee.realName}} ({{employee.username}})</md-option></md-select></md-input-container></div></div><div layout-gt-sm="column" flex><div layout-gt-sm="row" layout-align="start center"><label>{{ \'project.customer\' | translate }}</label><md-input-container flex="50"><md-select ng-model="vm.project.customer" placeholder="{{\'input.pleaseSelect\' | translate}}"><md-option ng-value="customer._id" ng-repeat="customer in vm.customers">{{customer.name}}</md-option></md-select></md-input-container></div></div><div layout-gt-sm="column" flex><div layout-gt-sm="row" layout-align="start center"><label>{{ \'project.pm\' | translate }}</label><md-input-container flex="50"><md-select ng-model="vm.project.pm" placeholder="{{\'input.pleaseSelect\' | translate}}" ng-disabled="!vm.project.customer"><md-option ng-if="vm.project.customer == pm.customer" ng-value="pm._id" ng-repeat="pm in vm.pms">{{pm.realName}} ({{pm.username}})</md-option></md-select></md-input-container></div></div></div><hr><div layout="row" layout-align="start center"><h3>{{ \'project.objects\' | translate }}</h3><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.createObjectDialog()" title="{{ \'button.add\' | translate }}"><i class="fa fa-plus fa-2"></i></md-button></div><div class="table-responsive"><table class="table"><thead><tr><th>{{ \'object.name\' | translate }}</th><th>{{ \'object.gps\' | translate }}</th><th>{{ \'object.comment\' | translate }}</th><th>{{ \'common.silos\' | translate }}</th><th>{{ \'common.heaters\' | translate }}</th><th></th></tr></thead><tbody><tr ng-repeat="object in vm.project.objects"><td>{{object.name}}</td><td>{{object.location.gps}}</td><td>{{object.comment}}</td><td>{{object.numberSilos}}</td><td>{{object.numberHeaters}}</td><td><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.updateObjectDialog(object)" title="{{ \'button.edit\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button><md-button class="md-fab md-mini md-warn" ng-click="vm.removeObject(object)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></td></tr></tbody></table></div><section layout-margin="3px" layout="row" class="schedule-container"><project-schedule flex ng-if="vm.project" data="vm.project"></project-schedule></section><hr><md-button ng-disabled="projectForm.$error.required || !vm.changed" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.saveProject()"><span ng-if="vm.state===\'copy\'">{{ \'button.copy\' | translate }}</span> <span ng-if="vm.state===\'create\'">{{ \'button.create\' | translate }}</span> <span ng-if="vm.state===\'update\'">{{ \'button.save\' | translate }}</span></md-button></ng-form>',params:{id:null},controller:"AdminProjectsEditCtrl",controllerAs:"vm",onEnter:["$stateParams","$state",function(e,t){e.id||t.go("admin.projects.all")}]}).state("admin.projects.copy",{url:"/copy/:id",template:'<ng-form name="projectForm"><md-input-container class="md-block angular-animate"><label>{{ \'project.name\' | translate }}</label> <input type="text" ng-model="vm.project.name" name="projectName" ng-model-options="{debounce: 500}" maxlength="100" required autofocus><div ng-messages="projectForm.projectName.$error"><div ng-message="unique">{{ \'validation.name\' | translate }}</div></div></md-input-container><md-input-container class="md-block"><label>{{ \'project.description\' | translate }}</label> <input type="text" ng-model="vm.project.description"></md-input-container><div layout="row"><div flex="50"><label>{{ \'project.startDate\' | translate }} *</label><md-datepicker ng-required ng-model="vm.project.startDate" md-open-on-focus md-hide-icons="triangle"></md-datepicker></div><div flex="50"><label>{{ \'project.endDate\' | translate }} *</label><md-datepicker ng-required ng-model="vm.project.endDate" md-min-date="vm.project.startDate" md-open-on-focus md-hide-icons="triangle"></md-datepicker></div></div><hr><div layout="row"><div layout-gt-sm="column" flex><div layout-gt-sm="row" layout-align="start center"><label>{{ \'project.employee\' | translate }}</label><md-input-container flex="50"><md-select ng-model="vm.project.employee" placeholder="{{\'input.pleaseSelect\' | translate}}"><md-option ng-value="employee._id" ng-repeat="employee in vm.employees">{{employee.realName}} ({{employee.username}})</md-option></md-select></md-input-container></div></div><div layout-gt-sm="column" flex><div layout-gt-sm="row" layout-align="start center"><label>{{ \'project.customer\' | translate }}</label><md-input-container flex="50"><md-select ng-model="vm.project.customer" placeholder="{{\'input.pleaseSelect\' | translate}}"><md-option ng-value="customer._id" ng-repeat="customer in vm.customers">{{customer.name}}</md-option></md-select></md-input-container></div></div><div layout-gt-sm="column" flex><div layout-gt-sm="row" layout-align="start center"><label>{{ \'project.pm\' | translate }}</label><md-input-container flex="50"><md-select ng-model="vm.project.pm" placeholder="{{\'input.pleaseSelect\' | translate}}" ng-disabled="!vm.project.customer"><md-option ng-if="vm.project.customer == pm.customer" ng-value="pm._id" ng-repeat="pm in vm.pms">{{pm.realName}} ({{pm.username}})</md-option></md-select></md-input-container></div></div></div><hr><div layout="row" layout-align="start center"><h3>{{ \'project.objects\' | translate }}</h3><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.createObjectDialog()" title="{{ \'button.add\' | translate }}"><i class="fa fa-plus fa-2"></i></md-button></div><div class="table-responsive"><table class="table"><thead><tr><th>{{ \'object.name\' | translate }}</th><th>{{ \'object.gps\' | translate }}</th><th>{{ \'object.comment\' | translate }}</th><th>{{ \'common.silos\' | translate }}</th><th>{{ \'common.heaters\' | translate }}</th><th></th></tr></thead><tbody><tr ng-repeat="object in vm.project.objects"><td>{{object.name}}</td><td>{{object.location.gps}}</td><td>{{object.comment}}</td><td>{{object.numberSilos}}</td><td>{{object.numberHeaters}}</td><td><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.updateObjectDialog(object)" title="{{ \'button.edit\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button><md-button class="md-fab md-mini md-warn" ng-click="vm.removeObject(object)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></td></tr></tbody></table></div><section layout-margin="3px" layout="row" class="schedule-container"><project-schedule flex ng-if="vm.project" data="vm.project"></project-schedule></section><hr><md-button ng-disabled="projectForm.$error.required || !vm.changed" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.saveProject()"><span ng-if="vm.state===\'copy\'">{{ \'button.copy\' | translate }}</span> <span ng-if="vm.state===\'create\'">{{ \'button.create\' | translate }}</span> <span ng-if="vm.state===\'update\'">{{ \'button.save\' | translate }}</span></md-button></ng-form>',params:{id:null},controller:"AdminProjectsEditCtrl",controllerAs:"vm",onEnter:["$stateParams","$state",function(e,t){e.id||t.go("admin.projects.all")}]}).state("admin.projects.create",{url:"/create",template:'<ng-form name="projectForm"><md-input-container class="md-block angular-animate"><label>{{ \'project.name\' | translate }}</label> <input type="text" ng-model="vm.project.name" name="projectName" ng-model-options="{debounce: 500}" maxlength="100" required autofocus><div ng-messages="projectForm.projectName.$error"><div ng-message="unique">{{ \'validation.name\' | translate }}</div></div></md-input-container><md-input-container class="md-block"><label>{{ \'project.description\' | translate }}</label> <input type="text" ng-model="vm.project.description"></md-input-container><div layout="row"><div flex="50"><label>{{ \'project.startDate\' | translate }} *</label><md-datepicker ng-required ng-model="vm.project.startDate" md-open-on-focus md-hide-icons="triangle"></md-datepicker></div><div flex="50"><label>{{ \'project.endDate\' | translate }} *</label><md-datepicker ng-required ng-model="vm.project.endDate" md-min-date="vm.project.startDate" md-open-on-focus md-hide-icons="triangle"></md-datepicker></div></div><hr><div layout="row"><div layout-gt-sm="column" flex><div layout-gt-sm="row" layout-align="start center"><label>{{ \'project.employee\' | translate }}</label><md-input-container flex="50"><md-select ng-model="vm.project.employee" placeholder="{{\'input.pleaseSelect\' | translate}}"><md-option ng-value="employee._id" ng-repeat="employee in vm.employees">{{employee.realName}} ({{employee.username}})</md-option></md-select></md-input-container></div></div><div layout-gt-sm="column" flex><div layout-gt-sm="row" layout-align="start center"><label>{{ \'project.customer\' | translate }}</label><md-input-container flex="50"><md-select ng-model="vm.project.customer" placeholder="{{\'input.pleaseSelect\' | translate}}"><md-option ng-value="customer._id" ng-repeat="customer in vm.customers">{{customer.name}}</md-option></md-select></md-input-container></div></div><div layout-gt-sm="column" flex><div layout-gt-sm="row" layout-align="start center"><label>{{ \'project.pm\' | translate }}</label><md-input-container flex="50"><md-select ng-model="vm.project.pm" placeholder="{{\'input.pleaseSelect\' | translate}}" ng-disabled="!vm.project.customer"><md-option ng-if="vm.project.customer == pm.customer" ng-value="pm._id" ng-repeat="pm in vm.pms">{{pm.realName}} ({{pm.username}})</md-option></md-select></md-input-container></div></div></div><hr><div layout="row" layout-align="start center"><h3>{{ \'project.objects\' | translate }}</h3><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.createObjectDialog()" title="{{ \'button.add\' | translate }}"><i class="fa fa-plus fa-2"></i></md-button></div><div class="table-responsive"><table class="table"><thead><tr><th>{{ \'object.name\' | translate }}</th><th>{{ \'object.gps\' | translate }}</th><th>{{ \'object.comment\' | translate }}</th><th>{{ \'common.silos\' | translate }}</th><th>{{ \'common.heaters\' | translate }}</th><th></th></tr></thead><tbody><tr ng-repeat="object in vm.project.objects"><td>{{object.name}}</td><td>{{object.location.gps}}</td><td>{{object.comment}}</td><td>{{object.numberSilos}}</td><td>{{object.numberHeaters}}</td><td><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.updateObjectDialog(object)" title="{{ \'button.edit\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button><md-button class="md-fab md-mini md-warn" ng-click="vm.removeObject(object)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></td></tr></tbody></table></div><section layout-margin="3px" layout="row" class="schedule-container"><project-schedule flex ng-if="vm.project" data="vm.project"></project-schedule></section><hr><md-button ng-disabled="projectForm.$error.required || !vm.changed" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.saveProject()"><span ng-if="vm.state===\'copy\'">{{ \'button.copy\' | translate }}</span> <span ng-if="vm.state===\'create\'">{{ \'button.create\' | translate }}</span> <span ng-if="vm.state===\'update\'">{{ \'button.save\' | translate }}</span></md-button></ng-form>',controller:"AdminProjectsEditCtrl",controllerAs:"vm"}).state("admin.projects.schedule",{url:"/schedule",template:'<div class="_schedule"><div layout="column"><section layout="row" layout-align="space-between" class="control-bar"><div layout="row" layout-align="left center"><md-input-container><label>{{\'schedule.from\'| translate}}</label><md-datepicker ng-model="vm.options.fromDate" md-max-date="vm.options.toDate" md-open-on-focus md-hide-icons="triangle" aria-label="Start date range"></md-datepicker></md-input-container><md-input-container><label>{{\'schedule.to\'| translate}}</label><md-datepicker ng-model="vm.options.toDate" md-min-date="vm.options.fromDate" md-open-on-focus md-hide-icons="triangle" aria-label="End date range"></md-datepicker></md-input-container><md-input-container class="scale-select"><label>{{\'schedule.scale\'| translate}}</label><md-select ng-model="vm.options.scale" aria-label="Scale"><md-option ng-repeat="scale in [\'month\', \'week\', \'day\']" ng-value="scale">{{scale | translate}}</md-option></md-select><div class="errors"></div></md-input-container></div><div layout="row"><md-button aria-label="Refresh schedule" layout-align="right" class="md-fab md-mini md-raised" md-colors="{backgroundColor: \'siloblue-400\', color: \'siloblue-50\'}" ng-click="vm.refresh()"><i class="fa fa-refresh fa-2"></i></md-button></div></section><section layout-margin="3px" layout="row" class="schedule-container"><div flex class="chart-container"><main-schedule ng-if="vm.projects && vm.projects.length" data="vm.projects" silos-length="vm.silosLength" options="vm.options"></main-schedule><p class="text-center" ng-if="!(vm.projects && vm.projects.length)">{{ \'schedule.no_projects\' | translate }} <a ui-sref="admin.projects.create">Create new project</a></p></div></section></div></div>',controller:"AdminScheduleCtrl",controllerAs:"vm"}).state("admin.devices",{url:"/devices",template:'<div class="container"><div layout="row" layout-xs="column"><div layout="column" flex="10" flex-xs="100"><side-nav-bar items="vm.navBar"></side-nav-bar></div><div layout="column" flex="90" flex-xs="100"><div ui-view></div></div></div></div>',controller:["menuService",function(e){this.navBar=Object.values(e.getMain().admin.menu.devices.menu)}],controllerAs:"vm",defaultSubstate:"admin.devices.all"}).state("admin.devices.all",{url:"/all",template:'<md-table-container><h1>{{ \'common.silos\' | translate }}</h1><table md-table><thead md-head md-order="vm.querySilos.order"><tr md-row><th md-column md-order-by="serial">{{ \'device.serial\' | translate }}</th><th md-column>{{ \'device.address\' | translate }}</th><th md-column>{{ \'device.maxLoad\' | translate }}</th><th md-column md-order-by="fillingLevel">{{ \'device.fillingLevel\' | translate }}</th><th md-column>{{ \'device.fillingLevelPer\' | translate }}</th><th md-column></th><th md-column></th><th md-column></th></tr></thead><tbody md-body><tr md-row ng-repeat-start="silo in vm.getAllSilos | orderBy: vm.querySilos.order | limitTo: vm.querySilos.limit : (vm.querySilos.page -1) * vm.querySilos.limit"><td md-cell>{{silo.serial}}</td><td md-cell><span>{{silo.object.location.address.country}}</span> <span>{{silo.object.location.address.town}}</span> <span>{{silo.object.location.address.streetNr}}</span> <span>{{silo.object.location.address.zip}}</span></td><td md-cell>{{silo.maxLoad}}</td><td md-cell>{{silo.fillingLevel}}</td><td md-cell><div class="meter" ng-if="silo.percent"><span style="width: {{silo.percent}}%" ng-class="{ full: silo.percent == 100, orange: silo.percent < 50 && silo.percent >= 30, red: silo.percent < 30 }"></span></div></td><td md-cell style="padding:0"><div class="actions"><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ui-sref="silo({id: silo._id})" title="{{ \'button.view\' | translate }}"><i class="fa fa-info fa-2"></i></md-button></div></td><td md-cell style="padding:0"><div class="actions"><md-button ng-if="!vm.permission" class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ui-sref="admin.devices.update({id: silo._id, type: silo.type})" title="{{ \'button.update\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button></div></td><td md-cell style="padding:0"><div class="actions"><md-button ng-if="!vm.permission" class="md-fab md-mini md-warn" ng-click="vm.removeSilo(silo)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></div></td></tr><tr md-row ng-repeat-end ng-if="silo.orders && silo.orders.length > 0"><td md-cell colspan="8" style="border-top: none"><div ng-repeat="order in silo.orders" class="silo-order"><span>{{ \'order.createdAt\' | translate }}:</span> <span>{{order.createdAt | date: vm.dateFormat}},</span> <span ng-if="order.plannedDeliveryAt">{{ \'order.plannedDeliveryAt\' | translate }}:</span> <span ng-if="order.plannedDeliveryAt">{{order.plannedDeliveryAt | date: vm.dateFormat}},</span><span>{{ \'order.amountOfTons\' | translate }}:</span> <span>{{order.amountOfTons}},</span> <span>{{ \'order.supplier\' | translate }}:</span> <span>{{silo.supplier.companyName}}</span></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.querySilos.limit" md-page="vm.querySilos.page" md-total="{{ vm.getAllSilos.length }}" md-page-select></md-table-pagination><md-table-container><h1>{{ \'common.heaters\' | translate }}</h1><table md-table><thead md-head md-order="vm.queryHeaters.order"><tr><th md-column md-order-by="serial">{{ \'device.serial\' | translate }}</th><th md-column>{{ \'device.address\' | translate }}</th><th md-column>{{ \'device.status\' | translate }}</th><th md-column>{{ \'device.alert\' | translate }}</th><th md-column md-order-by="operationHours">{{ \'device.operationHours\' | translate }}</th><th md-column>{{ \'device.ashLevel\' | translate }}</th><th md-column></th><th md-column></th><th md-column></th></tr></thead><tbody md-body><tr ng-repeat="heater in vm.getAllHeaters | orderBy: vm.queryHeaters.order | limitTo: vm.queryHeaters.limit : (vm.queryHeaters.page -1) * vm.queryHeaters.limit"><td md-cell>{{heater.serial}}</td><td md-cell><span>{{heater.object.location.address.country}}</span> <span>{{heater.object.location.address.town}}</span> <span>{{heater.object.location.address.streetNr}}</span> <span>{{heater.object.location.address.zip}}</span></td><td md-cell><span ng-if="heater.status" class="round-box statusOn">{{ \'device.on\' | translate }}</span> <span ng-if="!heater.status" class="round-box">{{ \'device.off\' | translate }}</span></td><td md-cell><span ng-if="heater.alert" class="round-box alertYes">{{ \'device.yes\' | translate }}</span> <span ng-if="!heater.alert" class="round-box">{{ \'device.no\' | translate }}</span></td><td md-cell><span ng-if="heater.operationHours">{{ heater.operationHours }}</span></td><td md-cell><div class="meter" ng-if="heater.ashLevel"><span style="width: {{heater.ashLevel}}%" ng-class="{ orange: heater.ashLevel < 70 && heater.ashLevel >= 50, red: heater.ashLevel >= 70 }"></span></div></td><td md-cell style="padding:0"><div class="actions"><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ui-sref="heater({id: heater._id})" title="{{ \'button.view\' | translate }}"><i class="fa fa-info fa-2"></i></md-button></div></td><td md-cell style="padding:0"><div class="actions"><md-button ng-if="!vm.permission" class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ui-sref="admin.devices.update({id: heater._id, type: heater.type})" title="{{ \'button.update\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button></div></td><td md-cell style="padding:0"><div class="actions"><md-button ng-if="!vm.permission" class="md-fab md-mini md-warn" ng-click="vm.removeHeater(heater)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.queryHeaters.limit" md-page="vm.queryHeaters.page" md-total="{{ vm.getAllHeaters.length }}" md-page-select></md-table-pagination>',controller:"AdminDevicesAllCtrl",controllerAs:"vm"}).state("admin.devices.update",{url:"/update/:type/:id",template:'<form name="deviceForm"><md-input-container ng-if="vm.state===\'create\'" class="md-block md-headline"><md-select ng-model="vm.device.type"><md-option value="heater">Heater</md-option><md-option value="silo">Silo</md-option></md-select><br></md-input-container><md-input-container class="md-block angular-animate"><label>{{ \'device.serial\' | translate }}</label> <input name="serial" type="text" ng-model="vm.device.serial" required autofocus><div ng-messages="deviceForm.serial.$error"><div ng-message="unique">{{ \'validation.name\' | translate }}</div></div></md-input-container><md-input-container class="md-block"><label>{{ \'device.serialNr\' | translate }}</label> <input type="text" ng-model="vm.device.serialNr"></md-input-container><div><div ng-if="vm.device.type == \'silo\'"><md-input-container class="md-block"><label>{{ \'device.maxLoad\' | translate }}</label> <input type="text" pattern="\\d*" ng-model="vm.device.maxLoad"></md-input-container></div><div ng-if="vm.device.type == \'heater\'"><md-input-container class="md-block"><label>{{ \'device.operationHours\' | translate }}</label> <input type="text" pattern="\\d*" ng-model="vm.device.operationHours"></md-input-container></div><md-button ng-disabled="deviceForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.save(vm.device)"><span ng-if="vm.state === \'create\'">{{ \'button.create\' | translate }}</span> <span ng-if="vm.state === \'update\'">{{ \'button.update\' | translate }}</span></md-button></div></form>',params:{id:null,type:null},controller:"AdminDevicesEditCtrl",controllerAs:"vm",onEnter:["$stateParams","$state",function(e,t){e.id||e.type||t.go("admin.devices.all")}]}).state("admin.devices.create",{url:"/create",params:{type:"silo"},template:'<form name="deviceForm"><md-input-container ng-if="vm.state===\'create\'" class="md-block md-headline"><md-select ng-model="vm.device.type"><md-option value="heater">Heater</md-option><md-option value="silo">Silo</md-option></md-select><br></md-input-container><md-input-container class="md-block angular-animate"><label>{{ \'device.serial\' | translate }}</label> <input name="serial" type="text" ng-model="vm.device.serial" required autofocus><div ng-messages="deviceForm.serial.$error"><div ng-message="unique">{{ \'validation.name\' | translate }}</div></div></md-input-container><md-input-container class="md-block"><label>{{ \'device.serialNr\' | translate }}</label> <input type="text" ng-model="vm.device.serialNr"></md-input-container><div><div ng-if="vm.device.type == \'silo\'"><md-input-container class="md-block"><label>{{ \'device.maxLoad\' | translate }}</label> <input type="text" pattern="\\d*" ng-model="vm.device.maxLoad"></md-input-container></div><div ng-if="vm.device.type == \'heater\'"><md-input-container class="md-block"><label>{{ \'device.operationHours\' | translate }}</label> <input type="text" pattern="\\d*" ng-model="vm.device.operationHours"></md-input-container></div><md-button ng-disabled="deviceForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.save(vm.device)"><span ng-if="vm.state === \'create\'">{{ \'button.create\' | translate }}</span> <span ng-if="vm.state === \'update\'">{{ \'button.update\' | translate }}</span></md-button></div></form>',controller:"AdminDevicesEditCtrl",controllerAs:"vm"}).state("admin.customers",{url:"/customers",template:'<div class="container"><div layout="row" layout-xs="column"><div layout="column" flex="10" flex-xs="100"><side-nav-bar items="vm.navBar"></side-nav-bar></div><div layout="column" flex="90" flex-xs="100"><div ui-view></div></div></div></div>',controller:["menuService","userService","$state",function(e,t,n){this.navBar=Object.values(e.getMain().admin.menu.customers.menu),3==t.getUserRole()&&n.go("permissionDenied")}],controllerAs:"vm",defaultSubstate:"admin.customers.all"}).state("admin.customers.all",{url:"/all",template:'<md-table-container><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="name">{{ \'customer.name\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr md-row ng-repeat="customer in vm.getAllCustomers | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{customer.name}}</td><td md-cell><div class="actions"><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.update(customer._id)" title="{{ \'button.update\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button><md-button class="md-fab md-mini md-warn" ng-click="vm.remove(customer)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.getAllCustomers.length }}" md-page-select></md-table-pagination>',controller:"AdminCustomersAllCtrl",controllerAs:"vm"}).state("admin.customers.update",{url:"/update/:id",template:'<ng-form name="customerForm"><md-input-container class="md-block"><label>{{ \'customer.name\' | translate }}</label> <input type="text" ng-model="vm.customer.name" required autofocus></md-input-container><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.customer.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.customer.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.customer.address.streetNr" maxlength="60"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.customer.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.customer.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><md-table-container><table md-table><thead md-head><tr md-row><th md-column>{{ \'permission.infoHeater\' | translate }}</th><th md-column>{{ \'permission.read\' | translate }}</th></tr></thead><tbody md-body><tr><td md-cell>{{\'permission.status\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.customer.permissions.status.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.alarm\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.customer.permissions.alarm.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.operatingHours\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.customer.permissions.operatingHours.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.ashLevel\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.customer.permissions.ashLevel.read"></md-checkbox></md-input-container></td></tr></tbody></table></md-table-container><md-button ng-disabled="customerForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.saveCustomer(vm.customer)"><span ng-if="vm.state === \'create\'">{{ \'button.create\' | translate }}</span> <span ng-if="vm.state === \'update\'">{{ \'button.update\' | translate }}</span></md-button></ng-form>',params:{id:null},controller:"AdminCustomersUpdateCtrl",controllerAs:"vm",onEnter:["$stateParams","$state",function(e,t){e.id||t.go("admin.customers.all")}],resolve:{customer:["adminCustomerService","$stateParams","$state",function(e,t,n){return e.getCustomer(t.id).catch(function(){
n.go("404",{},{location:"replace"})})}]}}).state("admin.customers.create",{url:"/create",template:'<ng-form name="customerForm"><md-input-container class="md-block"><label>{{ \'customer.name\' | translate }}</label> <input type="text" ng-model="vm.customer.name" required autofocus></md-input-container><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.customer.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.customer.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.customer.address.streetNr" maxlength="60"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.customer.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.customer.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><md-table-container><table md-table><thead md-head><tr md-row><th md-column>{{ \'permission.infoHeater\' | translate }}</th><th md-column>{{ \'permission.read\' | translate }}</th></tr></thead><tbody md-body><tr><td md-cell>{{\'permission.status\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.customer.permissions.status.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.alarm\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.customer.permissions.alarm.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.operatingHours\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.customer.permissions.operatingHours.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.ashLevel\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.customer.permissions.ashLevel.read"></md-checkbox></md-input-container></td></tr></tbody></table></md-table-container><md-button ng-disabled="customerForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.saveCustomer(vm.customer)"><span ng-if="vm.state === \'create\'">{{ \'button.create\' | translate }}</span> <span ng-if="vm.state === \'update\'">{{ \'button.update\' | translate }}</span></md-button></ng-form>',controller:"AdminCustomersCreateCtrl",controllerAs:"vm"}).state("admin.orders",{url:"/orders",template:'<div class="container"><div layout="row" layout-xs="column"><div layout="column" flex="10" flex-xs="100"><side-nav-bar items="vm.navBar"></side-nav-bar></div><div layout="column" flex="90" flex-xs="100"><div ui-view></div></div></div></div>',controller:["menuService",function(e){this.navBar=Object.values(e.getMain().admin.menu.orders.menu)}],controllerAs:"vm",defaultSubstate:"admin.orders.all"}).state("admin.orders.update",{url:"/update/:id",template:'<div class="container"><div layout="row"><div flex="50"><h3>{{ \'order.order\' | translate }} #: {{ vm.order.number || vm.order._id }}</h3></div><div flex="50"><h3>{{ \'order.status\' | translate }}: {{ vm.order.status }}</h3></div></div><hr><form name="orderForm"><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.createdAt\' | translate }}</label><md-datepicker ng-disabled="true" ng-model="vm.order.createdAt" md-open-on-focus md-hide-icons="triangle"></md-datepicker></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.plannedDeliveryAt\' | translate }}</label><md-datepicker ng-disabled="vm.order.status != \'open\'" ng-model="vm.order.plannedDeliveryAt" md-open-on-focus md-hide-icons="triangle"></md-datepicker></md-input-container><md-input-container ng-if="vm.order.status != \'open\'" class="md-block" flex-gt-xs><label>{{ \'order.deliveredAt\' | translate }}</label><md-datepicker required ng-disabled="vm.order.status == \'delivered\'" ng-model="vm.order.deliveredAt" md-open-on-focus md-hide-icons="triangle"></md-datepicker></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.amountOfTons\' | translate }}</label> <input required ng-model="vm.order.amountOfTons"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.amountCHFPerTon\' | translate }}</label> <input required ng-model="vm.order.amountCHFPerTon" ng-change="vm.changeCHFPerTon()"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.amountCHF\' | translate }}</label> <input required ng-model="vm.order.amountCHF" ng-change="vm.changeCHF()"></md-input-container></div><hr><md-button ng-if="vm.order.status == \'open\'" ng-disabled="orderForm.$invalid" ng-click="vm.confirmed(vm.order)" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}">{{ \'button.confirm\' | translate }}</md-button><md-button ng-if="vm.order.status == \'confirmed\'" ng-disabled="orderForm.$invalid" ng-click="vm.delivered(vm.order)" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}">{{ \'button.delivered\' | translate }}</md-button></form></div>',params:{id:null},controller:"AdminOrdersUpdateCtrl",controllerAs:"vm",resolve:{order:["adminOrderService","$stateParams","$state",function(e,t,n){return e.get(t.id).catch(function(){return n.go("404",{},{location:"replace"})})}]}}).state("admin.orders.all",{url:"/all",template:'<md-table-container><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="number">{{ \'order.number\' | translate }}</th><th md-column md-order-by="supplier">{{ \'order.supplier\' | translate }}</th><th md-column md-order-by="silo">{{ \'common.silo\' | translate }}</th><th md-column>{{ \'order.amountOfTons\' | translate }}</th><th md-column>{{ \'order.amountCHF\' | translate }}</th><th md-column>{{ \'order.amountCHFPerTon\' | translate }}</th><th md-column md-order-by="status">{{ \'order.status\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr md-row ng-repeat="order in vm.orders | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell><span style="text-overflow: ellipsis; overflow: hidden; width: 200px; display: block;" title="{{order.number || order._id}}">{{order.number || order._id}}</span></td><td md-cell>{{order.supplier.companyName}}</td><td md-cell>{{order.silo.serial}}</td><td md-cell>{{order.amountOfTons}}</td><td md-cell>{{order.amountCHF }}</td><td md-cell>{{order.amountCHF / order.amountOfTons || null }}</td><td md-cell>{{order.status}}</td><td md-cell><div class="actions"><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ui-sref="admin.orders.update({id: order._id})" title="{{ \'button.view\' | translate }}"><i class="fa fa-info fa-2"></i></md-button><md-button class="md-fab md-mini md-warn" ng-click="vm.remove(order)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.orders.length }}" md-page-select></md-table-pagination>',controller:"AdminOrdersAllCtrl",controllerAs:"vm"}).state("admin.orders.create",{url:"/create",template:'<form name="orderForm"><div layout-gt-sm="row"><div class="md-block" layout="column" flex-gt-xs><label>{{ \'common.silo\' | translate }}</label><md-input-container><md-select ng-model="vm.order.silo" placeholder="{{ \'input.pleaseSelect\' | translate }}" required><md-option ng-value="silo" ng-repeat="silo in vm.silos">{{silo.serial}}</md-option></md-select></md-input-container></div></div><div layout-gt-sm="row"><div class="md-block" layout="column" flex-gt-xs><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.supplier\' | translate }}</label> <input ng-value="vm.order.silo.supplier.companyName" disabled></md-input-container></div><div class="md-block" layout="column" flex-gt-xs><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.amountOfTons\' | translate }}</label> <input ng-value="vm.order.silo.maxLoad" disabled></md-input-container></div></div><md-button ng-disabled="orderForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.createOrder(vm.order)">{{ \'button.create\' | translate }}</md-button></form>',controller:"AdminOrdersCreateCtrl",controllerAs:"vm"}).state("admin.company",{url:"/company",template:'<ng-form name="companyForm"><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.name\' | translate }}</label> <input ng-model="vm.company.name" maxlength="30" required autofocus></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.email\' | translate }}</label> <input type="email" ng-model="vm.company.email" ng-pattern="/^.+@.+\\..+$/" maxlength="60" required></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.phone\' | translate }}</label> <input ng-model="vm.company.phone" maxlength="30" required></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.company.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.company.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.company.address.streetNr" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.company.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.company.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><hr><div layout-gt-sm="row"><p style="margin: auto;" class="md-block" flex-gt-xs>{{ \'company.daysOfWeek\' | translate }}</p><md-input-container class="md-block" flex-gt-xs><md-select multiple="true" ng-model="vm.company.officeTime.daysOfWeek" placeholder="{{ \'input.pleaseSelect\' | translate }}"><md-option ng-value="day.id" ng-repeat="day in vm.daysOfWeek">{{ day.name | translate }}</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><div flex="50"><p>{{ \'company.startTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.officeTime.startTime"></div></div><div flex="50"><p>{{ \'company.endTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.officeTime.endTime"></div></div></div><hr><div layout-gt-sm="row"><div layout="column" flex="50"><p>{{ \'company.reminderTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.reminderTime"></div></div><div layout="column" flex="50"><p>{{ \'company.reminderProjTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.reminderProjTime"></div></div></div><hr><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.operationsServiceTime\' | translate }}</label> <input ng-model="vm.company.operationsServiceTime" pattern="\\d*" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.periodicServiceTime\' | translate }}</label> <input ng-model="vm.company.periodicServiceTime" pattern="\\d*" maxlength="30"></md-input-container></div><hr><div layout="row"><div layout="column" flex="50"><label>{{ \'company.logo\' | translate }}</label> <img style="width:200px;" ng-show="!!vm.company.logo" ngf-thumbnail="vm.company.logo"></div><div layout="column" flex><ng-form name="vm.upload_form"><div layout="row"><input class="upload-logo" type="file" ngf-select ng-model="vm.file" name="file" ngf-pattern="\'image/*\'" accept="image/*" ngf-max-size="2MB"><md-button ng-click="vm.selectFile()" class="md-raised md-primary md-fab" aria-label="Select logo file"><i class="fa fa-upload fa-2"></i></md-button><md-input-container flex layout="column" class="md-block" flex-gt-xs><input type="text" ng-model="vm.file.name" name="fileName" disabled="!vm.file"><div ng-messages="vm.upload_form.fileName.$error" md-auto-hide="false" role="alert"><div ng-message="maxSize">{{ \'company.maxSize\' | translate }}</div></div></md-input-container></div><md-button ng-disabled="!vm.file" class="md-raised" type="submit" ng-click="vm.submit()" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}">{{ \'button.upload\' | translate }}</md-button><span ng-if="vm.file">{{ \'company.upload\' | translate }}</span></ng-form></div></div><md-button ng-disabled="companyForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.saveCompany(vm.company)"><span ng-show="vm.state==\'create\'">{{ \'button.create\' | translate }}</span> <span ng-show="vm.state==\'update\'">{{ \'button.update\' | translate }}</span></md-button></ng-form>',controller:"AdminCompanyCtrl",controllerAs:"vm",onEnter:["userService","$state",function(e,t){3==e.getUserRole()&&t.go("permissionDenied")}]}).state("admin.users",{url:"/user",template:'<div class="container"><div layout="row" layout-xs="column"><div layout="column" flex="10" flex-xs="100"><side-nav-bar items="vm.navBar"></side-nav-bar></div><div layout="column" flex="90" flex-xs="100"><div ui-view></div></div></div></div>',controller:["menuService","userService","$state",function(e,t,n){this.navBar=Object.values(e.getMain().admin.menu.users.menu),3==t.getUserRole()&&n.go("permissionDenied")}],controllerAs:"vm",defaultSubstate:"admin.users.all"}).state("admin.users.all",{url:"/all",template:'<md-table-container><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="username">{{ \'user.username\' | translate }}</th><th md-column md-order-by="role">{{ \'user.role\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr md-row ng-repeat="user in vm.getAllUsers | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{user.username}}</td><td md-cell>{{user.role[\'name\']}}</td><td md-cell><div class="actions"><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.update(user._id)" title="{{ \'button.update\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button><md-button ng-if="user._id != vm.currentUser._id" class="md-fab md-mini md-warn" ng-click="vm.remove(user)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.getAllUsers.length }}" md-page-select></md-table-pagination>',controller:"AdminUsersAllCtrl",controllerAs:"vm"}).state("admin.users.create",{url:"/create",template:'<form name="userForm"><div layout-gt-sm="row"><md-input-container class="md-block angular-animate" flex-gt-xs><label>{{ \'user.username\' | translate }}</label> <input name="email" type="email" ng-model="vm.user.username" ng-pattern="/^.+@.+\\..+$/" maxlength="300" required autofocus><div ng-messages="userForm.email.$error"><div ng-message="unique">{{ \'validation.name\' | translate }}</div></div></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.realName\' | translate }}</label> <input ng-model="vm.user.realName" maxlength="100" required></md-input-container></div><div layout-gt-sm="row"><md-input-container ng-if="vm.state==\'create\'" class="md-block angular-animate" flex-gt-xs><label>{{ \'user.password\' | translate }}</label> <input name="password" type="password" ng-model="vm.user.password" pattern=".{6,}" required autocomplete="new-password"><div ng-messages="userForm.password.$error"><div ng-message="pattern">{{ \'user.validation.password\' | translate }}</div></div></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm ng-if="vm.state==\'create\' || vm.user._id != vm.currentUser._id"><md-select-label>{{ \'user.role\' | translate }}</md-select-label><md-select ng-model="vm.user.roleId" required><md-option ng-repeat="role in vm.userRoles" value="{{role.id}}">{{role.name}}</md-option></md-select></md-input-container><md-input-container class="md-block" flex-gt-sm><md-select-label>{{ \'user.preferredLanguage\' | translate }}</md-select-label><md-select ng-model="vm.user.preferredLanguage"><md-option value="en">EN</md-option><md-option value="de">DE</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm ng-if="vm.user.roleId != 1 && (vm.routerState ==\'superAdmin.adminUsers.create\' || vm.routerState ==\'superAdmin.adminUsers.update\')"><md-select-label>{{ \'user.company\' | translate }}</md-select-label><md-select ng-model="vm.user.companyId" required><md-option ng-repeat="company in vm.getAllCompanies" value="{{company._id}}">{{company.name}}</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs ng-if="vm.user.roleId == 4"><label>{{ \'user.company\' | translate }}</label> <input ng-model="vm.user.companyName" maxlength="60" required></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.phone\' | translate }}</label> <input ng-model="vm.user.phone" maxlength="30"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.user.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.user.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.user.address.streetNr" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.user.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.user.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><md-table-container ng-if="vm.user.roleId == 3"><table md-table><thead md-head><tr md-row><th md-column>{{ \'permission.name\' | translate }}</th><th md-column>{{ \'permission.read\' | translate }}</th><th md-column>{{ \'permission.write\' | translate }}</th></tr></thead><tbody md-body><tr><td md-cell>{{\'permission.projectsAll\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsAll.read" ng-disabled="vm.user.permissions.projectsAll.write && vm.user.permissions.projectsAll.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsAll.write" ng-disabled="!vm.user.permissions.projectsAll.write && !vm.user.permissions.projectsAll.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.projectsOwner\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsOwner.read" ng-disabled="vm.user.permissions.projectsOwner.write && vm.user.permissions.projectsOwner.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsOwner.write" ng-disabled="!vm.user.permissions.projectsOwner.write && !vm.user.permissions.projectsOwner.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.devices\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.devices.read" ng-disabled="vm.user.permissions.devices.write && vm.user.permissions.devices.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.devices.write" ng-disabled="!vm.user.permissions.devices.write && !vm.user.permissions.devices.read"></md-checkbox></md-input-container></td></tr></tbody></table></md-table-container><div layout-gt-sm="row" ng-if="vm.user.roleId == 5 || vm.user.roleId == 6"><md-input-container class="md-block" flex-gt-sm><label>{{ \'user.customer\' | translate }}</label><md-select name="customer" ng-model="vm.user.customer" required validation-customer pms-admin="vm.pmsAdmin" pms-role="vm.user.roleId"><md-option ng-repeat="customer in vm.customers" value="{{customer._id}}">{{customer.name}}</md-option></md-select><div ng-messages="userForm.customer.$error"><div ng-message="customer">{{ \'user.validation.customer\' | translate }}</div></div></md-input-container></div><br><md-button ng-disabled="userForm.$invalid" ng-click="vm.save(vm.user)" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}"><span ng-show="vm.state==\'create\'">{{ \'button.create\' | translate }}</span> <span ng-show="vm.state==\'update\'">{{ \'button.update\' | translate }}</span></md-button></form>',controller:"AdminUsersCreateCtrl",controllerAs:"vm"}).state("admin.users.update",{url:"/update/:id",template:'<form name="userForm"><div layout-gt-sm="row"><md-input-container class="md-block angular-animate" flex-gt-xs><label>{{ \'user.username\' | translate }}</label> <input name="email" type="email" ng-model="vm.user.username" ng-pattern="/^.+@.+\\..+$/" maxlength="300" required autofocus><div ng-messages="userForm.email.$error"><div ng-message="unique">{{ \'validation.name\' | translate }}</div></div></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.realName\' | translate }}</label> <input ng-model="vm.user.realName" maxlength="100" required></md-input-container></div><div layout-gt-sm="row"><md-input-container ng-if="vm.state==\'create\'" class="md-block angular-animate" flex-gt-xs><label>{{ \'user.password\' | translate }}</label> <input name="password" type="password" ng-model="vm.user.password" pattern=".{6,}" required autocomplete="new-password"><div ng-messages="userForm.password.$error"><div ng-message="pattern">{{ \'user.validation.password\' | translate }}</div></div></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm ng-if="vm.state==\'create\' || vm.user._id != vm.currentUser._id"><md-select-label>{{ \'user.role\' | translate }}</md-select-label><md-select ng-model="vm.user.roleId" required><md-option ng-repeat="role in vm.userRoles" value="{{role.id}}">{{role.name}}</md-option></md-select></md-input-container><md-input-container class="md-block" flex-gt-sm><md-select-label>{{ \'user.preferredLanguage\' | translate }}</md-select-label><md-select ng-model="vm.user.preferredLanguage"><md-option value="en">EN</md-option><md-option value="de">DE</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm ng-if="vm.user.roleId != 1 && (vm.routerState ==\'superAdmin.adminUsers.create\' || vm.routerState ==\'superAdmin.adminUsers.update\')"><md-select-label>{{ \'user.company\' | translate }}</md-select-label><md-select ng-model="vm.user.companyId" required><md-option ng-repeat="company in vm.getAllCompanies" value="{{company._id}}">{{company.name}}</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs ng-if="vm.user.roleId == 4"><label>{{ \'user.company\' | translate }}</label> <input ng-model="vm.user.companyName" maxlength="60" required></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.phone\' | translate }}</label> <input ng-model="vm.user.phone" maxlength="30"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.user.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.user.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.user.address.streetNr" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.user.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.user.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><md-table-container ng-if="vm.user.roleId == 3"><table md-table><thead md-head><tr md-row><th md-column>{{ \'permission.name\' | translate }}</th><th md-column>{{ \'permission.read\' | translate }}</th><th md-column>{{ \'permission.write\' | translate }}</th></tr></thead><tbody md-body><tr><td md-cell>{{\'permission.projectsAll\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsAll.read" ng-disabled="vm.user.permissions.projectsAll.write && vm.user.permissions.projectsAll.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsAll.write" ng-disabled="!vm.user.permissions.projectsAll.write && !vm.user.permissions.projectsAll.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.projectsOwner\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsOwner.read" ng-disabled="vm.user.permissions.projectsOwner.write && vm.user.permissions.projectsOwner.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsOwner.write" ng-disabled="!vm.user.permissions.projectsOwner.write && !vm.user.permissions.projectsOwner.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.devices\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.devices.read" ng-disabled="vm.user.permissions.devices.write && vm.user.permissions.devices.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.devices.write" ng-disabled="!vm.user.permissions.devices.write && !vm.user.permissions.devices.read"></md-checkbox></md-input-container></td></tr></tbody></table></md-table-container><div layout-gt-sm="row" ng-if="vm.user.roleId == 5 || vm.user.roleId == 6"><md-input-container class="md-block" flex-gt-sm><label>{{ \'user.customer\' | translate }}</label><md-select name="customer" ng-model="vm.user.customer" required validation-customer pms-admin="vm.pmsAdmin" pms-role="vm.user.roleId"><md-option ng-repeat="customer in vm.customers" value="{{customer._id}}">{{customer.name}}</md-option></md-select><div ng-messages="userForm.customer.$error"><div ng-message="customer">{{ \'user.validation.customer\' | translate }}</div></div></md-input-container></div><br><md-button ng-disabled="userForm.$invalid" ng-click="vm.save(vm.user)" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}"><span ng-show="vm.state==\'create\'">{{ \'button.create\' | translate }}</span> <span ng-show="vm.state==\'update\'">{{ \'button.update\' | translate }}</span></md-button></form>',params:{id:null},controller:"AdminUsersUpdateCtrl",controllerAs:"vm",onEnter:["$stateParams","$state",function(e,t){e.id||t.go("admin.users.all")}],resolve:{user:["adminUserService","$stateParams","$state",function(e,t,n){return e.getUser(t.id).catch(function(){n.go("404",{},{location:"replace"})})}]}}).state("admin.statistics",{url:"/statistics",template:'<div class="container"><div layout="row" layout-xs="column"><div layout="column" flex="10" flex-xs="100"><side-nav-bar items="vm.navBar"></side-nav-bar></div><div layout="column" flex="90" flex-xs="100"><div ui-view></div></div></div></div>',controller:["menuService",function(e){this.navBar=Object.values(e.getMain().admin.menu.statistics.menu)}],controllerAs:"vm",deepStateRedirect:{default:{state:"admin.statistics.projects"}}}).state("admin.statistics.projects",{url:"/projects",template:'<div layout="row"><div flex="33" flex-gt-sm="25"><label>{{ \'common.project\' | translate }}</label><md-input-container><md-select ng-model="vm.chosenProject" ng-change="vm.changeProject()" placeholder="{{ \'input.pleaseSelect\' | translate }}"><md-option ng-value="null">all</md-option><md-option ng-value="project" ng-repeat="project in vm.projects">{{project.name}}</md-option></md-select></md-input-container></div><div flex="33" flex-gt-sm="25"><label>{{ \'common.object\' | translate }}</label><md-input-container><md-select ng-disabled="!vm.chosenProject" ng-model="vm.chosenObject" ng-change="vm.changeObject()" placeholder="{{ \'input.pleaseSelect\' | translate }}"><md-option ng-value="null">all</md-option><md-option ng-value="object" ng-repeat="object in vm.chosenProject.objects">{{object.name}}</md-option></md-select></md-input-container></div><div flex="33" flex-gt-sm="50"><md-button class="md-fab md-mini btn-excel" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ng-csv="vm.export" csv-header="[\'Name\', \'Amount Of Tons\', \'Operation Hours\', \'Days\']" filename="{{ vm.chosenObject ? vm.chosenObject.name : vm.chosenProject ? vm.chosenProject.name : \'projects\' }}_statistics.csv" title="{{ \'button.export\' | translate }}"><i class="fa fa-file-excel-o fa-2"></i></md-button></div></div><md-table-container><table md-table><thead md-head><tr md-row><th md-column>{{ \'statistics.name\' | translate }}</th><th md-column>{{ \'statistics.amountOfTons\' | translate }}</th><th md-column>{{ \'statistics.operationHours\' | translate }}</th><th md-column>{{ \'statistics.days\' | translate }}</th></tr></thead><tbody md-body><tr md-row ng-repeat="statistic in vm.statistics"><td md-cell>{{statistic.name}}</td><td md-cell>{{statistic.amountOfTons}}</td><td md-cell>{{statistic.operationHours}}</td><td md-cell>{{statistic.days}}</td></tr></tbody></table></md-table-container><div ng-if="vm.myChartObject.data" google-chart chart="vm.myChartObject" style="height:600px; width:100%;"></div>',controller:"AdminStatisticsProjectsService",controllerAs:"vm"}).state("admin.statistics.suppliers",{url:"/suppliers",template:'<div layout="row"><div flex="33" flex-gt-sm="25"><label>{{ \'project.startDate\' | translate }}</label><md-datepicker ng-model="vm.startDate" ng-change="vm.getBySupplier()" md-open-on-focus md-hide-icons="triangle"></md-datepicker></div><div flex="33" flex-gt-sm="25"><label>{{ \'project.endDate\' | translate }}</label><md-datepicker ng-model="vm.endDate" ng-change="vm.getBySupplier()" md-open-on-focus md-hide-icons="triangle"></md-datepicker></div><div flex="33" flex-gt-sm="50"><md-button class="md-fab md-mini btn-excel" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ng-csv="vm.export" filename="suppliers_statistics.csv" csv-header="[\'Company Name\', \'Amount Of Tons\']" title="{{ \'button.export\' | translate }}"><i class="fa fa-file-excel-o fa-2"></i></md-button></div></div><md-table-container><table md-table><thead md-head><tr md-row><th md-column>{{ \'statistics.name\' | translate }}</th><th md-column>{{ \'statistics.amountOfTons\' | translate }}</th></tr></thead><tbody md-body><tr md-row ng-repeat="statistic in vm.statistics"><td md-cell>{{statistic.supplier.companyName}}</td><td md-cell>{{statistic.amountOfTons}}</td></tr></tbody></table></md-table-container><div ng-if="vm.myChartObject.data" google-chart chart="vm.myChartObject" style="height:600px; width:100%;"></div>',
controller:"AdminStatisticsSuppliersCtrl",controllerAs:"vm"}).state("admin.logs",{url:"/logs",template:'<div class="table-responsive"><label>From:</label><md-datepicker ng-model="vm.startDate" ng-change="vm.changeDate()" md-open-on-focus md-hide-icons="triangle" aria-label="Selected date"></md-datepicker><label>To:</label><md-datepicker ng-model="vm.endDate" ng-change="vm.changeDate()" md-open-on-focus md-hide-icons="triangle" aria-label="Selected date"></md-datepicker><label>Type:</label><md-input-container><md-select ng-model="vm.type" ng-change="vm.changeDate()"><md-option ng-repeat="type in vm.types" value="{{type}}">{{type}}</md-option></md-select></md-input-container><hr><md-table-container flex layout-padding><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="type">{{ \'logs.type\' | translate }}</th><th md-column md-order-by="name">{{ \'logs.name\' | translate }}</th><th md-column md-order-by="method">{{ \'logs.method\' | translate }}</th><th md-column md-order-by="url">{{ \'logs.url\' | translate }}</th><th md-column md-order-by="date">{{ \'logs.date\' | translate }}</th></tr></thead><tbody md-body><tr md-row ng-repeat="log in vm.logs | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{ log.type }}</td><td md-cell>{{ log.name }}</td><td md-cell>{{ log.method }}</td><td md-cell>{{ log.url }}</td><td md-cell>{{ log.date | date : vm.dateFormat}}</td><td md-cell><md-button ng-if="log.body" ng-click="vm.toggleDetail(log.body)" class="md-fab md-mini" title="Show Detail"><i class="fa fa-info fa-2"></i></md-button></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.logs.length }}" md-page-select></md-table-pagination><md-sidenav class="md-sidenav-left" style="position: relative; width-max: 100%; width: 100%" md-component-id="left" md-disable-backdrop md-whiteframe="4"><md-toolbar class="md-theme-indigo"><div layout="row"><span class="md-toolbar-tools">Log Detail</span> <button aria-label="Close detail" layout-align="right center" class="md-icon-button md-button" ng-click="vm.toggleDetail()"><i class="fa fa-close fa-2"></i></button></div></md-toolbar><md-content layout-margin><pre ng-if="vm.body">{{ vm.body | json }}</pre></md-content></md-sidenav></div>',controller:"AdminLogsCtrl",controllerAs:"vm",onEnter:["userService","$state",function(e,t){3==e.getUserRole()&&t.go("permissionDenied")}]})}e.$inject=["$stateProvider"],angular.module("heaterSiloM2M.routing").config(e)}(),function(){angular.module("heaterSiloM2M").constant("configService",{defaultLocale:"de",getApiUri:"http://5.148.165.8/api",userSuperRoles:[{id:1,name:"Super Admin"},{id:2,name:"Admin"}],userRoles:[{id:2,name:"Admin"},{id:3,name:"Employee"},{id:4,name:"Supplier"},{id:5,name:"PM(admin)"},{id:6,name:"PM"}],userPMRoles:[{id:6,name:"PM"}],permissionsEmployee:{projectsAll:{read:!0,write:!0},projectsOwner:{read:!0,write:!0},devices:{read:!0,write:!0}},permissionsPM:{status:{read:!0},alarm:{read:!0},operatingHours:{read:!0},ashLevel:{read:!0}},daysOfWeek:[{id:1,name:"dayOfWeek.monday"},{id:2,name:"dayOfWeek.tuesday"},{id:3,name:"dayOfWeek.wednesday"},{id:4,name:"dayOfWeek.thursday"},{id:5,name:"dayOfWeek.friday"},{id:6,name:"dayOfWeek.saturday"},{id:7,name:"dayOfWeek.sunday"}],dateFormat:"H:mm dd/MM/yyyy",logDateFormat:"H:mm:ss dd/MM/yyyy",notNeedAuthentication:["login","forgot","reset","dataCollection","permissionDenied"]})}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e){function t(){var t=e.getUserRole(),n=e.getUserPermisions();return{silo:{sref:"silo",permission:5==t||6==t},heater:{sref:"heater",permission:4==t},supplier:{sref:"supplier",permission:4!=t},supplierSilos:{sref:"supplier.silos",value:"header.silos",permission:4!=t},supplierOrders:{sref:"supplier.orders",value:"header.orders",permission:4!=t},pm:{sref:"pm",permission:!(5==t||6==t)},pmProjects:{sref:"pm.projects",value:"header.projects",permission:!(5==t||6==t)},pmHeaters:{sref:"pm.heaters",value:"header.heaters",permission:!(5==t||6==t)},pmUsers:{sref:"pm.users",value:"header.users",permission:5!=t,menu:{all:{sref:"pm.users.all",value:"admin.all"},create:{sref:"pm.users.create",value:"admin.create"}}},superAdmin:{sref:"superAdmin",value:"header.superAdmin",permission:1!=t,submenu:{logout:{sref:"superAdmin.logout",value:"header.logout"}},menu:{config:{sref:"superAdmin.config",value:"admin.config"},adminUsers:{sref:"superAdmin.adminUsers",value:"admin.adminUsers",menu:{all:{sref:"superAdmin.adminUsers.all",value:"admin.all"},create:{sref:"superAdmin.adminUsers.create",value:"admin.create"}}},companies:{sref:"superAdmin.companies",value:"admin.companies",menu:{all:{sref:"superAdmin.companies.all",value:"admin.all"},create:{sref:"superAdmin.companies.create",value:"admin.create"}}},logs:{sref:"superAdmin.logs",value:"admin.logs"}}},admin:{sref:"admin",value:2==t?"header.admin":"header.employee",permission:!(2==t||3==t),menu:{company:{sref:"admin.company",value:"admin.company",permission:3==t},users:{sref:"admin.users",value:"admin.users",permission:3==t,menu:{all:{sref:"admin.users.all",value:"admin.all"},create:{sref:"admin.users.create",value:"admin.create"}}},customers:{sref:"admin.customers",value:"admin.customers",permission:3==t,menu:{all:{sref:"admin.customers.all",value:"admin.all"},create:{sref:"admin.customers.create",value:"admin.create"}}},projects:{sref:"admin.projects",value:"admin.projects",permission:3==t&&n&&!n.projectsAll.read&&!n.projectsOwner.read,menu:{all:{sref:"admin.projects.all",value:"admin.all"},create:{sref:"admin.projects.create",value:"admin.create",permission:3==t&&n&&!n.projectsAll.write},schedule:{sref:"admin.projects.schedule",value:"admin.schedule"}}},devices:{sref:"admin.devices",value:"admin.devices",permission:3==t&&n&&!n.devices.read,menu:{all:{sref:"admin.devices.all",value:"admin.all"},create:{sref:"admin.devices.create",value:"admin.create",permission:3==t&&n&&!n.devices.write}}},orders:{sref:"admin.orders",value:"admin.orders",menu:{all:{sref:"admin.orders.all",value:"admin.all"},create:{sref:"admin.orders.create",value:"admin.create"}}},statistics:{sref:"admin.statistics",value:"admin.statistics",menu:{all:{sref:"admin.statistics.projects",value:"admin.projects"},create:{sref:"admin.statistics.suppliers",value:"admin.suppliers"}}},logs:{sref:"admin.logs",value:"admin.logs",permission:3==t}}},myAccount:{sref:"myAccount",value:"header.myAccount",permission:1==t,submenu:{settings:{sref:"myAccount.settings",value:"user.settings"},logout:{sref:"myAccount.logout",value:"header.logout"}}}}}function n(e){function n(e,t){var a=void 0;for(var r in e)if(e[r].sref===t?a=e[r]:"object"===_typeof(e[r])&&(a=n(e[r],t)),a)break;return a}var a=t(),r=n(a,e),o=r&&r.permission;return void 0===o||!o}this.getMain=t,this.getPermission=n}angular.module("heaterSiloM2M").service("menuService",e),e.$inject=["userService"]}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(){function e(){var e=function(){function e(t){_classCallCheck(this,e),angular.extend(this,t),"string"==typeof this.startDate&&(this.startDate=new Date(this.startDate)),"string"==typeof this.endDate&&(this.endDate=new Date(this.endDate))}return _createClass(e,[{key:"addSparePart",value:function(e){e=e||"",this.spareParts instanceof Array?this.spareParts.push(e):this.spareParts=[e]}},{key:"removeSparePart",value:function(e){this.spareParts.splice(e,1)}},{key:"toJSON",value:function(){var e={};for(var t in this)"startDate"!==t&&"endDate"!==t?e[t]=this[t]:e[t]=moment(this[t]).utc().toJSON();return e}}]),e}();return e}angular.module("heaterSiloM2M").factory("CRURecord",e)}(),function(){function e(e,t,n){function a(){return e.get(t.getApiUri+"/crus").then(function(e){return e.data},s)}function r(n){return e.get(t.getApiUri+"/crusForDevice/"+n).then(function(e){return e.data},s)}function o(n){return e.get(t.getApiUri+"/cru?id="+n).then(function(e){return e.data},s)}function i(n){return e.post(t.getApiUri+"/cru",n).then(function(e){return e.data},s)}function l(n){return e.put(t.getApiUri+"/cru",n).then(function(e){return e.data},s)}function s(e){500===e.status&&n.show({type:"error",content:e.message})}var d={getAll:a,getAllForDevice:r,get:o,create:i,update:l};return d}angular.module("heaterSiloM2M").factory("cruRequest",e),e.$inject=["$http","configService","Toast"]}();var _slicedToArray=function(){function e(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function e(e,t,n,a,r,o,i,l,s){function d(e){var t=_slicedToArray(e,3),n=t[0],a=t[1],r=t[2],o=r?r.length:0;n&&a&&(n>a&&(v.record.endDate=moment(n).clone().toDate()),v.record.totalTime=m(n,a)*o)}function m(e,t){for(var n=0,a=moment(e);a<=t;){var r=u(a);r>=g&&r<f&&n++,a.add(1,"m")}return n-1}function c(){r.getAllEmployees().then(function(e){v.employees=e})}function u(e){return e=moment(e),e.hour()+e.minute()/60}var p=o.getCompanySync(),v=this;v.title="cruRecordDialogCtrl",v.state=s,v.reasons=["assembly","disassembly","planned_service","service_repair","alarm"],v.maxSpareParts=10,v.record=new n(i||{deviceId:l,employees:[]}),v.save=function(e){a[s](e).then(function(e){t.hide(e)})},v.cancel=t.hide,v.computeTotalTime=d,~["create","update"].indexOf(v.state)&&e.$watchGroup([function(){return v.record.startDate},function(){return v.record.endDate},function(){return v.record.employees}],d);var g=u(p.officeTime.startTime.toDate()),f=u(p.officeTime.endTime.toDate());e.hasSpareParts=!(!v.record.spareParts||!v.record.spareParts.length),e.$watch("hasSpareParts",function(e){e&&!v.record.spareParts&&v.record.addSparePart()}),c()}e.$inject=["$scope","$mdDialog","CRURecord","cruRequest","adminUserService","companyService","record","deviceId","state"],angular.module("heaterSiloM2M").controller("cruRecordDialogCtrl",e)}(),function(){function e(e){function t(){e.getHeaterDataCollection().then(function(e){n.data=e})}var n=this;t(),n.deleteAllDataCollection=function(){n.data=null,e.deleteAllHeaterDataCollection()}}angular.module("heaterSiloM2M").controller("DataCollectionCtrl",e),e.$inject=["adminDeviceService"]}(),function(){function e(e,t,n){function a(){n.getCompany().then(function(e){r.company=e})}var r=this;a(),e.$on("user.authenticate",function(e,t){t?a():r.company=null})}e.$inject=["$rootScope","userService","companyService"],angular.module("heaterSiloM2M").controller("FooterCtrl",e)}(),function(){function e(e,t,n){function a(){var e=t.currentUser();n.getCompany().then(function(e){r.companyLogo=e.logo}),r.username=e&&(e.username||e.name),r.isLoggedIn=t.isLoggedIn()}var r=this;a(),e.$on("user.authenticate",function(e,t){t?a():r.companyLogo=null})}e.$inject=["$rootScope","userService","companyService"],angular.module("heaterSiloM2M").controller("HeaderCtrl",e)}(),function(){function e(e,t,n,a,r,o,i,l,s,d){function m(){s.getCompany().then(function(e){u.operationsServiceTime=e.operationsServiceTime,u.heater=new a(d),u.heater.ashLevel=(u.heater.operationHours-u.operationsServiceTime*u.heater.operationsService)/u.operationsServiceTime*100,u.heater.customer&&u.heater.customer.officeTime&&u.heater.customer.officeTime.daysOfWeek.forEach(function(e){u.daysOfWeek.push(l.daysOfWeek.find(function(t){return t.id==e}).name)}),u.scheduleData=u.heater.getSchedule()})}function c(){n.getHeater(d._id).then(function(e){u.scheduleData=new a(e).getSchedule()})}var u=this;u.title="HeaterCtrl";var p=r.currentUser();5!=p.roleId&&6!=p.roleId||o.getCustomer(p.customer).then(function(e){u.permissions=e.permissions}),u.daysOfWeek=[],u.updateChart=c,u.changeStatus=function(){i.changeStatus(u.heater).then(function(e){u.heater.status=e.status})},u.changeOperationHours=function(){i.changeOperationHours(u.heater).then(function(e){u.heater.operationsServiceStatus=e.operationsServiceStatus,u.heater.periodicServiceStatus=e.periodicServiceStatus,u.heater.ashLevel=(e.operationHours-u.operationsServiceTime*e.operationsService)/u.operationsServiceTime*100})},u.sendAlert=function(){i.sendAlert(u.heater).then(function(e){u.heater.alert=e.alert})},u.confirmAlert=function(){i.confirmAlert(u.heater).then(function(e){u.heater.alert=e.alert})},u.sendServicePeriodic=function(){i.sendService(u.heater,"periodic").then(function(e){u.heater.periodicServiceStatus=e.periodicServiceStatus})},u.confirmServicePeriodic=function(){i.confirmService(u.heater,"periodic").then(function(e){u.heater.periodicServiceStatus=e.periodicServiceStatus})},u.sendServiceOperations=function(){i.sendService(u.heater,"operations").then(function(e){u.heater.operationsServiceStatus=e.operationsServiceStatus})},u.confirmServiceOperations=function(){i.confirmService(u.heater,"operations").then(function(e){u.heater.operationsServiceStatus=e.operationsServiceStatus})},m()}e.$inject=["$state","$stateParams","adminDeviceService","Heater","userService","adminCustomerService","HeaterService","configService","adminCompanyService","heater"],angular.module("heaterSiloM2M").controller("HeaterCtrl",e)}(),function(){function e(e,t){var n=function(n){return e.post(t.getApiUri+"/heaterChangeOperationHours",{id:n._id,operationHours:n.operationHours}).then(function(e){return e.data})},a=function(n){return e.post(t.getApiUri+"/heaterChangeStatus",{id:n._id}).then(function(e){return e.data})},r=function(n){return e.post(t.getApiUri+"/heaterSendAlert",{id:n._id}).then(function(e){return e.data})},o=function(n){return e.post(t.getApiUri+"/heaterConfirmAlert",{id:n._id}).then(function(e){return e.data})},i=function(n,a){return e.post(t.getApiUri+"/heaterSendService",{id:n._id,type:a}).then(function(e){return e.data})},l=function(n,a){return e.post(t.getApiUri+"/heaterConfirmService",{id:n._id,type:a}).then(function(e){return e.data})};return{sendAlert:r,confirmAlert:o,sendService:i,confirmService:l,changeStatus:a,changeOperationHours:n}}angular.module("heaterSiloM2M").factory("HeaterService",e),e.$inject=["$http","configService"]}(),function(){function e(e){e.state("pm",{url:"/pm",template:"<ui-view/>",deepStateRedirect:{default:{state:"pm.heaters"}}}).state("pm.users",{url:"/users",template:'<div class="container"><div layout="row" layout-xs="column"><div layout="column" flex="10" flex-xs="100"><side-nav-bar items="vm.navBar"></side-nav-bar></div><div layout="column" flex="90" flex-xs="100"><div ui-view></div></div></div></div>',controller:["menuService",function(e){this.navBar=Object.values(e.getMain().pmUsers.menu)}],controllerAs:"vm",defaultSubstate:"pm.users.all"}).state("pm.users.all",{url:"/all",template:'<md-table-container><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="username">{{ \'user.username\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr md-row ng-repeat="user in vm.getAllUsers | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{user.username}}</td><td md-cell><div class="actions"><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.update(user._id)" title="{{ \'button.update\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button><md-button class="md-fab md-mini md-warn" ng-click="vm.remove(user)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.getAllUsers.length }}" md-page-select></md-table-pagination>',controller:"pmUsersAllCtrl",controllerAs:"vm"}).state("pm.users.create",{url:"/create",template:'<form name="userForm"><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.username\' | translate }}</label> <input type="email" ng-model="vm.user.username" ng-pattern="/^.+@.+\\..+$/" maxlength="300" required autofocus></md-input-container></div><div layout-gt-sm="row"><md-input-container ng-if="vm.state==\'create\'" class="md-block" flex-gt-xs><label>{{ \'user.password\' | translate }}</label> <input name="password" type="password" ng-model="vm.user.password" pattern=".{6,}" required autocomplete="new-password"><div ng-messages="userForm.password.$error"><div ng-message="pattern">{{ \'user.validation.password\' | translate }}</div></div></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm><label>{{ \'user.preferredLanguage\' | translate }}</label><md-select ng-model="vm.user.preferredLanguage"><md-option value="en">EN</md-option><md-option value="de">DE</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.realName\' | translate }}</label> <input ng-model="vm.user.realName" maxlength="100"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.phone\' | translate }}</label> <input ng-model="vm.user.phone" maxlength="30"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.user.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.user.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.user.address.streetNr" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.user.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.user.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><br><md-button ng-disabled="userForm.$invalid" ng-click="vm.save(vm.user)" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}"><span ng-show="vm.state==\'create\'">{{ \'button.create\' | translate }}</span> <span ng-show="vm.state==\'update\'">{{ \'button.update\' | translate }}</span></md-button></form>',controller:"pmUsersCreateCtrl",controllerAs:"vm"}).state("pm.users.update",{url:"/update/:id",template:'<form name="userForm"><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.username\' | translate }}</label> <input type="email" ng-model="vm.user.username" ng-pattern="/^.+@.+\\..+$/" maxlength="300" required autofocus></md-input-container></div><div layout-gt-sm="row"><md-input-container ng-if="vm.state==\'create\'" class="md-block" flex-gt-xs><label>{{ \'user.password\' | translate }}</label> <input name="password" type="password" ng-model="vm.user.password" pattern=".{6,}" required autocomplete="new-password"><div ng-messages="userForm.password.$error"><div ng-message="pattern">{{ \'user.validation.password\' | translate }}</div></div></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm><label>{{ \'user.preferredLanguage\' | translate }}</label><md-select ng-model="vm.user.preferredLanguage"><md-option value="en">EN</md-option><md-option value="de">DE</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.realName\' | translate }}</label> <input ng-model="vm.user.realName" maxlength="100"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.phone\' | translate }}</label> <input ng-model="vm.user.phone" maxlength="30"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.user.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.user.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.user.address.streetNr" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.user.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.user.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><br><md-button ng-disabled="userForm.$invalid" ng-click="vm.save(vm.user)" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}"><span ng-show="vm.state==\'create\'">{{ \'button.create\' | translate }}</span> <span ng-show="vm.state==\'update\'">{{ \'button.update\' | translate }}</span></md-button></form>',params:{id:null},controller:"pmUsersUpdateCtrl",controllerAs:"vm"}).state("pm.heaters",{url:"/heaters",template:'<div class="container"><div ng-if="vm.getAllHeaters && vm.getAllHeaters.length"><md-table-container><table md-table><thead md-head md-order="vm.query.order"><tr><th md-column md-order-by="serial">{{ \'device.serial\' | translate }}</th><th md-column>{{ \'device.address\' | translate }}</th><th md-column ng-if="!vm.permissions || vm.permissions.status.read">{{ \'device.status\' | translate }}</th><th md-column ng-if="!vm.permissions || vm.permissions.alarm.read">{{ \'device.alert\' | translate }}</th><th md-column ng-if="!vm.permissions || vm.permissions.operatingHours.read" md-order-by="operationHours">{{ \'device.operationHours\' | translate }}</th><th md-column ng-if="!vm.permissions || vm.permissions.ashLevel.read">{{ \'device.ashLevel\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr ng-repeat="heater in vm.getAllHeaters | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{heater.serial}}</td><td md-cell><span>{{heater.object.location.address.country}}</span> <span>{{heater.object.location.address.town}}</span> <span>{{heater.object.location.address.streetNr}}</span> <span>{{heater.object.location.address.zip}}</span></td><td md-cell ng-if="!vm.permissions || vm.permissions.status.read"><span ng-if="heater.status" class="round-box statusOn">{{ \'device.on\' | translate }}</span> <span ng-if="!heater.status" class="round-box">{{ \'device.off\' | translate }}</span></td><td md-cell ng-if="!vm.permissions || vm.permissions.alarm.read"><span ng-if="heater.alert" class="round-box alertYes">{{ \'device.yes\' | translate }}</span> <span ng-if="!heater.alert" class="round-box">{{ \'device.no\' | translate }}</span></td><td md-cell ng-if="!vm.permissions || vm.permissions.operatingHours.read"><span ng-if="heater.operationHours">{{ heater.operationHours }}</span></td><td md-cell ng-if="!vm.permissions || vm.permissions.ashLevel.read"><div class="meter"><span style="width: {{heater.ashLevel}}%" ng-class="{ orange: heater.ashLevel < 70 && heater.ashLevel >= 50, red: heater.ashLevel >= 70 }"></span></div></td><td md-cell><div class="actions"><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ng-click="vm.viewHeater(heater)" title="{{ \'button.view\' | translate }}"><i class="fa fa-info fa-2"></i></md-button></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.getAllHeaters.length }}" md-page-select></md-table-pagination></div><p ng-if="!(vm.getAllHeaters && vm.getAllHeaters.length)">{{\'device.no_found\' | translate}}</p></div>',controller:"pmHeatersAllCtrl",controllerAs:"vm"}).state("pm.projects",{url:"/projects",template:'<div class="container"><div ng-if="vm.getAllProjects && vm.getAllProjects.length"><md-table-container><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="name">{{ \'project.name\' | translate }}</th><th md-column md-order-by="startDate">{{ \'project.startDate\' | translate }}</th><th md-column md-order-by="endDate">{{ \'project.endDate\' | translate }}</th><th md-column md-order-by="archive">{{ \'project.archive\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr ng-if="!vm.permissionRead || project.permissionRead" md-row ng-repeat="project in vm.getAllProjects | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{project.name}}</td><td md-cell>{{project.startDate | date}}</td><td md-cell>{{project.endDate | date}}</td><td md-cell><span ng-if="project.archive" class="round-box">{{ \'project.yes\' | translate }}</span> <span ng-if="!project.archive" class="round-box statusOn">{{ \'project.no\' | translate }}</span></td><td md-cell><div class="actions"><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ui-sref="pm.project({ id: project._id})" title="{{ \'button.view\' | translate }}"><i class="fa fa-info fa-2"></i></md-button></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.getAllProjects.length }}" md-page-select></md-table-pagination></div><p ng-if="!(vm.getAllProjects && vm.getAllProjects.length)">{{\'project.no_found\' | translate}}</p></div>',controller:"pmProjectsAllCtrl",controllerAs:"vm"}).state("pm.project",{url:"/project/:id",template:'<div class="container"><section layout="row" layout-align="space-between" class="control-bar"><div layout="row" layout-align="left center"><md-input-container><label>{{\'schedule.from\'| translate}}</label><md-datepicker ng-model="vm.options.fromDate" md-max-date="vm.options.toDate" md-open-on-focus md-hide-icons="triangle" aria-label="Start date range"></md-datepicker></md-input-container><md-input-container><label>{{\'schedule.to\'| translate}}</label><md-datepicker ng-model="vm.options.toDate" md-min-date="vm.options.fromDate" md-open-on-focus md-hide-icons="triangle" aria-label="End date range"></md-datepicker></md-input-container><md-input-container class="scale-select"><label>{{\'schedule.scale\'| translate}}</label><md-select ng-model="vm.options.scale" aria-label="Scale"><md-option ng-repeat="scale in [\'month\', \'week\', \'day\']" ng-value="scale">{{scale | translate}}</md-option></md-select><div class="errors"></div></md-input-container><md-button ng-if="vm.project.reminderDate" ng-click="vm.resetChart()">Reset</md-button></div></section><section layout-margin="3px" layout="row" class="schedule-container"><main-schedule flex allow-resizing="vm.allowResizing" ng-if="vm.project" data="vm.project" options="vm.options"></main-schedule></section><md-button ng-if="vm.project.reminderDate" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.confirm()">{{ \'button.confirm\' | translate }}</md-button><md-button ng-if="vm.project.reminderDate" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.prolong()">{{ \'button.prolong\' | translate }}</md-button></div>',params:{id:null},controller:"ProjectCtrl",controllerAs:"vm",onEnter:["$stateParams","$state",function(e,t){e.id||t.go("pm.projects")}],resolve:{project:["adminProjectService","$stateParams","$state",function(e,t,n){return e.get(t.id).catch(function(){n.go("404",{},{location:"replace"})})}]}})}e.$inject=["$stateProvider"],angular.module("heaterSiloM2M.routing").config(e)}();var _slicedToArray=function(){function e(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function e(e,t,n,a,r,o,i,l,s,d,m,c,u,p){function v(e){g.isChanged=!1,g.project=new c(p),g.allowResizing.future=g.project.reminderDate,e&&e()}var g=this,f=r.get("projectScheduleOpts");g.title="ProjectCtrl",g.allowResizing={past:0,future:0},g.options={treeTableColumns:[],width:800,columnWidth:25,rowContent:"{{row.model.title}}",taskContent:"{{task.model.title}}",groupDisplayMode:"group",taskOutOfRange:"none",columnMagnet:"1 day",daily:!0,allowSideResizing:!1,keepAncestorOnFilterRow:!0,expandToFit:!0,shrinkToFit:!1,sideWidth:200,fromDate:f&&f.fromDate&&new Date(f.fromDate),toDate:f&&f.toDate&&new Date(f.toDate),scale:f&&f.scale||"day",readOnly:!g.allowResizing.past||!g.allowResizing.future,hideActions:!0,headersFormats:{month:function(e){return moment(e.date).format("MMMM")}},tooltip:{content:"{{task.model.title}}</br>\n                  <small>\n                    {{task.isMilestone() === true && getFromLabel() || getFromLabel() + ' - ' + getToLabel()}}\n                  </small>"}},g.resetChart=function(){l.reset()},v(),g.confirm=function(){o.confirm(g.project._id).then(function(e){g.project.reminderDate=e.reminderDate,g.allowResizing.future=g.project.reminderDate,u("project.toast.confirmEndProj").then(function(e){s.show({content:e,type:"success"})})})},g.prolong=function(){o.prolong(g.project).then(function(e){g.project.reminderDate=e.reminderDate,g.allowResizing.future=g.project.reminderDate,u("project.toast.prolongEndProj").then(function(e){s.show({content:e,type:"success"})})})},e.$watchGroup([function(){return g.options.fromDate},function(){return g.options.toDate},function(){return g.options.scale}],function(e){var t=_slicedToArray(e,3),n=t[0],a=t[1],o=t[2];r.set("projectScheduleOpts",{fromDate:n,toDate:a,scale:o})})}angular.module("heaterSiloM2M").controller("ProjectCtrl",e),e.$inject=["$scope","$state","$rootScope","$q","sessionStorageService","adminProjectService","adminDeviceService","Schedule","Toast","ganttDebounce","dialogService","Project","$translate","project"]}(),function(){function e(e,t,n,a,r,o,i){function l(){d.silo=new n(i),d.percent=d.silo.fillingLevel/d.silo.maxLoad*100,i.estimateTime&&(d.estimateDate=moment.duration(i.estimateTime)._data),d.silo.projects&&(d.scheduleData=d.silo.getSchedule())}function s(){e.getSilo(i._id).then(function(e){d.scheduleData=new n(e).getSchedule()})}var d=this;d.title="SiloCtrl",d.updateChart=s,d.dateFormat=r.dateFormat,l(),d.changeFillingLevel=function(){t.changeFillingLevel(d.silo).then(function(e){e.estimateTime?d.estimateDate=moment.duration(e.estimateTime)._data:d.estimateDate=null,d.percent=d.silo.fillingLevel/d.silo.maxLoad*100,0===e.reminderStatus&&d.percent<=50&&d.percent>30?t.sendReminder(e,d.percent,d.estimateDate).then(function(e){d.silo.reminderStatus=e.reminderStatus,d.silo.supplier&&o("device.messageFillingLevel50").then(function(e){a.show({content:e,type:"success"})})}):1==d.silo.reminderStatus&&d.percent<=30&&t.sendReminder(e,d.percent,d.estimateDate).then(function(e){d.silo.reminderStatus=e.reminderStatus,d.silo.supplier&&o("device.messageFillingLevel30").then(function(e){
a.show({content:e,type:"success"})})})})}}e.$inject=["adminDeviceService","SiloService","Silo","Toast","configService","$translate","silo"],angular.module("heaterSiloM2M").controller("SiloCtrl",e)}(),function(){function e(e,t){var n=function(n,a,r){return e.post(t.getApiUri+"/siloReminder",{id:n._id,percent:a,estimateDate:r}).then(function(e){return e.data})},a=function(n){return e.post(t.getApiUri+"/siloFillingLevel",{id:n._id,fillingLevel:n.fillingLevel}).then(function(e){return e.data})};return{sendReminder:n,changeFillingLevel:a}}angular.module("heaterSiloM2M").factory("SiloService",e),e.$inject=["$http","configService"]}(),function(){function e(e){e.state("superAdmin",{url:"/superAdmin",template:'<div class="_layout"><div class="container"><div layout="column"><main-nav-bar ng-if="vm.navBar" items="vm.navBar"></main-nav-bar><div ui-view></div></div></div></div>',controller:["menuService",function(e){this.navBar=Object.values(e.getMain().superAdmin.menu)}],controllerAs:"vm",deepStateRedirect:{default:{state:"superAdmin.config"}}}).state("superAdmin.logout",{onEnter:["$state","userService",function(e,t){t.logout(),e.go("login")}]}).state("superAdmin.config",{url:"/config",template:'<div layout="row"><form layout="column"><div layout="row" class="md-block"><md-input-container flex><label>{{ \'config.email\' | translate }}</label> <input type="text" ng-model="vm.config.email" ng-pattern="/^.+@.+\\..+$/"></md-input-container></div><md-card layout-padding="5px"><md-card-title><h3>{{ \'config.smtp\' | translate }}</h3></md-card-title><div layout="row"><md-input-container><label>{{ \'config.host\' | translate }}</label> <input type="text" ng-model="vm.config.smtp.host"></md-input-container><md-input-container><label>{{ \'config.user\' | translate }}</label> <input type="email" ng-model="vm.config.smtp.auth.user"></md-input-container><md-input-container><label>{{ \'config.pass\' | translate }}</label> <input type="text" ng-model="vm.config.smtp.auth.pass"></md-input-container></div></md-card><div layout="row"><md-button class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.updateConfig(vm.config)">{{ \'button.update\' | translate }}</md-button></div></form></div>',controller:"AdminConfigCtrl",controllerAs:"vm"}).state("superAdmin.adminUsers",{url:"/adminUsers",template:'<div class="container"><div layout="row" layout-xs="column"><div layout="column" flex="10" flex-xs="100"><side-nav-bar items="vm.navBar"></side-nav-bar></div><div layout="column" flex="90" flex-xs="100"><div ui-view></div></div></div></div>',controller:["menuService",function(e){this.navBar=Object.values(e.getMain().superAdmin.menu.adminUsers.menu)}],controllerAs:"vm",defaultSubstate:"superAdmin.adminUsers.all"}).state("superAdmin.adminUsers.all",{url:"/all",template:'<md-table-container><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="username">{{ \'user.username\' | translate }}</th><th md-column md-order-by="company">{{ \'user.company\' | translate }}</th><th md-column md-order-by="role">{{ \'user.role\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr md-row ng-repeat="user in vm.getAllUsers | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{user.username}}</td><td md-cell>{{user.company[\'name\']}}</td><td md-cell>{{user.role[\'name\']}}</td><td md-cell><div class="actions"><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.update(user._id)" title="{{ \'button.update\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button><md-button ng-if="user._id != vm.currentUser._id" class="md-fab md-mini md-warn" ng-click="vm.remove(user)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.getAllUsers.length }}" md-page-select></md-table-pagination>',controller:"AdminAdminUsersAllCtrl",controllerAs:"vm"}).state("superAdmin.adminUsers.create",{url:"/create",template:'<form name="userForm"><div layout-gt-sm="row"><md-input-container class="md-block angular-animate" flex-gt-xs><label>{{ \'user.username\' | translate }}</label> <input name="email" type="email" ng-model="vm.user.username" ng-pattern="/^.+@.+\\..+$/" maxlength="300" required autofocus><div ng-messages="userForm.email.$error"><div ng-message="unique">{{ \'validation.name\' | translate }}</div></div></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.realName\' | translate }}</label> <input ng-model="vm.user.realName" maxlength="100" required></md-input-container></div><div layout-gt-sm="row"><md-input-container ng-if="vm.state==\'create\'" class="md-block angular-animate" flex-gt-xs><label>{{ \'user.password\' | translate }}</label> <input name="password" type="password" ng-model="vm.user.password" pattern=".{6,}" required autocomplete="new-password"><div ng-messages="userForm.password.$error"><div ng-message="pattern">{{ \'user.validation.password\' | translate }}</div></div></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm ng-if="vm.state==\'create\' || vm.user._id != vm.currentUser._id"><md-select-label>{{ \'user.role\' | translate }}</md-select-label><md-select ng-model="vm.user.roleId" required><md-option ng-repeat="role in vm.userRoles" value="{{role.id}}">{{role.name}}</md-option></md-select></md-input-container><md-input-container class="md-block" flex-gt-sm><md-select-label>{{ \'user.preferredLanguage\' | translate }}</md-select-label><md-select ng-model="vm.user.preferredLanguage"><md-option value="en">EN</md-option><md-option value="de">DE</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm ng-if="vm.user.roleId != 1 && (vm.routerState ==\'superAdmin.adminUsers.create\' || vm.routerState ==\'superAdmin.adminUsers.update\')"><md-select-label>{{ \'user.company\' | translate }}</md-select-label><md-select ng-model="vm.user.companyId" required><md-option ng-repeat="company in vm.getAllCompanies" value="{{company._id}}">{{company.name}}</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs ng-if="vm.user.roleId == 4"><label>{{ \'user.company\' | translate }}</label> <input ng-model="vm.user.companyName" maxlength="60" required></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.phone\' | translate }}</label> <input ng-model="vm.user.phone" maxlength="30"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.user.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.user.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.user.address.streetNr" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.user.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.user.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><md-table-container ng-if="vm.user.roleId == 3"><table md-table><thead md-head><tr md-row><th md-column>{{ \'permission.name\' | translate }}</th><th md-column>{{ \'permission.read\' | translate }}</th><th md-column>{{ \'permission.write\' | translate }}</th></tr></thead><tbody md-body><tr><td md-cell>{{\'permission.projectsAll\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsAll.read" ng-disabled="vm.user.permissions.projectsAll.write && vm.user.permissions.projectsAll.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsAll.write" ng-disabled="!vm.user.permissions.projectsAll.write && !vm.user.permissions.projectsAll.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.projectsOwner\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsOwner.read" ng-disabled="vm.user.permissions.projectsOwner.write && vm.user.permissions.projectsOwner.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsOwner.write" ng-disabled="!vm.user.permissions.projectsOwner.write && !vm.user.permissions.projectsOwner.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.devices\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.devices.read" ng-disabled="vm.user.permissions.devices.write && vm.user.permissions.devices.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.devices.write" ng-disabled="!vm.user.permissions.devices.write && !vm.user.permissions.devices.read"></md-checkbox></md-input-container></td></tr></tbody></table></md-table-container><div layout-gt-sm="row" ng-if="vm.user.roleId == 5 || vm.user.roleId == 6"><md-input-container class="md-block" flex-gt-sm><label>{{ \'user.customer\' | translate }}</label><md-select name="customer" ng-model="vm.user.customer" required validation-customer pms-admin="vm.pmsAdmin" pms-role="vm.user.roleId"><md-option ng-repeat="customer in vm.customers" value="{{customer._id}}">{{customer.name}}</md-option></md-select><div ng-messages="userForm.customer.$error"><div ng-message="customer">{{ \'user.validation.customer\' | translate }}</div></div></md-input-container></div><br><md-button ng-disabled="userForm.$invalid" ng-click="vm.save(vm.user)" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}"><span ng-show="vm.state==\'create\'">{{ \'button.create\' | translate }}</span> <span ng-show="vm.state==\'update\'">{{ \'button.update\' | translate }}</span></md-button></form>',controller:"AdminAdminUsersCreateCtrl",controllerAs:"vm"}).state("superAdmin.adminUsers.update",{url:"/update/:id",template:'<form name="userForm"><div layout-gt-sm="row"><md-input-container class="md-block angular-animate" flex-gt-xs><label>{{ \'user.username\' | translate }}</label> <input name="email" type="email" ng-model="vm.user.username" ng-pattern="/^.+@.+\\..+$/" maxlength="300" required autofocus><div ng-messages="userForm.email.$error"><div ng-message="unique">{{ \'validation.name\' | translate }}</div></div></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.realName\' | translate }}</label> <input ng-model="vm.user.realName" maxlength="100" required></md-input-container></div><div layout-gt-sm="row"><md-input-container ng-if="vm.state==\'create\'" class="md-block angular-animate" flex-gt-xs><label>{{ \'user.password\' | translate }}</label> <input name="password" type="password" ng-model="vm.user.password" pattern=".{6,}" required autocomplete="new-password"><div ng-messages="userForm.password.$error"><div ng-message="pattern">{{ \'user.validation.password\' | translate }}</div></div></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm ng-if="vm.state==\'create\' || vm.user._id != vm.currentUser._id"><md-select-label>{{ \'user.role\' | translate }}</md-select-label><md-select ng-model="vm.user.roleId" required><md-option ng-repeat="role in vm.userRoles" value="{{role.id}}">{{role.name}}</md-option></md-select></md-input-container><md-input-container class="md-block" flex-gt-sm><md-select-label>{{ \'user.preferredLanguage\' | translate }}</md-select-label><md-select ng-model="vm.user.preferredLanguage"><md-option value="en">EN</md-option><md-option value="de">DE</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm ng-if="vm.user.roleId != 1 && (vm.routerState ==\'superAdmin.adminUsers.create\' || vm.routerState ==\'superAdmin.adminUsers.update\')"><md-select-label>{{ \'user.company\' | translate }}</md-select-label><md-select ng-model="vm.user.companyId" required><md-option ng-repeat="company in vm.getAllCompanies" value="{{company._id}}">{{company.name}}</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs ng-if="vm.user.roleId == 4"><label>{{ \'user.company\' | translate }}</label> <input ng-model="vm.user.companyName" maxlength="60" required></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'user.phone\' | translate }}</label> <input ng-model="vm.user.phone" maxlength="30"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.user.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.user.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.user.address.streetNr" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.user.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.user.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><md-table-container ng-if="vm.user.roleId == 3"><table md-table><thead md-head><tr md-row><th md-column>{{ \'permission.name\' | translate }}</th><th md-column>{{ \'permission.read\' | translate }}</th><th md-column>{{ \'permission.write\' | translate }}</th></tr></thead><tbody md-body><tr><td md-cell>{{\'permission.projectsAll\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsAll.read" ng-disabled="vm.user.permissions.projectsAll.write && vm.user.permissions.projectsAll.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsAll.write" ng-disabled="!vm.user.permissions.projectsAll.write && !vm.user.permissions.projectsAll.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.projectsOwner\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsOwner.read" ng-disabled="vm.user.permissions.projectsOwner.write && vm.user.permissions.projectsOwner.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.projectsOwner.write" ng-disabled="!vm.user.permissions.projectsOwner.write && !vm.user.permissions.projectsOwner.read"></md-checkbox></md-input-container></td></tr><tr><td md-cell>{{\'permission.devices\' | translate}}</td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.devices.read" ng-disabled="vm.user.permissions.devices.write && vm.user.permissions.devices.read"></md-checkbox></md-input-container></td><td md-cell><md-input-container><md-checkbox ng-model="vm.user.permissions.devices.write" ng-disabled="!vm.user.permissions.devices.write && !vm.user.permissions.devices.read"></md-checkbox></md-input-container></td></tr></tbody></table></md-table-container><div layout-gt-sm="row" ng-if="vm.user.roleId == 5 || vm.user.roleId == 6"><md-input-container class="md-block" flex-gt-sm><label>{{ \'user.customer\' | translate }}</label><md-select name="customer" ng-model="vm.user.customer" required validation-customer pms-admin="vm.pmsAdmin" pms-role="vm.user.roleId"><md-option ng-repeat="customer in vm.customers" value="{{customer._id}}">{{customer.name}}</md-option></md-select><div ng-messages="userForm.customer.$error"><div ng-message="customer">{{ \'user.validation.customer\' | translate }}</div></div></md-input-container></div><br><md-button ng-disabled="userForm.$invalid" ng-click="vm.save(vm.user)" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}"><span ng-show="vm.state==\'create\'">{{ \'button.create\' | translate }}</span> <span ng-show="vm.state==\'update\'">{{ \'button.update\' | translate }}</span></md-button></form>',params:{id:null},controller:"AdminAdminUsersUpdateCtrl",controllerAs:"vm",onEnter:["$stateParams","$state",function(e,t){e.id||t.go("superAdmin.adminUsers.all")}]}).state("superAdmin.companies",{url:"/companies",template:'<div class="container"><div layout="row" layout-xs="column"><div layout="column" flex="10" flex-xs="100"><side-nav-bar items="vm.navBar"></side-nav-bar></div><div layout="column" flex="90" flex-xs="100"><div ui-view></div></div></div></div>',controller:["menuService",function(e){this.navBar=Object.values(e.getMain().superAdmin.menu.companies.menu)}],controllerAs:"vm",defaultSubstate:"superAdmin.companies.all"}).state("superAdmin.companies.all",{url:"/all",template:'<md-table-container><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="name">{{ \'company.name\' | translate }}</th><th md-column md-order-by="email">{{ \'company.email\' | translate }}</th><th md-column md-order-by="phone">{{ \'company.phone\' | translate }}</th><th md-column>{{ \'company.logo\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr md-row ng-repeat="company in vm.getAllCompanies | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{company.name}}</td><td md-cell>{{company.email}}</td><td md-cell>{{company.phone}}</td><td md-cell><img style="width:100px; margin: 10px;" ng-show="!!company.logo" ngf-thumbnail="company.logo"></td><td md-cell><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.update(company._id)" title="{{ \'button.update\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button><md-button class="md-fab md-mini md-warn" ng-click="vm.remove(company)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.getAllCompanies.length }}" md-page-select></md-table-pagination>',controller:"AdminCompaniesAllCtrl",controllerAs:"vm"}).state("superAdmin.companies.create",{url:"/create",template:'<ng-form name="companyForm"><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.name\' | translate }}</label> <input ng-model="vm.company.name" maxlength="30" required autofocus></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.email\' | translate }}</label> <input type="email" ng-model="vm.company.email" ng-pattern="/^.+@.+\\..+$/" maxlength="60" required></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.phone\' | translate }}</label> <input ng-model="vm.company.phone" maxlength="30" required></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.company.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.company.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.company.address.streetNr" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.company.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.company.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><hr><div layout-gt-sm="row"><p style="margin: auto;" class="md-block" flex-gt-xs>{{ \'company.daysOfWeek\' | translate }}</p><md-input-container class="md-block" flex-gt-xs><md-select multiple="true" ng-model="vm.company.officeTime.daysOfWeek" placeholder="{{ \'input.pleaseSelect\' | translate }}"><md-option ng-value="day.id" ng-repeat="day in vm.daysOfWeek">{{ day.name | translate }}</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><div flex="50"><p>{{ \'company.startTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.officeTime.startTime"></div></div><div flex="50"><p>{{ \'company.endTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.officeTime.endTime"></div></div></div><hr><div layout-gt-sm="row"><div layout="column" flex="50"><p>{{ \'company.reminderTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.reminderTime"></div></div><div layout="column" flex="50"><p>{{ \'company.reminderProjTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.reminderProjTime"></div></div></div><hr><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.operationsServiceTime\' | translate }}</label> <input ng-model="vm.company.operationsServiceTime" pattern="\\d*" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.periodicServiceTime\' | translate }}</label> <input ng-model="vm.company.periodicServiceTime" pattern="\\d*" maxlength="30"></md-input-container></div><hr><div layout="row"><div layout="column" flex="50"><label>{{ \'company.logo\' | translate }}</label> <img style="width:200px;" ng-show="!!vm.company.logo" ngf-thumbnail="vm.company.logo"></div><div layout="column" flex><ng-form name="vm.upload_form"><div layout="row"><input class="upload-logo" type="file" ngf-select ng-model="vm.file" name="file" ngf-pattern="\'image/*\'" accept="image/*" ngf-max-size="2MB"><md-button ng-click="vm.selectFile()" class="md-raised md-primary md-fab" aria-label="Select logo file"><i class="fa fa-upload fa-2"></i></md-button><md-input-container flex layout="column" class="md-block" flex-gt-xs><input type="text" ng-model="vm.file.name" name="fileName" disabled="!vm.file"><div ng-messages="vm.upload_form.fileName.$error" md-auto-hide="false" role="alert"><div ng-message="maxSize">{{ \'company.maxSize\' | translate }}</div></div></md-input-container></div><md-button ng-disabled="!vm.file" class="md-raised" type="submit" ng-click="vm.submit()" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}">{{ \'button.upload\' | translate }}</md-button><span ng-if="vm.file">{{ \'company.upload\' | translate }}</span></ng-form></div></div><md-button ng-disabled="companyForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.saveCompany(vm.company)"><span ng-show="vm.state==\'create\'">{{ \'button.create\' | translate }}</span> <span ng-show="vm.state==\'update\'">{{ \'button.update\' | translate }}</span></md-button></ng-form>',controller:"AdminCompaniesCreateCtrl",controllerAs:"vm"}).state("superAdmin.companies.update",{url:"/update/:id",template:'<ng-form name="companyForm"><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.name\' | translate }}</label> <input ng-model="vm.company.name" maxlength="30" required autofocus></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.email\' | translate }}</label> <input type="email" ng-model="vm.company.email" ng-pattern="/^.+@.+\\..+$/" maxlength="60" required></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.phone\' | translate }}</label> <input ng-model="vm.company.phone" maxlength="30" required></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.company.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.company.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.company.address.streetNr" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.company.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.company.address.zip" pattern="\\d*" maxlength="15"></md-input-container></div><hr><div layout-gt-sm="row"><p style="margin: auto;" class="md-block" flex-gt-xs>{{ \'company.daysOfWeek\' | translate }}</p><md-input-container class="md-block" flex-gt-xs><md-select multiple="true" ng-model="vm.company.officeTime.daysOfWeek" placeholder="{{ \'input.pleaseSelect\' | translate }}"><md-option ng-value="day.id" ng-repeat="day in vm.daysOfWeek">{{ day.name | translate }}</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><div flex="50"><p>{{ \'company.startTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.officeTime.startTime"></div></div><div flex="50"><p>{{ \'company.endTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.officeTime.endTime"></div></div></div><hr><div layout-gt-sm="row"><div layout="column" flex="50"><p>{{ \'company.reminderTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.reminderTime"></div></div><div layout="column" flex="50"><p>{{ \'company.reminderProjTime\' | translate }} *</p><div uib-timepicker show-meridian="false" ng-model="vm.company.reminderProjTime"></div></div></div><hr><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.operationsServiceTime\' | translate }}</label> <input ng-model="vm.company.operationsServiceTime" pattern="\\d*" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'company.periodicServiceTime\' | translate }}</label> <input ng-model="vm.company.periodicServiceTime" pattern="\\d*" maxlength="30"></md-input-container></div><hr><div layout="row"><div layout="column" flex="50"><label>{{ \'company.logo\' | translate }}</label> <img style="width:200px;" ng-show="!!vm.company.logo" ngf-thumbnail="vm.company.logo"></div><div layout="column" flex><ng-form name="vm.upload_form"><div layout="row"><input class="upload-logo" type="file" ngf-select ng-model="vm.file" name="file" ngf-pattern="\'image/*\'" accept="image/*" ngf-max-size="2MB"><md-button ng-click="vm.selectFile()" class="md-raised md-primary md-fab" aria-label="Select logo file"><i class="fa fa-upload fa-2"></i></md-button><md-input-container flex layout="column" class="md-block" flex-gt-xs><input type="text" ng-model="vm.file.name" name="fileName" disabled="!vm.file"><div ng-messages="vm.upload_form.fileName.$error" md-auto-hide="false" role="alert"><div ng-message="maxSize">{{ \'company.maxSize\' | translate }}</div></div></md-input-container></div><md-button ng-disabled="!vm.file" class="md-raised" type="submit" ng-click="vm.submit()" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}">{{ \'button.upload\' | translate }}</md-button><span ng-if="vm.file">{{ \'company.upload\' | translate }}</span></ng-form></div></div><md-button ng-disabled="companyForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.saveCompany(vm.company)"><span ng-show="vm.state==\'create\'">{{ \'button.create\' | translate }}</span> <span ng-show="vm.state==\'update\'">{{ \'button.update\' | translate }}</span></md-button></ng-form>',params:{id:null},controller:"AdminCompaniesUpdateCtrl",controllerAs:"vm"}).state("superAdmin.logs",{url:"/logs",template:'<div class="table-responsive"><label>From:</label><md-datepicker ng-model="vm.startDate" ng-change="vm.changeDate()" md-open-on-focus md-hide-icons="triangle" aria-label="Selected date"></md-datepicker><label>To:</label><md-datepicker ng-model="vm.endDate" ng-change="vm.changeDate()" md-open-on-focus md-hide-icons="triangle" aria-label="Selected date"></md-datepicker><label>Type:</label><md-input-container><md-select ng-model="vm.type" ng-change="vm.changeDate()"><md-option ng-repeat="type in vm.types" value="{{type}}">{{type}}</md-option></md-select></md-input-container><hr><md-table-container flex layout-padding><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="type">{{ \'logs.type\' | translate }}</th><th md-column md-order-by="name">{{ \'logs.name\' | translate }}</th><th md-column md-order-by="method">{{ \'logs.method\' | translate }}</th><th md-column md-order-by="url">{{ \'logs.url\' | translate }}</th><th md-column md-order-by="date">{{ \'logs.date\' | translate }}</th></tr></thead><tbody md-body><tr md-row ng-repeat="log in vm.logs | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{ log.type }}</td><td md-cell>{{ log.name }}</td><td md-cell>{{ log.method }}</td><td md-cell>{{ log.url }}</td><td md-cell>{{ log.date | date : vm.dateFormat}}</td><td md-cell><md-button ng-if="log.body" ng-click="vm.toggleDetail(log.body)" class="md-fab md-mini" title="Show Detail"><i class="fa fa-info fa-2"></i></md-button></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.logs.length }}" md-page-select></md-table-pagination><md-sidenav class="md-sidenav-left" style="position: relative; width-max: 100%; width: 100%" md-component-id="left" md-disable-backdrop md-whiteframe="4"><md-toolbar class="md-theme-indigo"><div layout="row"><span class="md-toolbar-tools">Log Detail</span> <button aria-label="Close detail" layout-align="right center" class="md-icon-button md-button" ng-click="vm.toggleDetail()"><i class="fa fa-close fa-2"></i></button></div></md-toolbar><md-content layout-margin><pre ng-if="vm.body">{{ vm.body | json }}</pre></md-content></md-sidenav></div>',controller:"AdminLogsCtrl",controllerAs:"vm"})}e.$inject=["$stateProvider"],angular.module("heaterSiloM2M.routing").config(e)}(),function(){function e(e){e.state("supplier",{url:"/supplier",template:"<ui-view/>",deepStateRedirect:{default:{state:"supplier.silos"}}}).state("supplier.silos",{url:"/silos",template:'<div class="container"><md-table-container><h1>Silos</h1><table md-table><thead md-head md-order="vm.querySilos.order"><tr md-row><th md-column md-order-by="serial">{{ \'device.serial\' | translate }}</th><th md-column>{{ \'device.address\' | translate }}</th><th md-column>{{ \'device.maxLoad\' | translate }}</th><th md-column md-order-by="fillingLevel">{{ \'device.fillingLevel\' | translate }}</th><th md-column>{{ \'device.fillingLevelPer\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr md-row ng-repeat-start="silo in vm.getAllSilos | orderBy: vm.querySilos.order | limitTo: vm.querySilos.limit : (vm.querySilos.page -1) * vm.querySilos.limit"><td md-cell>{{silo.serial}}</td><td md-cell><span>{{silo.object.location.address.country}}</span> <span>{{silo.object.location.address.town}}</span> <span>{{silo.object.location.address.streetNr}}</span> <span>{{silo.object.location.address.zip}}</span></td><td md-cell>{{silo.maxLoad}}</td><td md-cell>{{silo.fillingLevel}}</td><td md-cell ng-init="silo.percent = silo.fillingLevel/silo.maxLoad*100"><div class="meter"><span style="width: {{silo.percent}}%" ng-class="{ full: silo.percent == 100, orange: silo.percent < 50 && silo.percent >= 30, red: silo.percent < 30 }"></span></div></td><td md-cell><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ng-click="vm.viewSilo(silo)" title="{{ \'button.view\' | translate }}"><i class="fa fa-info fa-2"></i></md-button></td></tr><tr md-row ng-repeat-end ng-if="silo.orders && silo.orders.length > 0"><td md-cell colspan="8" style="border-top: none"><div ng-repeat="order in silo.orders" class="silo-order"><span>{{ \'order.createdAt\' | translate }}:</span> <span>{{order.createdAt | date: vm.dateFormat}},</span> <span ng-if="order.plannedDeliveryAt">{{ \'order.plannedDeliveryAt\' | translate }}:</span> <span ng-if="order.plannedDeliveryAt">{{order.plannedDeliveryAt | date: vm.dateFormat}},</span><span>{{ \'order.amountOfTons\' | translate }}:</span> <span>{{order.amountOfTons}},</span> <span>{{ \'order.supplier\' | translate }}:</span> <span>{{order.supplier.companyName}}</span></div></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.querySilos.limit" md-page="vm.querySilos.page" md-total="{{ vm.getAllSilos.length }}" md-page-select></md-table-pagination></div>',
controller:"supplierSilosAllCtrl",controllerAs:"vm"}).state("supplier.orders",{url:"/orders",template:'<div class="container"><md-table-container><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="id">{{ \'order.number\' | translate }}</th><th md-column md-order-by="supplier">{{ \'order.supplier\' | translate }}</th><th md-column md-order-by="silo">{{ \'common.silo\' | translate }}</th><th md-column>{{ \'order.amountOfTons\' | translate }}</th><th md-column>{{ \'order.amountCHF\' | translate }}</th><th md-column>{{ \'order.amountCHFPerTon\' | translate }}</th><th md-column md-order-by="status">{{ \'order.status\' | translate }}</th><th md-column></th></tr></thead><tbody md-body><tr md-row ng-repeat="order in vm.orders | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell><span style="text-overflow: ellipsis; overflow: hidden; width: 100px; display: block;" title="{{order.number || order._id}}">{{order.number || order._id}}</span></td><td md-cell>{{order.supplier.companyName}}</td><td md-cell>{{order.silo.serial}}</td><td md-cell>{{order.amountOfTons}}</td><td md-cell>{{order.amountCHF}}</td><td md-cell>{{order.amountCHF / order.amountOfTons || null}}</td><td md-cell>{{order.status}}</td><td md-cell><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ui-sref="supplier.order({id: order._id})" title="{{ \'button.view\' | translate }}"><i class="fa fa-info fa-2"></i></md-button></td></tr></tbody></table></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.orders.length }}" md-page-select></md-table-pagination></div>',controller:"supplierOrdersAllCtrl",controllerAs:"vm"}).state("supplier.order",{url:"/order/:id",template:'<div class="container"><div layout="row"><div flex="50"><h3>{{ \'order.order\' | translate }} #: {{ vm.order.number || vm.order._id }}</h3></div><div flex="50"><h3>{{ \'order.status\' | translate }}: {{ vm.order.status }}</h3></div></div><hr><form name="orderForm"><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.createdAt\' | translate }}</label><md-datepicker ng-disabled="true" ng-model="vm.order.createdAt" md-open-on-focus md-hide-icons="triangle"></md-datepicker></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.plannedDeliveryAt\' | translate }}</label><md-datepicker ng-disabled="vm.order.status != \'open\'" ng-model="vm.order.plannedDeliveryAt" md-open-on-focus md-hide-icons="triangle"></md-datepicker></md-input-container><md-input-container ng-if="vm.order.status != \'open\'" class="md-block" flex-gt-xs><label>{{ \'order.deliveredAt\' | translate }}</label><md-datepicker required ng-disabled="vm.order.status == \'delivered\'" ng-model="vm.order.deliveredAt" md-open-on-focus md-hide-icons="triangle"></md-datepicker></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.amountOfTons\' | translate }}</label> <input required ng-model="vm.order.amountOfTons"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.amountCHFPerTon\' | translate }}</label> <input required ng-model="vm.order.amountCHFPerTon" ng-change="vm.changeCHFPerTon()"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'order.amountCHF\' | translate }}</label> <input required ng-model="vm.order.amountCHF" ng-change="vm.changeCHF()"></md-input-container></div><hr><md-button ng-if="vm.order.status == \'open\'" ng-disabled="orderForm.$invalid" ng-click="vm.confirmed(vm.order)" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}">{{ \'button.confirm\' | translate }}</md-button><md-button ng-if="vm.order.status == \'confirmed\'" ng-disabled="orderForm.$invalid" ng-click="vm.delivered(vm.order)" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}">{{ \'button.delivered\' | translate }}</md-button></form></div>',params:{id:null},controller:"supplierOrderCtrl",controllerAs:"vm"})}e.$inject=["$stateProvider"],angular.module("heaterSiloM2M.routing").config(e)}(),function(){function e(e,t,n,a,r,o,i,l){function s(){n.getCompany().then(function(e){d.company=new l(e)})}var d=this;d.title="AdminCompanyCtrl",d.state="update",d.daysOfWeek=o.daysOfWeek,d.saveCompany=function(t){n.updateCompany(t).then(function(){e.$broadcast("user.authenticate",!0),i.show({content:"Saved",type:"success"})})},d.submit=function(){d.upload_form.file.$valid&&d.file&&d.upload(d.file)},d.selectFile=function(){document.querySelector(".upload-logo").click()},t.$watch("vm.upload_form.file.$error.maxSize",function(e){d.upload_form.fileName.$setValidity("maxSize",!e)}),d.upload=function(e){r.upload({url:o.getApiUri+"/upload",data:{file:e}}).then(function(e){0===e.data.error_code?(d.company.logo=o.getApiUri+"/uploads/"+e.data.file.filename,d.file=null):console.log("an error occured")},function(e){console.log("Error status: "+e.status)},function(e){var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.data.file.name),d.progress="progress: "+t+"% "})},s()}e.$inject=["$rootScope","$scope","adminCompanyService","$stateParams","Upload","configService","Toast","CompanyModel"],angular.module("heaterSiloM2M").controller("AdminCompanyCtrl",e)}(),function(){function e(e,t){var n=function(){return e.get(t.getApiUri+"/companies").then(function(e){return e.data})},a=function(n){return e.get(t.getApiUri+"/company").then(function(e){return e.data})},r=function(n){return e.post(t.getApiUri+"/company",n).then(function(e){return e.data})},o=function(n){return e.put(t.getApiUri+"/company",n).then(function(e){return e.data})},i=function(n){return e.delete(t.getApiUri+"/company/"+n).then(function(e){return e.data})};return{getAllCompanies:n,getCompany:a,createCompany:r,updateCompany:o,removeCompany:i}}angular.module("heaterSiloM2M").factory("adminCompanyService",e),e.$inject=["$http","configService"]}(),function(){function e(e,t){var n=function(){return e.get(t.getApiUri+"/config").then(function(e){return e.data})},a=function(n){return e.put(t.getApiUri+"/config",n).then(function(e){return e.data})};return{getConfig:n,updateConfig:a}}angular.module("heaterSiloM2M").factory("adminConfigService",e),e.$inject=["$http","configService"]}(),function(){function e(e,t){var n=function(){return e.get(t.getApiUri+"/customers").then(function(e){return e.data})},a=function(n){return e.get(t.getApiUri+"/customer?id="+n).then(function(e){return e.data})},r=function(n){return e.post(t.getApiUri+"/customer",n).then(function(e){return e.data})},o=function(n){return e.put(t.getApiUri+"/customer",n).then(function(e){return e.data})},i=function(n){return e.delete(t.getApiUri+"/customer/"+n).then(function(e){return e.data})};return{getAllCustomers:n,getCustomer:a,createCustomer:r,updateCustomer:o,removeCustomer:i}}angular.module("heaterSiloM2M").factory("adminCustomerService",e),e.$inject=["$http","configService"]}(),function(){function e(e,t,n,a,r){var o=function(){return e.get(n.getApiUri+"/heater/status").then(function(e){return e.data})},i=function(){return e.delete(n.getApiUri+"/heaters/status")},l=function(){return e.get(n.getApiUri+"/heaters").then(function(e){return e.data.map(function(e){return new r(e)})})},s=function(t){return e.get(n.getApiUri+"/heater?id="+t).then(function(e){return new r(e.data)})},d=function(t){return e.post(n.getApiUri+"/heater",t).then(function(e){return e.data})},m=function(t){return e.put(n.getApiUri+"/heater",t).then(function(e){return e.data})},c=function(t){return e.delete(n.getApiUri+"/heater/"+t).then(function(e){return e.data})},u=function(){return e.get(n.getApiUri+"/silos").then(function(e){return e.data.map(function(e){return new a(e)})})},p=function(){return e.get(n.getApiUri+"/silosCurrent").then(function(e){return e.data.map(function(e){return new a(e)})})},v=function(){return t.all({heaters:l(),silos:u()}).then(function(e){return e.heaters.concat(e.silos)})},g=function(t){return e.get(n.getApiUri+"/silo?id="+t).then(function(e){return new a(e.data)})},f=function(t){return e.post(n.getApiUri+"/silo",t).then(function(e){return e.data})},b=function(t){return e.put(n.getApiUri+"/silo",t).then(function(e){return e.data})},h=function(t){return e.delete(n.getApiUri+"/silo/"+t).then(function(e){return e.data})};return{getAll:v,deleteAllHeaterDataCollection:i,getHeaterDataCollection:o,getAllHeaters:l,getHeater:s,createHeater:d,updateHeater:m,removeHeater:c,getAllSilos:u,getAllCurrentSilos:p,getSilo:g,createSilo:f,updateSilo:b,removeSilo:h}}angular.module("heaterSiloM2M").factory("adminDeviceService",e),e.$inject=["$http","$q","configService","Silo","Heater"]}(),function(){function e(e,t){var n=function(n,a,r){return e.get(t.getApiUri+"/logs?startDate="+moment(n).format("YYYY-MM-DD")+"&endDate="+moment(a).format("YYYY-MM-DD")+(r?"&type="+r:"")).then(function(e){return e.data})};return{getLogs:n}}angular.module("heaterSiloM2M").factory("adminLogsService",e),e.$inject=["$http","configService"]}(),function(){function e(e,t,n){function a(){return e.get(t.getApiUri+"/orders").then(function(e){return e.data},d)}function r(n){return e.get(t.getApiUri+"/ordersSupplier/"+n).then(function(e){return e.data},d)}function o(n){return e.get(t.getApiUri+"/order?id="+n).then(function(e){return e.data})}function i(n){return e.post(t.getApiUri+"/order",n).then(function(e){return e.data},d)}function l(n){return e.put(t.getApiUri+"/order",n).then(function(e){return e.data},d)}function s(n){return e.delete(t.getApiUri+"/order/"+n).then(function(e){return e.data},d)}function d(e){return e}var m={getAll:a,getAllSupplier:r,get:o,create:i,update:l,remove:s};return m}angular.module("heaterSiloM2M").factory("adminOrderService",e),e.$inject=["$http","configService","Toast"]}(),function(){function e(e,t){var n=function(){return e.get(t.getApiUri+"/projects").then(function(e){return e.data})},a=function(n){return e.get(t.getApiUri+"/projectsCustomer/"+n).then(function(e){return e.data})},r=function(n){return e.get(t.getApiUri+"/projectsSupplier/"+n).then(function(e){return e.data})},o=function(n){return e.get(t.getApiUri+"/project?id="+n).then(function(e){return e.data})},i=function(n){return e.post(t.getApiUri+"/project",n).then(function(e){return e.data})},l=function(n){return e.post(t.getApiUri+"/projectConfirm",{id:n}).then(function(e){return e.data})},s=function(n){return e.post(t.getApiUri+"/projectProlong",{project:n}).then(function(e){return e.data})},d=function(n){return e.put(t.getApiUri+"/project",n).then(function(e){return e.data})},m=function(n){return e.delete(t.getApiUri+"/project/"+n).then(function(e){return e.data})};return{getAllProjects:n,getAllProjectsCustomer:a,getAllProjectsSupplier:r,get:o,create:i,prolong:s,confirm:l,update:d,remove:m}}angular.module("heaterSiloM2M").factory("adminProjectService",e),e.$inject=["$http","configService"]}(),function(){function e(e,t){var n=function(){return e.get(t.getApiUri+"/statisticsByProject").then(function(e){return e.data})},a=function(n,a){return e.get(t.getApiUri+"/statisticsBySupplier?startDate="+moment(n).format("YYYY-MM-DD")+"&endDate="+moment(a).format("YYYY-MM-DD")).then(function(e){return e.data})};return{getByProject:n,getBySupplier:a}}angular.module("heaterSiloM2M").factory("adminStatisticsService",e),e.$inject=["$http","configService"]}(),function(){function e(e,t){var n=function(){return e.get(t.getApiUri+"/users").then(function(e){return e.data})},a=function(){return e.get(t.getApiUri+"/supplierUsers").then(function(e){return e.data})},r=function(){return e.get(t.getApiUri+"/employeeUsers").then(function(e){return e.data})},o=function(){return e.get(t.getApiUri+"/pmUsers").then(function(e){return e.data})},i=function(){return e.get(t.getApiUri+"/pmAdminUsers").then(function(e){return e.data})},l=function(n){return e.get(t.getApiUri+"/pmCustomerUsers/"+n).then(function(e){return e.data})},s=function(){return e.get(t.getApiUri+"/adminUsers").then(function(e){return e.data})},d=function(n){return e.get(t.getApiUri+"/user?id="+n).then(function(e){return e.data})},m=function(n){return e.post(t.getApiUri+"/user",n).then(function(e){return e.data})},c=function(n){return e.put(t.getApiUri+"/user",n).then(function(e){return e.data})},u=function(n){return e.delete(t.getApiUri+"/user/"+n).then(function(e){return e.data})};return{getAllUsers:n,getAllEmployees:r,getAllSuppliers:a,getAllPms:o,getAllPmsAdmin:i,getAllPmsCustomer:l,getAllAdminUsers:s,getUser:d,createUser:m,updateUser:c,removeUser:u}}angular.module("heaterSiloM2M").factory("adminUserService",e),e.$inject=["$http","configService"]}(),function(){function e(e){return{require:"ngModel",scope:{pmsAdmin:"=",pmsRole:"="},link:function(e,t,n,a){var r=function(t){return 5!=e.pmsRole||0===e.pmsAdmin.length||e.pmsAdmin.some(function(e){return e.customer!=t})},o=function(e){return a.$setValidity("customer",r(e)),e};a.$parsers.unshift(function(e){return o(e)}),e.$watch("pmsRole",function(t){e.pmsAdmin&&o(a.$viewValue)})}}}angular.module("heaterSiloM2M").directive("validationCustomer",e),e.$inject=["$timeout"]}(),function(){function e(){function e(e,t,n){return moment.duration(e,t).format(n,{trim:!1})}return e}angular.module("heaterSiloM2M").filter("duration",e)}(),function(){function e(e,t,n){function a(){e.getLogs(r.startDate,r.endDate,"all"!=r.type?r.type:null).then(function(e){r.logs=e})}var r=this;r.startDate=new Date,r.endDate=new Date,r.endDate.setDate(r.endDate.getDate()+1),r.type="all",r.types=["all","user","heater","silo","system"],r.dateFormat=n.logDateFormat,r.query={order:"-date",limit:10,page:1},r.changeDate=function(){a()},a(),r.toggleDetail=function(e){e?r.body?r.body==e?t("left").toggle():r.body=e:(r.body=e,t("left").toggle()):(r.body=null,t("left").toggle())}}angular.module("heaterSiloM2M").controller("AdminLogsCtrl",e),e.$inject=["adminLogsService","$mdSidenav","configService"]}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(){function e(){function e(e){return moment.utc(e,r)}function t(e){return moment.utc(e).format(r)}function n(e){return moment(e,r)}function a(e){return moment(e).format(r)}var r="HH:mm",o=function(){function r(t){_classCallCheck(this,r),angular.extend(this,t),this.officeTime&&"string"==typeof this.officeTime.startTime&&(this.officeTime.startTime=e(this.officeTime.startTime)),this.officeTime&&"string"==typeof this.officeTime.endTime&&(this.officeTime.endTime=e(this.officeTime.endTime)),"string"==typeof this.reminderTime&&(this.reminderTime=n(this.reminderTime)),"string"==typeof this.reminderProjTime&&(this.reminderProjTime=n(this.reminderProjTime))}return _createClass(r,[{key:"toJSON",value:function(){var e={};for(var n in this)"officeTime"!==n?"reminderTime"!==n&&"reminderProjTime"!==n?e[n]=this[n]:e[n]=a(this[n]):e[n]={startTime:this[n].startTime&&t(this[n].startTime),endTime:this[n].endTime&&t(this[n].endTime),daysOfWeek:this[n].daysOfWeek};return e}}]),r}();return o}angular.module("heaterSiloM2M").factory("CompanyModel",e)}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(){function e(e,t){var n=function(e){function n(e){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e))}return _inherits(n,e),_createClass(n,[{key:"getAvailability",value:function(e){var n=this.getSchedule(),a=2,r=!0,o=!1,i=void 0;try{for(var l,s=n[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var d=l.value;if(!d.project||d.project._id!==e._id){if(t.isContained(d,e)){a=0;break}if(t.isIntersected(e,d)){a=1;break}}}}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return a}},{key:"getSchedule",value:function(){var e=[];if(this.projects instanceof Array){var t=!0,n=!1,a=void 0;try{for(var r,o=this.projects[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;if(i.objects instanceof Array){var l=!0,s=!1,d=void 0;try{for(var m,c=i.objects[Symbol.iterator]();!(l=(m=c.next()).done);l=!0){var u=m.value;if(u.silos instanceof Array){var p=!0,v=!1,g=void 0;try{for(var f,b=u.silos[Symbol.iterator]();!(p=(f=b.next()).done);p=!0){var h=f.value;if("silo"===this.type&&this._id===h._id)e.push({project:{_id:i._id,name:i.name},object:{_id:u._id,name:u.name},from:moment(h.startDate),to:moment(h.endDate)});else if(h.heaters instanceof Array){var y=!0,x=!1,w=void 0;try{for(var j,S=h.heaters[Symbol.iterator]();!(y=(j=S.next()).done);y=!0){var k=j.value;this._id===k._id&&e.push({project:{_id:i._id,name:i.name},object:{_id:u._id,name:u.name},from:moment(k.startDate),to:moment(k.endDate)})}}catch(e){x=!0,w=e}finally{try{!y&&S.return&&S.return()}finally{if(x)throw w}}}}}catch(e){v=!0,g=e}finally{try{!p&&b.return&&b.return()}finally{if(v)throw g}}}}}catch(e){s=!0,d=e}finally{try{!l&&c.return&&c.return()}finally{if(s)throw d}}}}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}}if(this.logbook instanceof Array){var A=!0,C=!1,D=void 0;try{for(var $,O=this.logbook[Symbol.iterator]();!(A=($=O.next()).done);A=!0){var M=$.value;"planned_service"===M.reason&&e.push({from:moment(M.startDate).startOf("d"),to:moment(M.endDate).startOf("d")})}}catch(e){C=!0,D=e}finally{try{!A&&O.return&&O.return()}finally{if(C)throw D}}}return e}}]),n}(e);return n}angular.module("heaterSiloM2M").factory("Device",e),e.$inject=["Model","compareDateRanges"]}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e,t){var n=function(e){function n(e){_classCallCheck(this,n);var a=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return a.type="heater",a.color=t.heater,a.heater||(a.heater=e._id),"object"===_typeof(a.heater)&&angular.extend(a,a.heater),a}return _inherits(n,e),n}(e);return n}angular.module("heaterSiloM2M").factory("Heater",e),e.$inject=["Device","COLORS"]}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(){function e(e,t){var n=function(){function t(n){_classCallCheck(this,t),angular.merge(this,n),this.master=n,this.uuid=e.v4(),"string"==typeof this.startDate&&(this.from=this.startDate,this.masterFrom=this.from),"string"==typeof this.endDate&&(this.to=this.endDate,this.masterTo=this.to)}return _createClass(t,[{key:"assignParent",value:function(e){this.parent=e,this.from=this.from||e.from,this.to=this.to||e.to}},{key:"resetDate",value:function(){this.from=this.master.startDate,this.to=this.master.endDate,this.children&&this.children.forEach(function(e){return e.resetDate()})}},{key:"updateChildren",value:function(){var e=this.from,t=this.to;this.children instanceof Array&&this.children.forEach(function(n){if(e>n.from){var a=e-n.from;n.from=e,t>n.to&&(n.to=n.to.add(a,"ms"))}if(t<n.to){var r=n.to-t;n.to=t,e<n.from&&(n.from=n.from.add(-r,"ms"))}n.updateChildren()})}},{key:"removeChild",value:function(e){var t=this.children.findIndex(function(t){return t.uuid===e});if(t>=0)return this.children.splice(t,1)}},{key:"addChild",value:function(e,t){if(!this.children.find(function(t){return t._id===e._id})){var n=new t(e);return n.assignParent(this),this.children.push(n),n}}},{key:"toJSON",value:function(){var e={},t=["uuid","parent","project","children","master"];for(var n in this)~t.indexOf(n)||("startDate"!==n&&"endDate"!==n?e[n]=this[n]:e[n]=moment(this[n]).format("YYYY-MM-DD"));return e}},{key:"from",get:function(){if(this.startDate)return moment(this.startDate)},set:function(e){this.startDate=moment(e).startOf("d").toDate()}},{key:"to",get:function(){if(this.endDate)return moment(this.endDate)},set:function(e){this.endDate=moment(e).startOf("d").toDate()}},{key:"project",get:function(){for(var e=this.parent;e;){if("project"===e.type)return e;e=e.parent}}},{key:"children",get:function(){return this.objects||this.silos||this.heaters}},{key:"duration",get:function(){return moment.duration(this.to-this.from,"ms")}}]),t}();return n}angular.module("heaterSiloM2M").factory("Model",e),e.$inject=["rfc4122","$rootScope"]}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),_get=function e(t,n,a){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,a)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(a)};!function(){function e(e,t,n){var a=function(e){function a(e){_classCallCheck(this,a);var r=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return r.type="object",r.color=n.object,r.silos instanceof Array?r.silos.forEach(function(e,n,a){var o=new t(e);o.assignParent(r),a[n]=o}):r.silos=[],r}return _inherits(a,e),_createClass(a,[{key:"addDevice",value:function(e){return _get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"addChild",this).call(this,e,t)}},{key:"heaters",get:function(){var e=[];return this.silos.forEach(function(t){t.heaters instanceof Array&&(e=e.concat(t.heaters))}),e}}]),a}(e);return a}e.$inject=["Model","Silo","COLORS"],angular.module("heaterSiloM2M").factory("_Object",e)}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),_get=function e(t,n,a){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,a)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(a)};!function(){function e(e,t,n){var a=function(e){function a(e){_classCallCheck(this,a);var r=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return r.type="project",r.color=n.project,r.objects instanceof Array&&r.objects.forEach(function(e,n,a){var o=new t(e);o.assignParent(r),a[n]=o}),r}return _inherits(a,e),_createClass(a,[{key:"addObject",value:function(e){return _get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"addChild",this).call(this,e,t)}},{key:"removeObject",value:function(e){return _get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"removeChild",this).call(this,e)}},{key:"updateObject",value:function(e){var t=this.objects.findIndex(function(t){return t.uuid===e.uuid});t>=0&&angular.extend(this.objects[t],e)}},{key:"silos",get:function(){var e=[];return this.objects.forEach(function(t){t.silos instanceof Array&&(e=e.concat(t.silos))}),e}},{key:"heaters",get:function(){var e=[];return this.silos.forEach(function(t){t.heaters instanceof Array&&(e=e.concat(t.heaters))}),e}},{key:"devices",get:function(){return this.silos.concat(this.heaters)}}]),a}(e);return a}e.$inject=["Model","_Object","COLORS"],angular.module("heaterSiloM2M").factory("Project",e)}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),_get=function e(t,n,a){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,a)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(a)};!function(){function e(e,t,n){var a=function(e){function a(e){_classCallCheck(this,a);var r=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return r.type="silo",r.color=n.silo,r.silo||(r.silo=e._id),"object"===_typeof(r.silo)&&angular.extend(r,r.silo),r.heaters instanceof Array?r.heaters.forEach(function(e,n,a){var o=new t(e);o.assignParent(r),a[n]=o}):r.heaters=[],r}return _inherits(a,e),_createClass(a,[{key:"addDevice",value:function(e){return _get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"addChild",this).call(this,e,t)}}]),a}(e);return a}angular.module("heaterSiloM2M").factory("Silo",e),e.$inject=["Device","Heater","COLORS"]}(),function(){angular.module("heaterSiloM2M").constant("COLORS",{project:"#c23e00",object:"#ff671f",silo:"#689db0",heater:"#90b7c5",partialAvailable:"#ffc000",available:"green"})}(),function(){function e(e,t){function n(e){o=new t(e),i.resolve(o)}function a(){return i.promise}function r(){return o}var o=void 0,i=e.defer();this.setCompany=n,this.getCompany=a,this.getCompanySync=r}e.$inject=["$q","CompanyModel"],angular.module("heaterSiloM2M").service("companyService",e)}(),function(){function e(){function e(e,t){var n=e.from,a=e.to,r=t.from,o=t.to;return n.isBetween(r,o,"d","[]")||a.isBetween(r,o,"d","[]")||r.isBetween(n,a,"d","[]")||o.isBetween(n,a,"d","[]")}function t(e,t){var n=e.from,a=e.to,r=t.from,o=t.to;return r.isBetween(n,a,"d","[]")&&o.isBetween(n,a,"d","[]")}function n(e,t){var n=e.from,a=e.to,r=t.from,o=t.to;return n.isBefore(r)||a.isAfter(o)}this.isIntersected=e,this.isContained=t,this.isBeyond=n}angular.module("heaterSiloM2M").service("compareDateRanges",e),e.$inject=[]}(),function(){function e(e,t){function n(e){return t.show(angular.extend({},d,{controller:"AdminProjectDialogSupplierCtrl",template:'<md-dialog aria-label="dialog"><md-toolbar md-colors="{backgroundColor: \'siloblue-600\', color: \'siloblue-50\'}"><div class="md-toolbar-tools"><h2>Select Supplier</h2><span flex></span><md-button class="md-icon-button" ng-click="vm.cancel()"><i class="fa fa-remove fa-2" aria-label="Close dialog"></i></md-button></div></md-toolbar><md-dialog-content class="md-dialog-content"><md-input-container class="md-block"><label>{{ \'project.supplier\' | translate }}</label><md-select ng-model="vm.supplier" ng-change="vm.changeHandler()"><md-option ng-repeat="supp in vm.suppliers" value="{{ supp._id }}">{{ supp.companyName || supp.username }}</md-option></md-select></md-input-container></md-dialog-content><md-dialog-actions><md-button class="md-raised" ng-disabled="!vm.changed" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.add()">{{ \'button.add\' | translate }}</md-button></md-dialog-actions></md-dialog>',locals:{supplier:e}}))}function a(e){return t.show(angular.extend({},d,{controller:"ObjectDialogCtrl",template:'<md-dialog aria-label="dialog"><md-toolbar md-colors="{backgroundColor: \'siloblue-600\', color: \'siloblue-50\'}"><div class="md-toolbar-tools"><h2><span ng-show="vm.state===\'create\'">Create</span> <span ng-show="vm.state===\'update\'">Edit</span> object</h2><span flex></span><md-button class="md-icon-button" ng-click="vm.cancel()"><i class="fa fa-remove fa-2" aria-label="Close dialog"></i></md-button></div></md-toolbar><md-dialog-content class="md-dialog-content"><ng-form name="objectForm"><md-input-container class="md-block"><label>{{ \'object.name\' | translate }}</label> <input type="text" ng-model="vm.object.name" maxlength="60" required autofocus></md-input-container><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.country\' | translate }}</label> <input ng-model="vm.object.location.address.country" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.town\' | translate }}</label> <input ng-model="vm.object.location.address.town" maxlength="60"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.streetNr\' | translate }}</label> <input ng-model="vm.object.location.address.streetNr" maxlength="60"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.additionalLine\' | translate }}</label> <input ng-model="vm.object.location.address.additionalLine" maxlength="30"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'address.zip\' | translate }}</label> <input ng-model="vm.object.location.address.zip" pattern="\\d*" maxlength="15"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{ \'object.gps\' | translate }}</label> <input type="text" ng-model="vm.object.location.gps"></md-input-container></div><div layout-gt-sm="row"><p style="margin: auto;" class="md-block" flex-gt-xs>{{ \'object.numberOfDevices\' | translate }}</p><md-input-container class="md-block" flex-gt-xs><label>{{\'common.silo\' | translate}}</label> <input type="number" min="0" max="100" ng-model="vm.object.numberSilos"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{\'common.heater\' | translate}}</label> <input type="number" min="0" max="100" ng-model="vm.object.numberHeaters"></md-input-container></div><div layout-gt-sm="row"><p style="margin: auto;" class="md-block" flex-gt-xs>{{ \'object.daysOfWeek\' | translate }}</p><md-input-container class="md-block" flex-gt-xs><md-select multiple="true" ng-model="vm.object.possibleDeliveryTime.daysOfWeek" placeholder="{{ \'input.pleaseSelect\' | translate }}"><md-option ng-value="day.id" ng-repeat="day in vm.daysOfWeek">{{ day.name | translate }}</md-option></md-select></md-input-container></div><div layout-gt-sm="row"><p class="md-block" flex-gt-xs>{{ \'object.holiday\' | translate }}</p><div class="md-block" flex-gt-xs><md-checkbox ng-model="vm.object.possibleDeliveryTime.holiday"></md-checkbox></div></div><md-input-container class="md-block"><label>{{ \'object.comment\' | translate }}</label> <textarea ng-model="vm.object.comment" maxlength="100"></textarea></md-input-container></ng-form></md-dialog-content><md-dialog-actions><md-button ng-disabled="objectForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.save(vm.object)">{{ \'button.save\' | translate }}</md-button></md-dialog-actions></md-dialog>',locals:{object:e}}))}function r(e,n,a){return t.show(angular.extend({},d,{controller:"cruRecordDialogCtrl",template:'<md-dialog aria-label="dialog"><md-toolbar md-colors="{backgroundColor: \'siloblue-600\', color: \'siloblue-50\'}"><div class="md-toolbar-tools"><h2><span ng-show="vm.state===\'create\'">Create</span> <span ng-show="vm.state===\'view\'">View</span> record</h2><span flex></span><md-button class="md-icon-button" ng-click="vm.cancel()"><i class="fa fa-remove fa-2" aria-label="Close dialog"></i></md-button></div></md-toolbar><md-dialog-content class="md-dialog-content"><ng-form name="recordForm"><div layout="row" layout-margin="5px"><div layout="row" layout-align="space-around center"><label class="md-block">{{\'schedule.from\'| translate}} *</label><md-datepicker required class="md-block" style="margin-right: 0;" ng-disabled="vm.state===\'view\'" ng-model="vm.record.startDate" ng-change="vm.computeTotalTime([vm.record.startDate, vm.record.endDate, vm.record.employees])" md-open-on-focus md-hide-icons="triangle" aria-label="Start date range"></md-datepicker><div class="md-block" ng-disabled="vm.state===\'view\'" uib-timepicker show-meridian="false" ng-model="vm.record.startDate"></div></div><div layout="row" layout-align="space-around center"><label class="md-block">{{\'schedule.to\'| translate}} *</label><md-datepicker required class="md-block" style="margin-right: 0;" ng-disabled="vm.state===\'view\'" ng-model="vm.record.endDate" ng-change="vm.computeTotalTime([vm.record.startDate, vm.record.endDate, vm.record.employees])" md-min-date="vm.record.startDate" md-open-on-focus md-hide-icons="triangle" aria-label="End date range"></md-datepicker><div class="md-block" ng-disabled="vm.state===\'view\'" uib-timepicker show-meridian="false" ng-model="vm.record.endDate"></div></div></div><md-input-container class="md-block" flex-gt-xs><label>{{\'logbook.employees\' | translate}}</label><md-select class="md-select" multiple="true" ng-model="vm.record.employees" ng-disabled="vm.state===\'view\'" required><md-option ng-value="employee._id" ng-repeat="employee in vm.employees">{{employee.realName}} ({{employee.username}})</md-option></md-select></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{\'logbook.totalTime\' | translate}} ({{\'h:m\' | translate}})</label> <input ng-model="vm.record.totalTime" duration ng-disabled="vm.state === \'view\'"></md-input-container><md-input-container class="md-block" flex-gt-xs><label>{{\'logbook.reason\' | translate}}</label><md-select class="md-select" ng-model="vm.record.reason" ng-disabled="vm.state===\'view\'" required><md-option ng-value="reason" ng-repeat="reason in vm.reasons">{{ \'logbook.reasons.\' + reason | translate }}</md-option></md-select></md-input-container><md-checkbox ng-model="hasSpareParts" ng-disabled="vm.state===\'view\'">Spare parts</md-checkbox><div ng-if="hasSpareParts"><div layout="row" layout-align="center center" ng-repeat="sparePart in vm.record.spareParts track by $index"><span>{{$index + 1}}.</span><md-input-container class="md-block" style="margin: 0" flex-gt-xs><input ng-model="vm.record.spareParts[$index]" ng-disabled="vm.state===\'view\'"></md-input-container><md-button ng-disabled="vm.record.spareParts[$index].length === 0" ng-if="$last && vm.state !== \'view\' && vm.record.spareParts.length <= vm.maxSpareParts" class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.record.addSparePart()" title="{{ \'button.add\' | translate }}"><i class="fa fa-plus fa-2"></i></md-button><md-button ng-if="!$last && vm.state !== \'view\' || $index === vm.maxSpareParts" class="md-fab md-mini md-warn" ng-click="vm.record.removeSparePart($index)" title="{{ \'button.remove\' | translate }}"><i class="fa fa-remove fa-2"></i></md-button></div></div><md-input-container class="md-block"><label>{{ \'object.comment\' | translate }}</label> <textarea ng-model="vm.record.comment" md-maxlength="1000" ng-disabled="vm.state===\'view\'"></textarea></md-input-container></ng-form></md-dialog-content><md-dialog-actions ng-if="vm.state !== \'view\'"><md-button ng-disabled="recordForm.$invalid" class="md-raised" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.save(vm.record)">{{ \'button.save\' | translate }}</md-button></md-dialog-actions></md-dialog>',
locals:{record:e,deviceId:n,state:a}}))}var o=e.instant,i=function(e,n){var a=t.confirm().title(o("confirm.removeItem.title")).textContent(o("confirm.removeItem.textContent")).ok(o("button.ok")).cancel(o("button.cancel"));t.show(a).then(function(){"function"==typeof e&&e()},function(){"function"==typeof n&&n()})},l=function(e,n){var a=t.confirm().title(o("confirm.leavePage.title")).textContent(o("confirm.leavePage.textContent")).ok(o("button.ok")).cancel(o("button.cancel"));t.show(a).then(function(){"function"==typeof e&&e()},function(){"function"==typeof n&&n()})},s=function(e,n){var a=t.confirm().title(o("confirm.adjustDuration.title")).textContent(o("confirm.adjustDuration.textContent")).ok(o("button.ok")).cancel(o("button.cancel"));t.show(a).then(function(){"function"==typeof e&&e()},function(){"function"==typeof n&&n()})},d={parent:angular.element(document.body),clickOutsideToClose:!0,escapeToClose:!0,controllerAs:"vm"};return{confirmRemoveItem:i,confirmLeavePage:l,confirmAdjustDuration:s,dialogSupplier:n,objectDialog:a,cruRecordDialog:r}}e.$inject=["$translate","$mdDialog"],angular.module("heaterSiloM2M").factory("dialogService",e)}(),function(){function e(e,t,n,a){var r=function(){return a.get("locale")||t.defaultLocale},o=function(e){var t=e.toLowerCase();n.use(t),moment.locale(t)};return{init:function(){o(r())},set:function(e){e!==r()&&(a.set("locale",e),o(e))},get:function(){return r()}}}angular.module("heaterSiloM2M").factory("localeService",e),e.$inject=["$rootScope","configService","$translate","localStorageService"]}(),function(){angular.module("heaterSiloM2M").constant("PROJECT_EVENTS",{changed:"project:changed"})}(),function(){function e(e,t,n,a,r,o,i,l,s,d){function m(e){return~["silo","heater"].indexOf(e.type)}function c(e){return{name:e.uuid,uuid:e.uuid,parent:e.parent&&e.parent.uuid,title:e.name||e.serial,tasks:[{name:e.uuid,uuid:e.uuid,title:e.name||e.serial,data:e,from:e.from,to:e.to,masterFrom:moment(e.master.startDate),masterTo:moment(e.master.endDate),color:e.color,classes:[e.type],type:e.type,movable:{},tooltips:{dateFormat:"DD/MM/YYYY"},content:u(e)}]}}function u(e){return a.get(e.type+"Task.tmpl.html")}return{init:function(e,t){this.api=e,this.projects=t instanceof Array?t:[t],this.data=[],this.updateChartData()},updateChartData:function(){this.updating||(this.update(),this.data.length=0,angular.extend(this.data,Object.values(this.rowsMap)),this.ready=!0)},update:function(){this.itemsMap={},this.rowsMap={},this.projects.forEach(this._mapData,this)},_mapData:function(e){this.itemsMap[e.uuid]=e,this.rowsMap[e.uuid]=c(e),e.children&&e.children.forEach(this._mapData,this)},addDevice:function(e,t){e=t.addDevice(e),e&&(this.addRow(e),this.itemsMap[e.uuid]=e)},addRow:function(e){var t=c(e);this.rowsMap[e.uuid]=t,this.data.push(t)},removeRow:function(e){for(var t=this.itemsMap[e],n=this.data.findIndex(function(t){return t.uuid===e});t.children&&t.children.length;)this.removeRow(t.children[0].uuid);t.parent.removeChild(t.uuid),this.data.splice(n,1),delete this.itemsMap[e],delete this.rowsMap[e]},updateRow:function(e){angular.extend(this.rowsMap[e],c(this.itemsMap[e]))},getChartData:function(){return this.data},updateItemDate:function(e,a,r){var o=this,i=a.from,s=a.to,m=t.defer(),c=e.project,u={from:i,to:s};return this.updating=!0,r&&c&&d.isBeyond(u,c)?n(function(){l.confirmAdjustDuration(m.resolve,m.reject)}):m.resolve(),m.promise.then(function(){e.parent&&r&&o._updateParentsDate(e.parent,u),angular.extend(e,u)}).catch(function(){o.updating=!1,o.updateChartData()}),m.promise},autoFill:function(e){var t=this;e=e.filter(function(e){return 2===e.availability});var n=this._getItems("object"),a=e.filter(function(e){return"silo"===e.type}),r=e.filter(function(e){return"heater"===e.type});n.forEach(function(e){for(var n=e.numberSilos-(e.silos?e.silos.length:0),o=e.numberHeaters;n>0&&a.length;)t.addDevice(a.shift(),e),n--;e.silos.forEach(function(e){var n=6;for(o-=e.heaters?e.heaters.length:0;o>0&&r.length&&n--;)t.addDevice(r.shift(),e),o--})})},refresh:function(){},reset:function(){this.projects.forEach(function(e){return e.resetDate()})},_updateParentsDate:function(e,t){var n=t.from,a=t.to;angular.extend(e,{from:moment.min(e.from,n),to:moment.max(e.to,a)}),e.parent&&this._updateParentsDate(e.parent,{from:n,to:a})},_getItems:function(e){var t=this;return Object.keys(this.itemsMap).map(function(e){return t.itemsMap[e]}).filter(function(t){return t.type===e})},isDevice:m,changeSupplier:function(e){l.dialogSupplier(e.supplier).then(function(t){e.supplier=t})}}}angular.module("heaterSiloM2M").factory("Schedule",e),e.$inject=["$rootScope","$q","$timeout","$templateCache","COLORS","Toast","adminProjectService","dialogService","ganttArrays","compareDateRanges"]}(),function(){function e(){function e(e,t){sessionStorage.setItem(e,JSON.stringify(t))}function t(e){return JSON.parse(sessionStorage.getItem(e))}var n={set:e,get:t};return n}angular.module("heaterSiloM2M").factory("sessionStorageService",e),e.$inject=[]}(),function(){function e(e,t){function n(t){e.show(angular.extend({},{template:o(t.content,t.type),position:t.position,hideDelay:t.hideDelay},i))}function a(t){e.show(angular.extend({},{template:o(t)},i))}function r(t){e.show(angular.extend({},{template:o(t,"error")},i))}function o(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";return'<md-toast class="toast-'+n+' angular-animate">\n                <div class="md-toast-content">\n                  '+t.instant(e)+"\n                </div>\n              </md-toast>"}this.show=n,this.success=a,this.error=r;var i={position:"top left",hideDelay:3e3}}angular.module("heaterSiloM2M").service("Toast",e),e.$inject=["$mdToast","$translate"]}(),function(){function e(e,t,n,a){return{request:function(e){return e.headers=e.headers||{},t.get("token")&&(e.headers.Authorization="Bearer "+t.get("token"),e.headers["Accept-Language"]=n.get()),e},requestError:function(t){return e.reject(t)},response:function(t){return t||e.when(t)},responseError:function(n){if(null!==n&&401===n.status&&t.get("token")){var r=a.get("$state"),o=a.get("userService");o.logout(),r.go("login")}return e.reject(n)}}}angular.module("heaterSiloM2M").factory("TokenInterceptor",e),e.$inject=["$q","$cookies","localeService","$injector"]}(),function(){function e(e,t,n,a){var r=a;return function(n){var a=t.defer();return r(n).then(a.resolve,a.reject).then(function(){return e.loading=!1}),a.promise}}e.$inject=["$rootScope","$q","$timeout","$translateStaticFilesLoader"],angular.module("heaterSiloM2M").factory("translateLoader",e)}(),function(){function e(e,t,n,a,r,o,i,l){var s=function(e){t.put("token",e)},d=function(){return t.get("token")},m=function(){var e=d();return!!e},c=function(){var e=d(),t=e.split(".")[1];return t=n.atob(t),JSON.parse(t)},u=function(){if(m())return c()},p=function(){if(m())return c().roleId},v=function(){if(m())return c().permissions},g=function(){return e.get(a.getApiUri+"/ping").then(function(e){return e.data})},f=function(t,n){return e.post(a.getApiUri+"/login",{username:t,password:n}).then(function(e){s(e.data.token);var t=u();return i.getCompany(t.companyId).then(function(e){l.setCompany(e)}),r.$broadcast("user.authenticate",!0),t.preferredLanguage&&r.$broadcast("changeLanguage",t.preferredLanguage),e.data})},b=function(){o.reset(),t.remove("token"),r.$broadcast("user.authenticate",!1)},h=function(t,n,r,o){return e.post(a.getApiUri+"/register",{username:t,email:n,password:r,companyId:o}).then(function(e){return e.data})},y=function(t){return e.post(a.getApiUri+"/forgot",{username:t}).then(function(e){return e.data})},x=function(t,n){return e.get(a.getApiUri+"/reset/"+t).then(function(r){return e.post(a.getApiUri+"/reset/"+t,{password:n}).then(function(e){return e.data})})};return{currentUser:u,getUserRole:p,getUserPermisions:v,saveToken:s,getToken:d,isLoggedIn:m,ping:g,login:f,logout:b,register:h,forgot:y,reset:x}}e.$inject=["$http","$cookies","$window","configService","$rootScope","$deepStateRedirect","adminCompanyService","companyService"],angular.module("heaterSiloM2M").factory("userService",e)}(),function(){function e(){function e(e){return e.charAt(0).toUpperCase()+e.slice(1)}this.capitalize=e}angular.module("heaterSiloM2M").service("utils",e),e.$inject=[]}(),function(){function e(e,t,n,a,r){function o(){t.getUser(l._id).then(function(e){i.user=e})}var i=this;i.title="SettingsCtrl";var l=n.currentUser();i.updateUser=function(e){t.updateUser(e).then(function(e){a.show({content:"Saved",type:"success"})})},o()}angular.module("heaterSiloM2M").controller("SettingsCtrl",e),e.$inject=["$stateParams","adminUserService","userService","Toast","menuService"]}(),function(){function e(e,t,n,a,r){var o=this,i=n.currentUser();5!=i.roleId&&6!=i.roleId||r.getCustomer(i.customer).then(function(e){o.permissions=e.permissions}),o.query={order:"serial",limit:10,page:1},a.getCompany().then(function(e){o.operationsServiceTime=e.operationsServiceTime,t.getAllProjectsCustomer(i.customer).then(function(e){6==i.roleId?o.getAllProjects=e.filter(function(e){return e.pm==i._id}):o.getAllProjects=e,o.getAllHeaters=[],o.getAllProjects.forEach(function(e){e.archive||e.objects.forEach(function(e){e.silos.forEach(function(e){e.heaters.forEach(function(e){e.heater.ashLevel=(e.heater.operationHours-o.operationsServiceTime*e.heater.operationsService)/o.operationsServiceTime*100,o.getAllHeaters.push(e.heater)})})})})})}),o.viewHeater=function(t){e.go("heater",{id:t._id})}}angular.module("heaterSiloM2M").controller("pmHeatersAllCtrl",e),e.$inject=["$state","adminProjectService","userService","adminCompanyService","adminCustomerService"]}(),function(){function e(e,t,n,a){var r=this,o=a.currentUser();r.query={order:"name",limit:10,page:1},n.getAllProjectsCustomer(o.customer).then(function(e){6==o.roleId?r.getAllProjects=e.filter(function(e){return e.pm==o._id}):r.getAllProjects=e})}angular.module("heaterSiloM2M").controller("pmProjectsAllCtrl",e),e.$inject=["$state","$rootScope","adminProjectService","userService"]}(),function(){function e(e,t,n){var a=this;t.getConfig().then(function(e){a.config=e}),a.updateConfig=function(e){t.updateConfig(e).then(function(){n.show({content:"Saved",type:"success"})})}}e.$inject=["$state","adminConfigService","Toast"],angular.module("heaterSiloM2M").controller("AdminConfigCtrl",e)}(),function(){function e(e,t,n,a,r){function o(){e.get(n.id).then(function(e){e.createdAt=new Date(e.createdAt),e.plannedDeliveryAt=e.plannedDeliveryAt?new Date(e.plannedDeliveryAt):new Date,i.order=e,"open"!=e.status&&(i.order.deliveredAt=i.order.deliveredAt?new Date(i.order.deliveredAt):new Date,i.changeCHF())})}var i=this;i.title="AdminOrdersAllCtrl",i.dateFormat=t.dateFormat,i.confirmed=function(t){t.status="confirmed",e.update(t).then(function(e){r.go("supplier.orders"),a.success("alert.confirmed")})},i.delivered=function(t){t.status="delivered",e.update(t).then(function(e){r.go("supplier.orders"),a.success("alert.delivered")})},i.changeCHF=function(){i.order.amountCHFPerTon=i.order.amountCHF/i.order.amountOfTons},i.changeCHFPerTon=function(){i.order.amountCHF=i.order.amountCHFPerTon*i.order.amountOfTons},o()}angular.module("heaterSiloM2M").controller("supplierOrderCtrl",e),e.$inject=["adminOrderService","configService","$stateParams","Toast","$state"]}(),function(){function e(e,t,n){function a(){e.getAllSupplier(t.currentUser()._id).then(function(e){return r.orders=e})}var r=this;r.title="supplierOrdersAllCtrl",r.dateFormat=n.dateFormat,r.query={order:"-createdAt",limit:10,page:1},a()}angular.module("heaterSiloM2M").controller("supplierOrdersAllCtrl",e),e.$inject=["adminOrderService","userService","configService"]}(),function(){function e(e,t,n){var a=this;a.querySilos={order:"serial",limit:5,page:1};var r=n.currentUser();t.getAllProjectsSupplier(r._id).then(function(e){a.getAllSilos=[],e.forEach(function(e){e.archive||e.objects.forEach(function(e){e.silos.forEach(function(t){t.supplier===r._id&&(t.silo.object=e,t.silo.orders=[],t.orders.forEach(function(e){e.supplier===r._id&&(e.supplier=r,t.silo.orders.push(e))}),t.silo.orders=t.silo.orders?t.silo.orders.filter(function(e){return"delivered"!=e.status}):null,a.getAllSilos.push(t.silo))})})})}),a.viewSilo=function(t){e.go("silo",{id:t._id})}}angular.module("heaterSiloM2M").controller("supplierSilosAllCtrl",e),e.$inject=["$state","adminProjectService","userService"]}(),function(){function e(e){var t=this;t.forgotUser=function(n){e.forgot(n).then(function(e){t.warning=null,t.success=!0}).catch(function(e){t.success=null,t.warning=!0})}}angular.module("heaterSiloM2M").controller("UserForgotCtrl",e),e.$inject=["userService"]}(),function(){function e(e,t){var n=this;t.getAllCompanies().then(function(e){n.getAllCompanies=e}),n.registerUser=function(t,n,a,r){e.register(t,n,a,r)}}angular.module("heaterSiloM2M").controller("UserRegistrationCtrl",e),e.$inject=["userService","adminCompanyService"]}(),function(){function e(e,t,n){var a=this;a.loginUser=function(n,r){e.login(n,r).then(function(n){var r=e.getUserRole(),o=1===r?"superAdmin":2===r?"admin":~[5,6].indexOf(r)?"pm.projects":4===r?"supplier.silos":"myAccount";a.redirectTo=o,t.go(o)}).catch(function(){a.warning=!0})}}angular.module("heaterSiloM2M").controller("UserLoginCtrl",e),e.$inject=["userService","$state","$stateParams"]}(),function(){function e(e,t,n,a){var r=t.id,o=this;o.resetUser=function(t){e.reset(r,t).then(function(e){n.go("login"),a.success("user.alert.success_reset")})},o.getPattern=function(){return o.password&&o.password.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}}e.$inject=["userService","$stateParams","$state","Toast"],angular.module("heaterSiloM2M").controller("UserResetCtrl",e)}(),function(){function e(e,t,n){var a=this;a.query={order:"name",limit:10,page:1},t.getAllCustomers().then(function(e){a.getAllCustomers=e}),a.remove=function(e){var r=function(){a.getAllCustomers.splice(a.getAllCustomers.indexOf(e),1),t.removeCustomer(e._id)};n.confirmRemoveItem(r)},a.update=function(t){e.go("admin.customers.update",{id:t})}}angular.module("heaterSiloM2M").controller("AdminCustomersAllCtrl",e),e.$inject=["$state","adminCustomerService","dialogService"]}(),function(){function e(e,t,n){var a=this;a.state="create",a.customer={permissions:n.permissionsPM},a.saveCustomer=function(n){t.createCustomer(n).then(function(){e.go("admin.customers.all")})}}angular.module("heaterSiloM2M").controller("AdminCustomersCreateCtrl",e),e.$inject=["$state","adminCustomerService","configService"]}(),function(){function e(e,t,n,a,r){var o=this;o.state="update",o.customer=r,o.customer.permissions=o.customer.permissions||n.permissionsPM,o.saveCustomer=function(n){t.updateCustomer(n).then(function(){e.go("admin.customers.all")})}}e.$inject=["$state","adminCustomerService","configService","$stateParams","customer"],angular.module("heaterSiloM2M").controller("AdminCustomersUpdateCtrl",e)}(),function(){function e(e,t,n,a,r,o){function i(){r.getCompany().then(function(e){l.operationsServiceTime=e.operationsServiceTime,t.getAllHeaters().then(function(e){e.forEach(function(e){e.operationHours&&e.operationsService&&l.operationsServiceTime&&(e.ashLevel=(e.operationHours-l.operationsServiceTime*e.operationsService)/l.operationsServiceTime*100)}),l.getAllHeaters=e})}),t.getAllSilos().then(function(e){e.forEach(function(e){e.fillingLevel&&e.fillingLevel&&(e.percent=e.fillingLevel/e.maxLoad*100,e.orders=e.orders?e.orders.filter(function(e){return"delivered"!=e.status}):null)}),l.getAllSilos=e})}var l=this;l.title="AdminDevicesAllCtrl",l.permission=3==a.userRole&&a.userPermissions&&!a.userPermissions.devices.write,l.querySilos={order:"serial",limit:5,page:1},l.queryHeaters={order:"serial",limit:5,page:1},l.dateFormat=o.dateFormat,l.removeSilo=function(e){var a=function(){l.getAllSilos.splice(l.getAllSilos.indexOf(e),1),t.removeSilo(e._id)};n.confirmRemoveItem(a)},l.removeHeater=function(e){var a=function(){l.getAllHeaters.splice(l.getAllHeaters.indexOf(e),1),t.removeHeater(e._id)};n.confirmRemoveItem(a)},i()}angular.module("heaterSiloM2M").controller("AdminDevicesAllCtrl",e),e.$inject=["$state","adminDeviceService","dialogService","$rootScope","adminCompanyService","configService"]}(),function(){function e(e,t,n,a,r){var o=this,i=a.type;if(o.state=n.current.name.split(".").slice(-1)[0],"create"===o.state)o.device={type:i,location:{}};else if("update"===o.state){var l="get"+r.capitalize(i);t[l](a.id).then(function(e){e&&(o.device=e)}).catch(function(){n.go("404",{},{location:"replace"})})}o.save=function(a){var i=o.state+r.capitalize(o.device.type);t[i](a).then(function(){n.go("admin.devices.all")}).catch(function(t){11e3===t.data.code&&e.deviceForm.serial.$setValidity("unique",!1)})},e.$watch(function(){return o.device&&o.device.serial},function(){e.deviceForm.serial.$invalid&&e.deviceForm.serial.$setValidity("unique",!0)})}angular.module("heaterSiloM2M").controller("AdminDevicesEditCtrl",e),e.$inject=["$scope","adminDeviceService","$state","$stateParams","utils"]}(),function(){function e(e,t,n){function a(){e.getAll().then(function(e){return r.orders=e})}var r=this;r.title="AdminOrdersAllCtrl",r.dateFormat=t.dateFormat,r.states={Orders:"open",Delivery:"delivered"},r.query={order:"-createdAt",limit:10,page:1,status:"open"},r.remove=function(t){var a=function(){r.orders.splice(r.orders.indexOf(t),1),e.remove(t._id)};n.confirmRemoveItem(a)},a()}angular.module("heaterSiloM2M").controller("AdminOrdersAllCtrl",e),e.$inject=["adminOrderService","configService","dialogService"]}(),function(){function e(e,t,n,a){function r(){t.getAllCurrentSilos().then(function(e){return o.silos=e})}var o=this;o.title="AdminOrdersCreateCtrl",r(),o.createOrder=function(t){t.supplier=t.silo.supplier,t.amountOfTons=t.silo.maxLoad,n.create(t).then(function(t){e.go("admin.orders.all"),a.success("alert.created")})}}angular.module("heaterSiloM2M").controller("AdminOrdersCreateCtrl",e),e.$inject=["$state","adminDeviceService","adminOrderService","Toast"]}(),function(){function e(e,t,n,a,r,o){function i(){o.createdAt=new Date(o.createdAt),o.plannedDeliveryAt=o.plannedDeliveryAt?new Date(o.plannedDeliveryAt):new Date,l.order=o,"open"!=l.order.status&&(l.order.deliveredAt=l.order.deliveredAt?new Date(l.order.deliveredAt):new Date,l.changeCHF())}var l=this;l.title="AdminOrdersAllCtrl",l.dateFormat=t.dateFormat,l.confirmed=function(t){t.status="confirmed",e.update(t).then(function(e){r.go("admin.orders.all"),a.success("alert.confirmed")})},l.delivered=function(t){t.status="delivered",e.update(t).then(function(e){r.go("admin.orders.all"),a.success("alert.delivered")})},l.changeCHF=function(){l.order.amountCHFPerTon=l.order.amountCHF/l.order.amountOfTons},l.changeCHFPerTon=function(){l.order.amountCHF=l.order.amountCHFPerTon*l.order.amountOfTons},i()}e.$inject=["adminOrderService","configService","$stateParams","Toast","$state","order"],angular.module("heaterSiloM2M").controller("AdminOrdersUpdateCtrl",e)}(),function(){function e(e,t,n,a,r){var o=this;o.permissionRead=3==t.userRole&&t.userPermissions&&!t.userPermissions.projectsAll.read,o.permissionWrite=3==t.userRole&&t.userPermissions&&!t.userPermissions.projectsAll.write,o.query={order:"name",limit:10,page:1},n.getAllProjects().then(function(e){if(o.projects=e,3==t.userRole){var n=t.userPermissions&&!t.userPermissions.projectsOwner.read,a=t.userPermissions&&!t.userPermissions.projectsOwner.write,i=r.currentUser()._id;console.log("$rootScope.userPermissions",t.userPermissions),console.log("permissionRead",n),console.log("permissionWrite",a),console.log("userService.currentUser()._id",r.currentUser()._id),o.projects.forEach(function(e){console.log("proj.employee",e.employee),e.employee==i&&(e.permissionRead=!n,e.permissionWrite=!a)})}}),o.remove=function(e){var t=function(){o.projects.splice(o.projects.indexOf(e),1),n.remove(e._id)};a.confirmRemoveItem(t)},o.update=function(t){e.go("admin.projects.update",{id:t})},o.copy=function(t){e.go("admin.projects.copy",{id:t})}}angular.module("heaterSiloM2M").controller("AdminProjectsAllCtrl",e),e.$inject=["$state","$rootScope","adminProjectService","dialogService","userService"]}();var _slicedToArray=function(){function e(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function e(e,t,n,a,r,o,i,l,s,d,m,c,u){function p(){var t=!0,n=e.$watch(function(){return JSON.stringify(f.project)},function(){t?a(function(){t=!1},1e3):t||(f.changed=!0,n())});f.changed=!1}function v(){r.getAllEmployees().then(function(e){f.employees=e}),r.getAllPms().then(function(e){f.pms=e}),i.getAllCustomers().then(function(e){f.customers=e}),p(),"create"===f.state?f.project=new d({startDate:moment().add(1,"d").toDate(),endDate:moment().add(1,"w").toDate(),objects:[]}):o.get(n.id).then(function(e){e&&(f.project=new d(e),"copy"===f.state&&(delete f.project._id,f.project.name=f.project.name+" (copy)"))}).catch(function(){t.go("404",{},{location:"replace"})})}function g(n,a){f.changed&&"create"!=f.state&&(h(),n.preventDefault(),l.confirmLeavePage(function(){return t.go(a.name)},function(){return h=e.$on("$stateChangeStart",g)}))}var f=this,b=u;f.title="AdminProjectsEditCtrl",f.state=t.current.name.split(".").slice(-1)[0],f.changed=!1,f.saveProject=function(){var n="update"===f.state?"update":"create";o[n](f.project).then(function(e){m.success("alert."+n+"d"),"create"===f.state&&t.go("admin.projects.update",{id:e._id}),p()}).catch(function(t){11e3===t.data.code&&(e.projectForm.projectName.$setValidity("unique",!1),m.error("project.toast.name_exists"))})},f.createObjectDialog=function(){l.objectDialog().then(function(e){e&&(f.project.addObject(e),s.updateChartData())})},f.updateObjectDialog=function(e){l.objectDialog(angular.copy(e)).then(function(e){e&&(f.project.updateObject(e),s.updateChartData())})},f.removeObject=function(e){var t=function(){f.project.removeObject(e.uuid),s.updateChartData()};l.confirmRemoveItem(t)},e.$watch(function(){return f.project&&f.project.name},function(){e.projectForm.projectName.$invalid&&e.projectForm.projectName.$setValidity("unique",!0)}),e.$watchGroup([function(){return f.project&&f.project.startDate},function(){return f.project&&f.project.endDate}],b(function(e){var t=_slicedToArray(e,2),n=t[0],a=t[1];n&&a&&(n&&n>f.project.endDate&&(f.project.to=moment(n)),f.project.updateChildren(),s.ready&&s.updateChartData())}),100),v();var h=e.$on("$stateChangeStart",g)}e.$inject=["$scope","$state","$stateParams","$timeout","adminUserService","adminProjectService","adminCustomerService","dialogService","Schedule","Project","Toast","$translate","ganttDebounce"],angular.module("heaterSiloM2M").controller("AdminProjectsEditCtrl",e)}();var _slicedToArray=function(){function e(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function e(e,t,n,a,r,o,i,l,s,d,m,c){function u(e){p.isChanged=!1,i.getAllSilos().then(function(t){p.silosLength=t.length,o.getAllProjects().then(function(t){p.projects.length=0,p.projects=t.map(function(e){return new c(e)}).sort(function(e,t){return e.from-t.from}),e&&e()})})}var p=this,v=r.get("scheduleOpts");p.title="AdminScheduleCtrl",p.options={currentDate:"none",treeTableColumns:[],width:800,columnWidth:25,rowContent:"{{row.model.title}}",taskContent:"{{task.model.title}}",groupDisplayMode:"group",taskOutOfRange:"none",columnMagnet:"1 day",daily:!0,allowSideResizing:!1,keepAncestorOnFilterRow:!0,expandToFit:!0,shrinkToFit:!1,sideWidth:200,fromDate:v&&v.fromDate&&new Date(v.fromDate),toDate:v&&v.toDate&&new Date(v.toDate),scale:v&&v.scale||"day",readOnly:!0,headersFormats:{month:function(e){return moment(e.date).format("MMMM")}},tooltip:{content:"{{task.model.title}}</br>\n                  <small>\n                    {{task.isMilestone() === true && getFromLabel() || getFromLabel() + ' - ' + getToLabel()}}\n                  </small>"},filterRow:function(e){var t=e.rowsManager.gantt;return t.getPositionByDate(e.to)>0&&t.getPositionByDate(e.from)<t.width}},p.projects=[],u(),p.refresh=function(){return u(l.refresh.bind(l))},e.$watchGroup([function(){return p.options.fromDate},function(){return p.options.toDate},function(){return p.options.scale}],function(e){var t=_slicedToArray(e,3),n=t[0],a=t[1],o=t[2];r.set("scheduleOpts",{fromDate:n,toDate:a,scale:o})})}angular.module("heaterSiloM2M").controller("AdminScheduleCtrl",e),e.$inject=["$scope","$state","$rootScope","$q","sessionStorageService","adminProjectService","adminDeviceService","Schedule","Toast","ganttDebounce","dialogService","Project"]}(),function(){function e(e,t){function n(e){if(e){var n=[];a.export=[],e.forEach(function(e){n.push({c:[{v:e.name},{v:e.amountOfTons},{v:e.operationHours},{v:e.days}]}),a.export.push({name:e.name,amountOfTons:e.amountOfTons,operationHours:e.operationHours,days:e.days})}),a.statistics=e,t(["statistics.name","statistics.amountOfTons","statistics.operationHours","statistics.days"]).then(function(e){a.myChartObject.data={cols:[{id:"s",label:e["statistics.name"],type:"string"},{id:"t",label:e["statistics.amountOfTons"],type:"number"},{id:"o",label:e["statistics.operationHours"],type:"number"},{id:"d",label:e["statistics.days"],type:"number"}],rows:n}})}}var a=this;a.query={statistic:"name",limit:10,page:1},a.myChartObject={},a.myChartObject.type="BarChart",a.myChartObject.options={colors:["#1b9e77","#d95f02","#7570b3"]},a.changeProject=function(){n(a.chosenProject?a.chosenProject.objects:a.projects)},a.changeObject=function(){n(a.chosenObject?a.chosenObject.silos:a.chosenProject.objects)},a.getByProject=function(){e.getByProject().then(function(e){a.projects=e,n(e)})},a.getByProject()}angular.module("heaterSiloM2M").controller("AdminStatisticsProjectsService",e),e.$inject=["adminStatisticsService","$translate"]}(),function(){function e(e,t){function n(e){if(e){a.export=[];var n=[];e.forEach(function(e){n.push({c:[{v:e.supplier.companyName},{v:e.amountOfTons}]}),a.export.push({username:e.supplier.username,amountOfTons:e.amountOfTons})}),a.statistics=e,t(["statistics.name","statistics.amountOfTons"]).then(function(e){a.myChartObject.data={cols:[{id:"s",label:e["statistics.name"],type:"string"},{id:"t",label:e["statistics.amountOfTons"],type:"number"}],rows:n}})}}var a=this;a.query={statistic:"name",limit:10,page:1},a.startDate=new Date,a.startDate.setDate(a.startDate.getDate()-7),a.endDate=new Date,a.myChartObject={},a.myChartObject.type="BarChart",a.myChartObject.options={colors:["#1b9e77","#d95f02","#7570b3"]},a.getBySupplier=function(){e.getBySupplier(a.startDate,a.endDate).then(function(e){n(e)})},a.getBySupplier()}angular.module("heaterSiloM2M").controller("AdminStatisticsSuppliersCtrl",e),e.$inject=["adminStatisticsService","$translate"]}(),function(){function e(e,t,n,a,r,o){var i=this;i.userRoles=t.userRoles,i.query={order:"username",limit:10,page:1},i.currentUser=o.currentUser(),a.getAllUsers().then(function(e){n.getAllCompanies().then(function(t){e.forEach(function(e){e.company=t.find(function(t){return t._id==e.companyId}),e.role=i.userRoles.find(function(t){return t.id==e.roleId})}),i.getAllUsers=e})}),i.remove=function(e){var t=function(){i.getAllUsers.splice(i.getAllUsers.indexOf(e),1),a.removeUser(e._id)};r.confirmRemoveItem(t)},i.update=function(t){e.go("admin.users.update",{id:t})}}angular.module("heaterSiloM2M").controller("AdminUsersAllCtrl",e),e.$inject=["$state","configService","adminCompanyService","adminUserService","dialogService","userService"]}(),function(){function e(e,t,n,a,r,o,i){var l=this;l.user={},l.user.permissions=o.permissionsEmployee,l.userRoles=o.userRoles,l.currentUser=i.currentUser(),l.state="create",l.routerState=t.current.name,n.getAllCompanies().then(function(e){l.getAllCompanies=e}),r.getAllCustomers().then(function(e){l.customers=e}),a.getAllPmsAdmin().then(function(e){l.pmsAdmin=e}),l.save=function(n){n.companyId=l.currentUser.companyId,a.createUser(n).then(function(){t.go("admin.users.all")}).catch(function(t){e.userForm.email.$setValidity("unique",!1)})},e.$watch(function(){return l.user.username},function(){e.userForm.email.$invalid&&e.userForm.email.$setValidity("unique",!0)})}e.$inject=["$scope","$state","adminCompanyService","adminUserService","adminCustomerService","configService","userService"],angular.module("heaterSiloM2M").controller("AdminUsersCreateCtrl",e)}(),function(){function e(e,t,n,a,r,o,i,l,s){var d=this;d.state="update",d.routerState=t.current.name,d.currentUser=l.currentUser(),d.userRoles=a.userRoles,d.user=angular.extend({},s,{permissions:s.permissions||a.permissionsEmployee}),o.getAllCompanies().then(function(e){d.getAllCompanies=e}),i.getAllCustomers().then(function(e){d.customers=e}),r.getAllPmsAdmin().then(function(e){d.pmsAdmin=e.filter(function(e){return e._id!=d.userId})}),d.save=function(n){r.updateUser(n).then(function(){t.go("admin.users.all")}).catch(function(t){e.userForm.email.$setValidity("unique",!1)})},e.$watch(function(){return d.user&&d.user.username},function(){e.userForm.email.$invalid&&e.userForm.email.$setValidity("unique",!0)})}e.$inject=["$scope","$state","$stateParams","configService","adminUserService","adminCompanyService","adminCustomerService","userService","user"],angular.module("heaterSiloM2M").controller("AdminUsersUpdateCtrl",e)}(),function(){function e(e,t){return{link:function(n,a,r){var o=a.isolateScope();a.on("click",function(){t(function(){e("isOpen").assign(o,"true")})})}}}angular.module("heaterSiloM2M").directive("autoOpen",e),e.$inject=["$parse","$timeout"]}(),function(){function e(e){function t(t,n,a,r){var o=void 0;r.$formatters.push(function(t){return t&&e(t,"m","HH:mm")}),r.$parsers.push(function(e){var t=void 0;return/^[\d]{0,}\:?[\d]{0,2}$/g.test(e)?(o=e,t=o):(t=o,r.$setViewValue(o),r.$render()),t&&moment.duration(t,~t.indexOf(":")?"m":null).asMinutes()})}var n={link:t,restrict:"A",require:"ngModel"};return n}angular.module("heaterSiloM2M").directive("duration",e),e.$inject=["durationFilter"]}(),function(){function e(){var e={bindToController:!0,controller:t,controllerAs:"vm",template:'<md-table-container layout="row" layout-margin="5px"><div flex><div layout="row"><h3>Logbook</h3><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.addCRURecord()" title="{{ \'button.add_record\' | translate }}"><i class="fa fa-plus fa-2"></i></md-button></div><table md-table><thead md-head md-order="vm.query.order"><tr md-row><th md-column md-order-by="startDate" style="width: 158px;">{{ \'project.startDate\' | translate }}</th><th md-column md-order-by="endDate" style="width: 148px;">{{ \'project.endDate\' | translate }}</th><th md-column md-order-by="totalTime">{{ \'logbook.totalTime\' | translate }} ({{\'h:m\' | translate}})</th><th md-column md-order-by="reason">{{ \'logbook.reason\' | translate }}</th><th md-column>{{ \'object.comment\' | translate }}</th><th md-column style="width: 136px;"></th></tr></thead><tbody md-body><tr md-row ng-repeat="record in vm.records | orderBy: vm.query.order | limitTo: vm.query.limit : (vm.query.page -1) * vm.query.limit"><td md-cell>{{ record.startDate | date: vm.dateFormat }}</td><td md-cell>{{ record.endDate | date: vm.dateFormat }}</td><td md-cell>{{ record.totalTime | duration: \'m\' : \'HH:mm\' }}</td><td md-cell>{{ \'logbook.reasons.\' + record.reason | translate}}</td><td md-cell>{{ record.comment | limitTo: 100}}{{record.comment.length > 100 ? \'...\' : \'\'}}</td><td md-cell><div class="actions"><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="vm.editCRURecord(record)" title="{{ \'button.update\' | translate }}"><i class="fa fa-edit fa-2"></i></md-button><md-button class="md-fab md-mini" md-colors="{backgroundColor: \'siloblue-300\', color: \'siloblue-50\'}" ng-click="vm.viewCRURecord(record)" title="{{ \'button.view\' | translate }}"><i class="fa fa-info fa-2"></i></md-button></div></td></tr></tbody></table></div></md-table-container><md-table-pagination md-limit="vm.query.limit" md-page="vm.query.page" md-total="{{ vm.records.length }}" md-page-select></md-table-pagination>',
restrict:"AE",scope:{records:"=",device:"="}};return e}function t(e,t){var n=this,a=e.$parent.vm;n.dateFormat="dd/MM/yyyy - HH:mm",n.query={order:"startDate",limit:10,page:1},n.addCRURecord=function(){t.cruRecordDialog(null,n.device&&n.device._id,"create").then(function(e){e&&(n.records.push(e),a.updateChart())})},n.viewCRURecord=function(e){t.cruRecordDialog(e,null,"view")},n.editCRURecord=function(e){t.cruRecordDialog(e,null,"update").then(function(e){var t=n.records.findIndex(function(t){return t._id===e._id});angular.extend(n.records[t],e),a.updateChart()})}}t.$inject=["$scope","dialogService"],angular.module("heaterSiloM2M").directive("logbook",e)}(),function(){var e={};angular.forEach("drag dragend dragenter dragexit dragleave dragover dragstart drop".split(" "),function(t){var n="ng"+t.charAt(0).toUpperCase()+t.slice(1);e[n]=["$parse","$rootScope",function(e,a){return{restrict:"A",compile:function(a,r){var o=e(r[n],null,!0);return function(e,n){n.on(t,function(t){var n=function(){o(e,{$event:t})};e.$apply(n)})}}}}]}),angular.module("ngDrag",[]).directive(e)}(),function(){function e(e,t,n){var a=this;a.user={},a.state="create",a.currentUser=n.currentUser(),a.save=function(n){var r=a.currentUser;n.roleId=6,n.companyId=r.companyId,n.customer=r.customer,t.createUser(n).then(function(){e.go("pm.users.all")})}}e.$inject=["$state","adminUserService","userService"],angular.module("heaterSiloM2M").controller("pmUsersCreateCtrl",e)}(),function(){function e(e,t,n,a){var r=this;r.query={order:"username",limit:10,page:1},a.getAllPmsCustomer(n.currentUser().customer).then(function(e){r.getAllUsers=e}),r.remove=function(e){var n=function(){r.getAllUsers.splice(r.getAllUsers.indexOf(e),1),a.removeUser(e._id)};t.confirmRemoveItem(n)},r.update=function(t){e.go("pm.users.update",{id:t})}}angular.module("heaterSiloM2M").controller("pmUsersAllCtrl",e),e.$inject=["$state","dialogService","userService","adminUserService"]}(),function(){function e(e,t,n,a){var r=this;r.userId=t.id,r.userId||e.go("pm.users.all"),r.currentUser=a.currentUser(),r.state="update",n.getAllPmsCustomer(r.currentUser.customer).then(function(e){r.getAllUsers=e,r.user=r.getAllUsers.find(function(e){return e._id==r.userId})}),r.save=function(t){n.updateUser(t).then(function(){e.go("pm.users.all")})}}e.$inject=["$state","$stateParams","adminUserService","userService"],angular.module("heaterSiloM2M").controller("pmUsersUpdateCtrl",e)}(),function(){function e(e,t,n,a,r,o){var i=this;i.userRoles=t.userSuperRoles,i.query={order:"username",limit:10,page:1},i.currentUser=o.currentUser(),a.getAllAdminUsers().then(function(e){n.getAllCompanies().then(function(t){e.forEach(function(e){e.company=t.find(function(t){return t._id==e.companyId}),e.role=i.userRoles.find(function(t){return t.id==e.roleId})}),i.getAllUsers=e})}),i.remove=function(e){var t=function(){i.getAllUsers.splice(i.getAllUsers.indexOf(e),1),a.removeUser(e._id)};r.confirmRemoveItem(t)},i.update=function(t){e.go("superAdmin.adminUsers.update",{id:t})}}angular.module("heaterSiloM2M").controller("AdminAdminUsersAllCtrl",e),e.$inject=["$state","configService","adminCompanyService","adminUserService","dialogService","userService"]}(),function(){function e(e,t,n,a){var r=this;r.state="create",r.routerState=e.current.name,r.userRoles=a.userSuperRoles,r.user={},t.getAllCompanies().then(function(e){r.getAllCompanies=e}),r.save=function(t){n.createUser(t).then(function(){e.go("superAdmin.adminUsers.all")})}}angular.module("heaterSiloM2M").controller("AdminAdminUsersCreateCtrl",e),e.$inject=["$state","adminCompanyService","adminUserService","configService"]}(),function(){function e(e,t,n,a,r,o){var i=this;i.state="update",i.routerState=e.current.name,i.userRoles=n.userSuperRoles,i.currentUser=o.currentUser(),r.getAllCompanies().then(function(e){i.getAllCompanies=e}),a.getUser(t.id).then(function(e){i.user=e}),i.save=function(t){a.updateUser(t).then(function(){e.go("superAdmin.adminUsers.all")})}}e.$inject=["$state","$stateParams","configService","adminUserService","adminCompanyService","userService"],angular.module("heaterSiloM2M").controller("AdminAdminUsersUpdateCtrl",e)}(),function(){function e(e,t,n){var a=this;a.query={order:"name",limit:10,page:1},t.getAllCompanies().then(function(e){a.getAllCompanies=e}),a.remove=function(e){var r=function(){a.getAllCompanies.splice(a.getAllCompanies.indexOf(e),1),t.removeCompany(e._id)};n.confirmRemoveItem(r)},a.update=function(t){e.go("superAdmin.companies.update",{id:t})}}angular.module("heaterSiloM2M").controller("AdminCompaniesAllCtrl",e),e.$inject=["$state","adminCompanyService","dialogService"]}(),function(){function e(e,t,n,a,r){var o=this;o.state="create",o.daysOfWeek=a.daysOfWeek;var i={officeTime:{startTime:"8:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5]},reminderTime:"12:00",reminderProjTime:"12:00",operationsServiceTime:100,periodicServiceTime:1e3};o.company=new r(i),o.saveCompany=function(n){t.createCompany(n).then(function(){e.go("superAdmin.companies.all")})},o.submit=function(){o.upload_form.file.$valid&&o.file&&o.upload(o.file)},o.selectFile=function(){document.querySelector(".upload-logo").click()},o.upload=function(e){n.upload({url:a.getApiUri+"/upload",data:{file:e}}).then(function(e){0===e.data.error_code?(o.company.logo=a.getApiUri+"/uploads/"+e.data.file.filename,o.file=null):console.log("an error occured")},function(e){console.log("Error status: "+e.status)},function(e){var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.data.file.name),o.progress="progress: "+t+"% "})}}angular.module("heaterSiloM2M").controller("AdminCompaniesCreateCtrl",e),e.$inject=["$state","adminCompanyService","Upload","configService","CompanyModel"]}(),function(){function e(e,t,n,a,r,o){var i=this;i.state="update",i.companyId=n.id,i.companyId||e.go("superAdmin.companies.all"),i.daysOfWeek=r.daysOfWeek,t.getAllCompanies().then(function(e){i.getAllCompanies=e;var t=i.getAllCompanies.find(function(e){return e._id==i.companyId});i.company=new o(t)}),i.saveCompany=function(n){t.updateCompany(n).then(function(){e.go("superAdmin.companies.all")})},i.submit=function(){i.upload_form.file.$valid&&i.file&&i.upload(i.file)},i.selectFile=function(){document.querySelector(".upload-logo").click()},i.upload=function(e){a.upload({url:r.getApiUri+"/upload",data:{file:e}}).then(function(e){0===e.data.error_code?(i.company.logo=r.getApiUri+"/uploads/"+e.data.file.filename,i.file=null):console.log("an error occured")},function(e){console.log("Error status: "+e.status)},function(e){var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.data.file.name),i.progress="progress: "+t+"% "})}}angular.module("heaterSiloM2M").controller("AdminCompaniesUpdateCtrl",e),e.$inject=["$state","adminCompanyService","$stateParams","Upload","configService","CompanyModel"]}(),function(){function e(e,t){var n=this;n.state=t?"update":"create",n.object=t||{location:{},silos:[]},n.daysOfWeek=[{id:1,name:"dayOfWeek.monday"},{id:2,name:"dayOfWeek.tuesday"},{id:3,name:"dayOfWeek.wednesday"},{id:4,name:"dayOfWeek.thursday"},{id:5,name:"dayOfWeek.friday"},{id:6,name:"dayOfWeek.saturday"},{id:7,name:"dayOfWeek.sunday"}],n.save=function(t){e.hide(t)},n.cancel=e.hide}e.$inject=["$mdDialog","object"],angular.module("heaterSiloM2M").controller("ObjectDialogCtrl",e)}(),function(){function e(e,t,n){var a=this;a.supplier=n,e.getAllSuppliers().then(function(e){a.suppliers=e}),a.add=function(){t.hide(a.supplier)},a.cancel=function(){t.hide()},a.changeHandler=function(){a.changed=!0}}e.$inject=["adminUserService","$mdDialog","supplier"],angular.module("heaterSiloM2M").controller("AdminProjectDialogSupplierCtrl",e)}(),function(){function e(e){return{restrict:"E",scope:{items:"="},template:'<div class="row"><ul class="nav navbar-nav"><li ng-repeat="item in items" ui-sref-active="active" ng-if="!item.permission"><a ui-sref="{{ item.sref }}">{{ item.value | translate }}</a></li></ul></div>',link:function(t){t.$state=e}}}angular.module("heaterSiloM2M").directive("mainNavBar",e),e.$inject=["$state"]}(),function(){function e(e,t,n,a,r,o,i){return{restrict:"E",template:'<div class="_navigationBar" layout="row"><ul class="nav navbar-nav navbar-right"><li ng-show="isLoggedIn" ng-repeat="bar in navBar" ng-if="bar.value && !bar.permission" ui-sref-active="active"><a ui-sref="{{ bar.sref }}">{{ bar.value | translate }}</a><submenu ng-if="bar.submenu" items="bar.submenu"></submenu></li><li ng-class="{show: isOpen}"><a href="#" class="flag flag-{{currentLocale}}" ng-click="showSwitcherHandler()"></a><ul class="nav nav-stacked select"><li ng-repeat="(locale, abbr) in locales" ng-class="no-animate" ng-if="locale !== currentLocale"><div class="flag flag-{{locale}}" ng-click="changeLanguage(locale)" alt="{{locale}}"><div></div></div></li></ul></li></ul></div>',link:function(e){function n(e){r.$broadcast("changeLanguage",e)}function l(){e.isOpen=!e.isOpen,i.one("mouseup",function(t){e.isOpen=!1,e.$apply()}).one("keyup",function(t){27===t.which&&(e.isOpen=!1,e.$apply())})}e.locales={en:"eng",de:"deu"},e.currentLocale=a.get(),e.changeLanguage=n,e.showSwitcherHandler=l,e.$on("changeLanguage",function(t,n){a.set(n),e.currentLocale=n}),e.isLoggedIn=t.isLoggedIn(),e.$on("user.authenticate",function(n,a){e.isLoggedIn=a,r.userRole=e.userRole=t.getUserRole(),r.userPermissions=t.getUserPermisions(),e.navBar=Object.values(o.getMain())}),r.userRole=e.userRole=t.getUserRole(),r.userPermissions=t.getUserPermisions(),e.navBar=Object.values(o.getMain())}}}e.$inject=["$translate","userService","$state","localeService","$rootScope","menuService","$document"],angular.module("heaterSiloM2M").directive("navigationBar",e)}(),function(){function e(){return{restrict:"E",scope:{items:"="},template:'<ul class="nav nav-stacked"><li ng-repeat="item in items" ui-sref-active="active" ng-if="!item.permission"><a ui-sref="{{ item.sref }}">{{ item.value | translate }}</a></li></ul>',link:function(e){}}}angular.module("heaterSiloM2M").directive("sideNavBar",e)}(),function(){function e(){var e={template:'<ul class="nav nav-stacked submenu">\n                  <li ng-repeat="item in items" ui-sref-active="active">\n                    <a ui-sref="{{ item.sref }}">{{ item.value | translate }}</a>\n                  </li>\n                </ul>',restrict:"AE",replace:!0,scope:{items:"="}};return e}angular.module("heaterSiloM2M").directive("submenu",e),e.$inject=[]}(),function(){function e(){var e={bindToController:!0,controller:t,controllerAs:"ds",template:'<div class="_device-schedule"><div gantt options="ds.options" data="ds.data"><gantt-tooltips content="ds.options.tooltip.content"></gantt-tooltips></div></div>',restrict:"AE",scope:{scheduleData:"="}};return e}function t(e,t){function n(e){return[{name:"Device schedule",tasks:e.map(function(e){return angular.extend({},e,{name:e.project?"Project: "+e.project.name+" -- Object: "+e.object.name:"Service",color:e.project?"#689db0":"#c23e00",tooltips:{dateFormat:"DD/MM/YYYY"}})})}]}function a(e){var t={min:null,max:null};return e.forEach(function(e){t.min=t.min?moment.min(e.from,t.min):e.from,t.max=t.max?moment.max(e.to,t.max):e.to}),moment.duration(t.max-t.min,"ms")}var r=this,o=a(r.scheduleData);t.instant;r.options={currentDate:"column",headersFormats:{month:function(e){return moment(e.date).format("MMMM")}},daily:!0,expandToFit:!0,shrinkToFit:!0,readOnly:!0,viewScale:o.asMonths()>2?"month":o.asWeeks()>4?"week":"day",tooltip:{content:"{{task.model.name}}</br>\n                  <small>\n                    {{task.isMilestone() === true && getFromLabel() || getFromLabel() + ' - ' + getToLabel()}}\n                  </small>"}},e.$on("changeLanguage",function(e,t){r.options.headersFormats.month=function(e){return moment(e.date).locale(t).format("MMMM")}}),r.data=n(r.scheduleData),e.$watch(function(){return r.scheduleData},function(e){r.data=n(e)})}t.$inject=["$scope","$translate"],angular.module("heaterSiloM2M").directive("deviceSchedule",e),e.$inject=[]}(),function(){function e(e,n){var a={bindToController:!0,controller:t,controllerAs:"ms",template:'<div class="_main-schedule"><div gantt from-date="ms.options.fromDate" to-date="ms.options.toDate" view-scale="ms.options.scale" headers="ms.headers" options="ms.options" data="ms.chartData" template-url="gantt.tmpl.html" api="ms.registredApi"><gantt-movable enabled="!ms.options.readOnly" allow-moving="false" allow-resizing="false" allow-row-switching="false"></gantt-movable><gantt-tooltips content="ms.options.tooltip.content"></gantt-tooltips><gantt-tree></gantt-tree></div></div>',restrict:"AE",replace:!0,scope:{data:"=",options:"=",silosLength:"=",allowResizing:"="}};return a}function t(e,t,n,a,r){var o=this;e.$on("changeLanguage",function(e,t){o.options.headersFormats.month=function(e){return moment(e.date).locale(t).format("MMMM")}}),o.registredApi=function(n){function r(){t.init(n,o.data),o.chartData=t.getChartData(),o.silos=[],o.chartData.forEach(function(e){"silo"==e.tasks[0].type&&o.silos.push(e.tasks[0].data)})}function i(e){var t=e.model;t.to<t.masterTo&&(t.to=t.masterTo.clone()),e.updatePosAndSize()}function l(e){var n=e.model;t.updateItemDate(n.data,n,!0).finally(function(){t.updating=!1,console.log("update chart data "),$timeout(function(){return t.updateChartData()})})}e.api=n,e.options=o.options,r(),n.core.on.rendered(e,function(){e.schedule=t,e.$watchCollection(function(){return o.data},function(){t.updateChartData()}),o.allowResizing&&(n.tasks.on.resize(e,i),n.tasks.on.resizeEnd(e,l))}),n.directives.on.new(e,function(e,t,r){if("ganttColumnHeader"===e&&o.silosLength&&"day"===t.column.unit){var i;!function(){var e=0;o.silos.forEach(function(n){moment(n.startDate)<moment(t.column.endDate)&&moment(n.endDate).add(1,"d")>=moment(t.column.endDate)&&(e+=1)}),i=e/o.silosLength*100,i<50?r.css({"background-color":"darkseagreen",opacity:1}):i<80?r.css({"background-color":"orange",opacity:1}):r.css({"background-color":"lightcoral",opacity:1})}()}"ganttTask"===e&&(r.on("dblclick",function(e){var a=t.task,r=a.row.model.id;a.row._collapsed?n.tree.expand(r):n.tree.collapse(r),t.$apply()}),o.allowResizing&&!function(){var e=t.task,n=t.task.model,i=e.getForegroundElement();e.getContentElement();r.bind("mousemove",function(e){var t=15,r=a.getOffsetForElement(i[0],e).x;o.allowResizing.future&&(n.movable.allowResizing=r>t),o.allowResizing.past&&(n.movable.allowResizing=r<i[0].offsetWidth-t)})}()),"ganttColumn"===e&&+t.column.endDate===+moment().startOf("d").add(1,"d")&&r.css({"background-color":"green",opacity:.6})})}}angular.module("heaterSiloM2M").directive("mainSchedule",e),e.$inject=["$window","ganttDebounce"],t.$inject=["$scope","Schedule","ganttDebounce","ganttMouseOffset","adminDeviceService"]}();var _slicedToArray=function(){function e(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function e(e,n,a){var r={bindToController:!0,controller:t,controllerAs:"ps",template:'<div class="_project-schedule" layout="row"><div class="available-devices" ng-class="{off: !ps.isOpenDevices}"><div layout="row"><h4>{{\'schedule.storage\' | translate}}</h4><md-button class="md-raised md-primary md-button" ng-if="filtredDevices.length !== 0" md-colors="{backgroundColor: \'siloblue-700\', color: \'siloblue-50\'}" ng-click="ps.autoFill(filtredDevices)" ng-disabled="ps.autoFillDisabled">{{\'button.autoFill\' | translate}}</md-button></div><ul class="devices-list"><li class="device angular-animate" ng-repeat="device in ps.devices | orderBy: \'-availability\'| filter: ps.availableFilter as filtredDevices" ng-dragstart="ps.dragStartHandler($event, device)" ng-dragend="ps.dragEndHandler($event, $index, ps.devices)" draggable="{{true}}" ng-style="{\'background-color\': UTIL_COLORS[device.availability]}"><i class="fa" ng-class="{ \'fa-battery-full fa-rotate-270\': device.type == \'silo\', \'fa-fire\': device.type == \'heater\' }" aria-hidden="true"></i> {{device.serial}}</li></ul><div class="devices-list" ng-if="filtredDevices.length == 0"><p>{{\'schedule.no_devices\' | translate}}</p></div><button type="button" aria-label="Show available devices" class="storage-switcher" ng-click="ps.isOpenDevices = !ps.isOpenDevices"><div class="vertical-line"></div><div class="switcher-label"><i class="fa fa-chevron-{{ps.isOpenDevices ? \'up\' : \'down\'}}"></i> <span>{{\'schedule.storage\' | translate}}</span></div></button></div><div flex class="chart-container"><div gantt options="ps.options" view-scale="ps.options.viewScale" column-width="ps.options.columnWidth" from-date="ps.options.fromDate" to-date="ps.options.toDate" data="ps.chartData" template-url="gantt.tmpl.html" api="ps.registredApi"><gantt-movable enabled="!ps.options.readOnly" allow-row-switching="false"></gantt-movable><gantt-tooltips content="ps.options.tooltip.content"></gantt-tooltips><gantt-tree></gantt-tree></div></div></div>',restrict:"AE",replace:!0,scope:{project:"=data"}};return r}function t(e,t,n,a,r,o,i,l,s){function d(e){return e.availability=e.getAvailability(b.project),e.availability>0}function m(e){return e.asMonths()>12?"quarter":e.asMonths()>2?"month":e.asWeeks()>4?"week":"day"}function c(e){return"day"===e?20:void 0}function u(e){return"month"!==e?"MMMM YYYY":"MMMM"}function p(e){return e.model.from===e.originalFrom}function v(e){return e.model.to===e.originalTo}function g(e,t){var n=e.model,a=n.from,r=n.to;t.forEach(function(e){e.tasks.length&&(e.tasks.forEach(function(e){if(a>e.model.from){var t=a-e.model.from;e.model.from=a.clone(),r>e.model.to&&e.model.to.add(t,"ms")}if(r<e.model.to){var n=e.model.to-r;e.model.to=r.clone(),a<e.model.from&&e.model.from.add(-n,"ms")}}),e.updateTasksPosAndSize())})}function f(e,t){e.forEach(function(e){e.tasks.length&&(e.tasks.forEach(function(e){e.model.from.subtract(t,"ms"),e.model.to.subtract(t,"ms")}),e.updateTasksPosAndSize())})}var b=this,h=864e5,y=void 0;e.UTIL_COLORS={1:i.partialAvailable,2:i.available};var x=b.project.duration;b.viewScale=m(x),b.options={currentDate:"none",treeTableColumns:[],columnWidth:c(b.viewScale),rowContent:"{{row.model.title}}",taskContent:"{{task.model.title}}",columnMagnet:"1 day",allowSideResizing:!1,viewScale:m(x),headersFormats:{month:function(e){return moment(e.date).format(u(b.options.viewScale))}},tooltip:{content:"{{task.model.title}}</br>\n                  <small>\n                    {{task.isMilestone() === true && getFromLabel() || getFromLabel() + ' - ' + getToLabel()}}\n                  </small>"}},b.dragStartHandler=function(e,t){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("device","anything"),y=t},b.availableFilter=function(e){if(d(e))return!b.project.devices.some(function(t){return t._id===e._id})},b.autoFill=n.autoFill.bind(n),e.$on("changeLanguage",function(e,t){b.options.headersFormats.month=function(e){return moment(e.date).locale(t).format(u(b.options.viewScale))}}),e.$watch("ps.isOpenDevices",function(){n.api&&t(n.api.columns.refresh,400)}),e.$watchGroup([function(){return b.project.startDate},function(){return b.project.endDate}],function(n){var a=_slicedToArray(n,2),r=a[0],o=a[1];if(r&&o){var i=moment.duration(o-r,"ms");b.options.viewScale=m(i),b.options.columnWidth=c(b.options.viewScale),"day"===b.options.viewScale?(b.options.fromDate=moment(r).add(-3,b.options.viewScale),b.options.toDate=moment(o).add(30,b.options.viewScale)):b.options.fromDate=moment(r).add(-1,b.options.viewScale),e.api&&t(function(){return e.api.scroll.toDate(r)})}}),e.$watchGroup([function(){return e.filtredDevices&&e.filtredDevices.some(function(e){return 2===e.availability})},function(){return b.project.objects.some(function(e){return e.numberSilos>e.silos.length||e.numberHeaters>e.heaters.length})}],function(e){var t=_slicedToArray(e,2),n=t[0],a=t[1];b.autoFillDisabled=!n||!a}),o.getAll().then(function(e){b.devices=e}),b.registredApi=function(a){e.api=a,e.options=b.options;var r={init:function(e){e.hierarchy=a.tree.getHierarchy(),e.parent=e.hierarchy.parent(e.row),e.children=e.hierarchy.descendants(e.row)},moveBegin:function(e){r.init(e),e.originalFrom=e.model.from,e.originalTo=e.model.to,e.duration=e.model.to-e.model.from,e.originalRow=e.row},moveEnd:function(e){var r=e.model;e.$element&&e.$element.removeClass("is-moving"),n.updateItemDate(r.data,r,!0).then(function(){if(e.children&&e.children.length){var t=!0,a=!1,r=void 0;try{for(var o,i=e.children[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var l=_slicedToArray(o.value.tasks,1),s=l[0];n.updateItemDate(s.model.data,s.model,!1),s&&s.$element&&s.$element.removeClass("is-moving")}}catch(e){a=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(a)throw r}}}}).finally(function(){delete e.duration,delete e.originalFrom,delete e.originalTo,delete e.hierarchy,delete e.parent,delete e.children,delete e.originalRow,n.updating=!1,t(function(){return n.updateChartData()}),a.scroll.toDate(e.model.from)})},move:function(e){var t=e.model;if(e.originalRow!==e.row&&console.log("row changed"),!~[].concat(_toConsumableArray(e.$element[0].classList)).indexOf("is-moving")){e.$element.addClass("is-moving");var n=!0,a=!1,r=void 0;try{for(var o,i=e.children[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var l=_slicedToArray(o.value.tasks,1),s=l[0];s&&s.$element&&s.$element.addClass("is-moving")}}catch(e){a=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw r}}}if(e.parent&&"object"===t.type){var d=e.parent.tasks[0].model;d.from>=t.from&&(e.model.from=d.from.clone(),e.model.to=d.from.clone().add(e.duration,"ms")),d.to<=t.to&&(e.model.to=d.to.clone(),e.model.from=d.to.clone().add(-e.duration,"ms")),e.updatePosAndSize()}if(e.children.length){var m=e.model.from;f(e.children,e.originalFrom-m),e.originalFrom=m.clone()}},resizeBegin:function(e){r.init(e),e.originalFrom=e.model.from,e.originalTo=e.model.to},resize:function(e){var t=e.model;if(t.to-t.from===h&&(e.originalFrom=e.model.from,e.originalTo=e.model.to),t.to-t.from<h?(p(e)&&(t.to=e.originalTo.clone()),v(e)&&(t.from=e.originalFrom.clone())):e.children.length&&g(e,e.children),e.parent&&"object"===t.type){var n=e.parent.tasks[0].model,a=n.from,r=n.to;a>t.from&&(t.from=a.clone()),r<e.model.to&&(t.to=r.clone())}e.updatePosAndSize()},change:function(e){e.model},add:function(e){e.model},collapsed:function(e,t){}};a.core.on.rendered(e,function(){n.init(a,b.project),b.chartData=n.getChartData(),e.schedule=n,e.$watchCollection(function(){return b.project},function(){n.updateChartData()}),a.data.on.change(e,function(e,n){t(a.side.setWidth)}),a.tasks.on.move(e,r.move),a.tasks.on.moveEnd(e,r.moveEnd),a.tasks.on.resizeBegin(e,r.resizeBegin),a.tasks.on.resize(e,r.resize),a.tasks.on.resizeEnd(e,r.moveEnd),a.tasks.on.change(e,r.change),a.tasks.on.add(e,r.add),a.tree.on.collapsed(e,r.collapsed)}),a.directives.on.new(e,function(e,t,a){if("ganttTask"===e&&~["object","silo"].indexOf(t.task.model.type)){a.bind("drop",function(e){var a=y,r=t.task.model;("silo"===a.type&&"object"===r.type||"heater"===a.type&&"silo"===r.type)&&(n.addDevice(a,r.data),t.$apply(),y=null)}).bind("dragover",function(e){e.preventDefault()})}"ganttBody"===e&&!function(){var e=0;a.bind("dragenter",function(t){e++,a.addClass("on-drag-hover")}).bind("dragleave",function(t){e--,0===e&&a.removeClass("on-drag-hover")}).bind("drop",function(t){e=0,a.removeClass("on-drag-hover")})}(),"ganttColumn"===e&&+t.column.endDate===+moment().startOf("d").add(1,"d")&&a.css({"background-color":"green",opacity:.6}),"ganttTask"===e&&!function(){var e=t.task;t.task.model,e.getForegroundElement(),e.getContentElement();a.bind("mousedown",function(){r.moveBegin(e)})}()})}}angular.module("heaterSiloM2M").directive("projectSchedule",e),e.$inject=["$window","ganttDebounce","$timeout"],t.$inject=["$scope","$timeout","Schedule","ganttDebounce","ganttMouseOffset","adminDeviceService","COLORS","Silo","Heater"]}();
angular.module("heaterSiloM2M.config", [])
.constant("API_URL", "http://5.148.165.8/api");

angular.module('heaterSiloM2M').run(['$templateCache', function($templateCache) {$templateCache.put('gantt.tmpl.html','<div class="gantt unselectable" ng-cloak gantt-scroll-manager gantt-element-width-listener="ganttElementWidth">\n    <gantt-side flex>\n        <gantt-side-background>\n        </gantt-side-background>\n        <gantt-side-content>\n        </gantt-side-content>\n        <div gantt-resizer="gantt.side.$element" gantt-resizer-event-topic="side" gantt-resizer-enabled="{{$parent.gantt.options.value(\'allowSideResizing\')}}" resizer-width="sideWidth" class="gantt-resizer">\n            <div ng-show="$parent.gantt.options.value(\'allowSideResizing\')" class="gantt-resizer-display"></div>\n        </div>\n    </gantt-side>\n    <div layout=\'column\' class="_gantt-body" flex>\n        <gantt-scrollable-header>\n            <gantt-header gantt-element-height-listener="$parent.ganttHeaderHeight">\n                <gantt-header-columns>\n                    <div ng-repeat="header in gantt.columnsManager.visibleHeaders track by $index">\n                        <div class="gantt-header-row" ng-class="{\'gantt-header-row-last\': $last, \'gantt-header-row-first\': $first}">\n                            <gantt-column-header ng-repeat="column in header"></gantt-column-header>\n                        </div>\n                    </div>\n                </gantt-header-columns>\n            </gantt-header>\n        </gantt-scrollable-header>\n        <gantt-scrollable>\n            <gantt-body>\n                <gantt-body-background>\n                    <gantt-row-background ng-repeat="row in gantt.rowsManager.visibleRows track by row.model.id"></gantt-row-background>\n                </gantt-body-background>\n                <gantt-body-foreground>\n                    <div class="gantt-current-date-line" ng-show="currentDate === \'line\' && gantt.currentDateManager.position >= 0 && gantt.currentDateManager.position <= gantt.width" ng-style="{\'left\': gantt.currentDateManager.position + \'px\' }"></div>\n                </gantt-body-foreground>\n                <gantt-body-columns>\n                    <gantt-column ng-repeat="column in gantt.columnsManager.visibleColumns">\n                        <gantt-time-frame ng-repeat="timeFrame in column.visibleTimeFrames"></gantt-time-frame>\n                    </gantt-column>\n                </gantt-body-columns>\n                <div ng-if="gantt.columnsManager.visibleColumns == 0" style="background-color: #808080"></div>\n                <gantt-body-rows>\n                    <gantt-timespan ng-repeat="timespan in gantt.timespansManager.timespans track by timespan.model.id"></gantt-timespan>\n                    <gantt-row ng-repeat="row in gantt.rowsManager.visibleRows track by row.model.id">\n                        <gantt-task ng-repeat="task in row.visibleTasks track by task.model.id">\n                        </gantt-task>\n                    </gantt-row>\n                </gantt-body-rows>\n            </gantt-body>\n        </gantt-scrollable>\n    </div>\n    \n    <!-- Plugins -->\n    <ng-transclude></ng-transclude>\n\n    <!--\n    ******* Inline templates *******\n    You can specify your own templates by either changing the default ones below or by\n    adding an attribute template-url="<url to your template>" on the specific element.\n    -->\n\n    <!-- Body template -->\n    <script type="text/ng-template" id="template/ganttBody.tmpl.html">\n        <div ng-transclude class="gantt-body" ng-style="{\'width\': gantt.width > 0 ? gantt.width +\'px\' : undefined}"></div>\n    </script>\n\n    <!-- Header template -->\n    <script type="text/ng-template" id="template/ganttHeader.tmpl.html">\n        <div ng-transclude class="gantt-header"\n             ng-show="gantt.columnsManager.columns.length > 0 && gantt.columnsManager.headers.length > 0"></div>\n    </script>\n\n    <!-- Side template -->\n    <script type="text/ng-template" id="template/ganttSide.tmpl.html">\n        <div ng-transclude class="gantt-side" style="width: auto;"></div>\n    </script>\n\n    <!-- Side content template-->\n    <script type="text/ng-template" id="template/ganttSideContent.tmpl.html">\n        <div class="gantt-side-content">\n        </div>\n    </script>\n\n    <!-- Header columns template -->\n    <script type="text/ng-template" id="template/ganttHeaderColumns.tmpl.html">\n        <div ng-transclude class="gantt-header-columns"\n              gantt-horizontal-scroll-receiver></div>\n    </script>\n\n    <script type="text/ng-template" id="template/ganttColumnHeader.tmpl.html">\n        <div class="gantt-column-header" ng-class="{\'gantt-column-header-last\': $last, \'gantt-column-header-first\': $first}">{{::column.label}}</div>\n    </script>\n\n    <!-- Body background template -->\n    <script type="text/ng-template" id="template/ganttBodyBackground.tmpl.html">\n        <div ng-transclude class="gantt-body-background"></div>\n    </script>\n\n    <!-- Body foreground template -->\n    <script type="text/ng-template" id="template/ganttBodyForeground.tmpl.html">\n        <div ng-transclude class="gantt-body-foreground"></div>\n    </script>\n\n    <!-- Body columns template -->\n    <script type="text/ng-template" id="template/ganttBodyColumns.tmpl.html">\n        <div ng-transclude class="gantt-body-columns"></div>\n    </script>\n\n    <script type="text/ng-template" id="template/ganttColumn.tmpl.html">\n        <div ng-transclude class="gantt-column gantt-foreground-col" ng-class="{\'gantt-column-last\': $last, \'gantt-column-first\': $first}"></div>\n    </script>\n\n    <script type="text/ng-template" id="template/ganttTimeFrame.tmpl.html">\n        <div class="gantt-timeframe"></div>\n    </script>\n\n    <!-- Scrollable template -->\n    <script type="text/ng-template" id="template/ganttScrollable.tmpl.html">\n        <div ng-transclude class="gantt-scrollable" gantt-scroll-sender ng-style="getScrollableCss()"></div>\n    </script>\n\n    <script type="text/ng-template" id="template/ganttScrollableHeader.tmpl.html">\n        <div ng-transclude class="gantt-scrollable-header" ng-style="getScrollableHeaderCss()"></div>\n    </script>\n\n    <!-- Rows template -->\n    <script type="text/ng-template" id="template/ganttBodyRows.tmpl.html">\n        <div ng-transclude class="gantt-body-rows"></div>\n    </script>\n\n    <!-- Timespan template -->\n    <script type="text/ng-template" id="template/ganttTimespan.tmpl.html">\n        <div class="gantt-timespan" ng-class="timespan.model.classes">\n        </div>\n    </script>\n\n    <!-- Task template -->\n    <script type="text/ng-template" id="template/ganttTask.tmpl.html">\n        <div class="gantt-task" ng-class="task.model.classes">\n            <gantt-task-background></gantt-task-background>\n            <gantt-task-foreground></gantt-task-foreground>\n            <gantt-task-content></gantt-task-content>\n        </div>\n    </script>\n\n    <script type="text/ng-template" id="template/ganttTaskBackground.tmpl.html">\n        <div \n            class="gantt-task-background"\n            ng-class="{\n                \'task-truncated-right\': task.truncatedRight, \n                \'task-truncated-left\' : task.truncatedLeft\n            }"\n            ng-style="{\'background-color\': task.model.color}"></div>\n    </script>\n\n    <script type="text/ng-template" id="template/ganttTaskForeground.tmpl.html">\n        <div class="gantt-task-foreground">\n            <div ng-if="task.truncatedRight" class="gantt-task-truncated-right">\n                <i class="fa fa-caret-right"></i>\n            </div>\n            <div ng-if="task.truncatedLeft" class="gantt-task-truncated-left">\n                <i class="fa fa-caret-left"></i>\n            </div>\n        </div>\n    </script>\n\n    <!-- Task content template -->\n    <script type="text/ng-template" id="template/ganttTaskContent.tmpl.html">\n        <div class="gantt-task-content" unselectable="on">\n            <div unselectable="on" \n                 gantt-bind-compile-html="getTaskContent()"\n                 layout="row"\n                 layout-align="space-between center"></div>\n        </div>\n    </script>\n\n\n    <!-- Row background template -->\n    <script type="text/ng-template" id="template/ganttRowBackground.tmpl.html">\n        <div class="gantt-row gantt-row-height"\n             ng-class="row.model.classes"\n             ng-class-odd="\'gantt-row-odd\'"\n             ng-class-even="\'gantt-row-even\'"\n             ng-style="{\'height\': row.model.height}">\n            <div class="gantt-row-background"\n                 ng-style="{\'background-color\': row.model.color}">\n            </div>\n        </div>\n    </script>\n\n    <!-- Row template -->\n    <script type="text/ng-template" id="template/ganttRow.tmpl.html">\n        <div class="gantt-row gantt-row-height"\n             ng-class="row.model.classes"\n             ng-class-odd="\'gantt-row-odd\'"\n             ng-class-even="\'gantt-row-even\'"\n             ng-style="{\'height\': row.model.height}">\n            <div ng-transclude class="gantt-row-content"></div>\n        </div>\n    </script>\n\n    <!-- Side background template -->\n    <script type="text/ng-template" id="template/ganttSideBackground.tmpl.html">\n        <div class="gantt-side-background">\n            <div class="gantt-side-background-header" ng-style="{height: $parent.ganttHeaderHeight + \'px\'}">\n                <div ng-show="$parent.ganttHeaderHeight" class="gantt-header-row gantt-side-header-row"></div>\n            </div>\n            <div class="gantt-side-background-body" ng-style="getMaxHeightCss()">\n                <div gantt-vertical-scroll-receiver>\n                    <div class="gantt-row gantt-row-height "\n                         ng-class-odd="\'gantt-row-odd\'"\n                         ng-class-even="\'gantt-row-even\'"\n                         ng-class="row.model.classes"\n                         ng-repeat="row in gantt.rowsManager.visibleRows track by row.model.id"\n                         ng-style="{\'height\': row.model.height}">\n                        <div gantt-row-label class="gantt-row-label gantt-row-background"\n                             ng-style="{\'background-color\': row.model.color}">\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </script>\n</div>');
$templateCache.put('heaterTask.tmpl.html','<div flex="none" class="device-icon">\n    <i class="fa fa-fire"></i>\n</div>\n<div flex class="task-content">{{task.model.title}}</div>\n<div flex="none" class="action-icon" ng-if="!scope.options.hideActions">\n    <i\n        ui-sref="admin.devices.update({id:task.model.data._id, type: task.model.type})" \n        class="fa fa-gear update-device" title="edit">\n    </i>\n    <i\n        ng-if="!task.row._collapsed && !scope.options.readOnly"\n        ng-click="scope.schedule.removeRow(task.model.uuid)" \n        class="fa fa-times-circle remove-device" title="remove">\n    </i>\n</div>');
$templateCache.put('objectTask.tmpl.html','<div flex="none" class="device-icon" ng-if="task.row._collapsed">\n    <span>\n        <i class="fa fa-battery-4 fa-rotate-270">\n        </i>\n        {{task.model.data.silos.length}}\n    </span>\n    <span>\n        <i class="fa fa-fire"></i>\n        {{task.model.data.heaters.length}}\n    </span>\n</div>\n<div flex class="task-content">{{task.model.title}}</div>');
$templateCache.put('projectTask.tmpl.html','<div flex="none" class="device-icon" ng-if="task.row._collapsed">\n    <span>\n        <i class="fa fa-battery-4 fa-rotate-270">\n        </i>\n        {{task.model.data.silos.length}}\n    </span>\n    <span>\n        <i class="fa fa-fire"></i>\n        {{task.model.data.heaters.length}}\n    </span>\n</div>\n<div flex class="task-content">{{task.model.title}}</div>\n<div flex="none" class="action-icon" ng-if="!scope.options.hideActions">\n    <i\n        ui-sref="admin.projects.update({id:task.model.data._id})" \n        class="fa fa-gear update-device" title="edit">\n    </i>\n</div>');
$templateCache.put('siloTask.tmpl.html','<div flex="none" class="device-icon">\n    <i class="fa fa-battery-4 fa-rotate-270"></i>\n    <i ng-if="task.row._collapsed && task.model.data.children"\n        ng-repeat="child in task.model.data.children"\n        class="fa fa-fire"></i>\n</div>\n<div flex class="task-content">{{task.model.title}}</div>\n<div flex="none" class="action-icon" ng-if="!scope.options.hideActions">\n    <i\n        ng-if="!scope.options.readOnly"\n        class="fa fa-user-circle-o supplier-device" title="supplier"\n        ng-style="!task.model.data.supplier && { \'color\': \'rgb(194, 62, 0)\'}"\n        ng-click="scope.schedule.changeSupplier(task.model.data)">\n    </i>\n    <i\n        ng-if="scope.options.readOnly"\n        ng-class="{\'read-only\': scope.options.readOnly}"\n        class="fa fa-user-circle-o supplier-device" title="supplier"\n        ng-style="!task.model.data.supplier && { \'color\': \'rgb(194, 62, 0)\'}">\n    </i>\n    <i\n        ui-sref="admin.devices.update({id:task.model.data._id, type: task.model.type})" \n        class="fa fa-gear update-device" title="edit">\n    </i>\n    <i\n        ng-if="!task.row._collapsed && !scope.options.readOnly"\n        ng-click="scope.schedule.removeRow(task.model.uuid)" \n        class="fa fa-times-circle remove-device" title="remove">\n    </i>\n</div>');}]);